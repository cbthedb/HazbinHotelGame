{"file_contents":{"design_guidelines.md":{"content":"# Hazbin Hotel BitLife Game - Design Guidelines\n\n## Design Approach\n\n**System Selected:** Custom game UI framework inspired by BitLife's clean card-based interface, heavily themed with Hazbin Hotel's Art Deco aesthetic.\n\n**Core Principles:**\n- Information clarity over decoration - stats and choices must be immediately readable\n- Hazbin Hotel visual identity: Art Deco patterns, red/black/gold accents, theatrical flair\n- Card-based event system with clear action buttons\n- Persistent stat displays without overwhelming the interface\n\n## Typography\n\n**Font Families:**\n- Primary (UI/Stats): \"Inter\" or \"DM Sans\" - clean, highly legible for numbers and stat names\n- Display (Titles/Headers): \"Playfair Display\" or \"Cinzel\" - Art Deco elegance for section headers and character names\n- Body (Events/Descriptions): Same as Primary for consistency\n\n**Hierarchy:**\n- Character Name/Title: 28-32px, Display font, bold\n- Section Headers: 20-24px, Display font, semi-bold\n- Event Cards: 16-18px, Primary font, regular\n- Stats/Numbers: 14-16px, Primary font, medium weight\n- Button Text: 14-16px, Primary font, semi-bold\n\n## Layout System\n\n**Spacing Units:** Tailwind units of 2, 4, 6, and 8 (p-2, p-4, p-6, p-8, etc.)\n\n**Grid Structure:**\n- Primary container: max-w-6xl centered with px-4 for mobile\n- Two-column desktop layout (2/3 main content + 1/3 sidebar for stats)\n- Single column stack on mobile (< 768px)\n- Card spacing: gap-4 between event cards, gap-6 between sections\n\n## Core Components\n\n### 1. Character Header Bar\n- Fixed top bar displaying character portrait (64px circle), name, current title, age\n- Compact stat overview (Power/Influence/Corruption icons + values)\n- Actions menu button (hamburger) on mobile\n\n### 2. Stats Panel (Sidebar on desktop, collapsible on mobile)\n- Vertical stat bars with labels and numeric values\n- Color-coded: Power (red), Control (purple), Influence (gold), Corruption (dark red), Empathy (pink), Health (green), Wealth (yellow)\n- Reputation badges for each faction (icons + progress circles)\n\n### 3. Event Cards\n- White/light gray cards with subtle shadow (shadow-md)\n- Event title at top (bold, 18px)\n- Description text (16px, gray-700)\n- 2-4 choice buttons at bottom (full-width on mobile, inline on desktop)\n- Consequence previews (small text showing stat changes: \"+2 Power\", \"-1 Empathy\")\n\n### 4. Power Loadout Display\n- Horizontal ability slots (3-5 slots)\n- Each slot: ability icon, name, cooldown indicator\n- Active/inactive states clearly visible\n- Click to view details modal\n\n### 5. Territory Map Interface\n- Simplified Pentagram City map with 7 clickable districts\n- Each district shows: name, ruler, player ownership status\n- Visual indicators for available events (notification dots)\n- Travel button opens district detail view\n\n### 6. Navigation Menu\n- Tab-based navigation: Life Events, Powers, Traits, Map, Relationships, Settings\n- Always accessible sidebar/bottom nav depending on viewport\n\n### 7. Character Creation Flow\n- Multi-step wizard: Name ‚Üí Appearance ‚Üí Origin ‚Üí Traits ‚Üí Confirm\n- 2D portrait builder with toggle buttons for horns, wings, colors\n- Trait selection grid with point allocation display\n- Large \"Begin Your Life\" button to start\n\n### 8. Relationship Cards\n- NPC portraits in grid layout (grid-cols-2 md:grid-cols-3)\n- Affinity bar beneath each portrait\n- Click to view relationship details and interaction options\n\n## Visual Elements\n\n**Art Deco Patterns:**\n- Subtle geometric borders on major section dividers\n- Corner flourishes on character header and ending screens\n- Repeating line patterns in backgrounds (very subtle, low opacity)\n\n**Color Accents:**\n- Primary actions: Red (#E63946 or similar)\n- Secondary actions: Gold (#F4A261)\n- Destructive actions: Dark red (#A4161A)\n- Success states: Muted green\n- Hazbin Hotel branding throughout\n\n**Icons:**\n- Use Heroicons for standard UI (menu, settings, stats)\n- Custom small icons for power types and traits (simple, 24px)\n\n## Soundtrack Integration\n\n- Audio controls in top-right corner (play/pause, volume slider)\n- Background music auto-plays on user interaction (respecting browser policies)\n- Dynamic track changes based on location: Hotel (jazzy), Streets (ambient dark), Battles (intense)\n- Subtle visual indicator when track changes\n\n## Images\n\n**Character Portraits:**\n- 2D illustrated style matching Hazbin Hotel art direction\n- Circular crop for stat panels (64-96px)\n- Larger versions for relationship/NPC detail modals (256px)\n- Procedurally generated placeholder portraits using SVG shapes and Hazbin color palette\n\n**Background Treatment:**\n- Subtle texture overlay (noise or Art Deco pattern) at 5% opacity\n- Dark gradient background (#1a1a1a to #2d2d2d)\n- No large hero images - this is a game interface, not a landing page\n\n## Responsive Behavior\n\n- Desktop (‚â•1024px): Two-column with persistent stats sidebar\n- Tablet (768-1023px): Stats collapse to top bar, single column content\n- Mobile (<768px): Hamburger menu for all navigation, full-width cards, stats in expandable drawer\n\n## Animation\n\n- Minimal, purposeful animations only\n- Stat changes: brief highlight flash (200ms)\n- Card appearance: subtle fade-in (300ms)\n- Button hover: scale(1.02) for tactile feedback\n- NO complex animations that distract from gameplay","size_bytes":5285},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/character-creation/summary-step.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { calculateTraitCost } from \"@/lib/gameHelpers\";\nimport traitsData from \"@/data/traits.json\";\nimport powersData from \"@/data/powers.json\";\nimport type { CharacterData } from \"@/pages/character-creation\";\nimport type { Trait, Power } from \"@shared/schema\";\n\ninterface SummaryStepProps {\n  data: CharacterData;\n}\n\nexport default function SummaryStep({ data }: SummaryStepProps) {\n  const traits = traitsData as Trait[];\n  const powers = powersData as Power[];\n\n  const selectedTraits = traits.filter(t => data.selectedTraits.includes(t.id));\n  const selectedPowers = powers.filter(p => data.equippedPowers.includes(p.id));\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Character Name & Appearance */}\n      <Card className=\"bg-gradient-to-r from-primary/10 to-secondary/10 border-2\">\n        <CardHeader>\n          <CardTitle className=\"font-display text-3xl text-center\">\n            {data.firstName} {data.lastName}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-center gap-8\">\n            <div className=\"w-24 h-24 rounded-full border-4 border-primary flex items-center justify-center\"\n                 style={{ \n                   background: `linear-gradient(135deg, ${data.appearance.colorPalette[0]}, ${data.appearance.colorPalette[1]})` \n                 }}>\n              <div className=\"text-5xl\">üëπ</div>\n            </div>\n            <div className=\"space-y-1 text-sm\">\n              <p className=\"capitalize\"><span className=\"text-muted-foreground\">Horns:</span> {data.appearance.horns}</p>\n              <p className=\"capitalize\"><span className=\"text-muted-foreground\">Wings:</span> {data.appearance.wings}</p>\n              <p><span className=\"text-muted-foreground\">Palette:</span> \n                <span className=\"ml-2 inline-flex gap-1\">\n                  {data.appearance.colorPalette.map((color, idx) => (\n                    <span\n                      key={idx}\n                      className=\"w-4 h-4 rounded-full border\"\n                      style={{ backgroundColor: color }}\n                    />\n                  ))}\n                </span>\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Origin */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-xl\">Origin</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          <div>\n            <h3 className=\"font-display text-2xl text-primary\">{data.origin?.name}</h3>\n            <p className=\"text-sm text-muted-foreground mt-1\">{data.origin?.description}</p>\n          </div>\n          <Separator />\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm\">\n            <div>\n              <p className=\"text-muted-foreground\">Power</p>\n              <p className=\"font-semibold text-red-500 text-lg\">{data.origin?.startingStats.power}</p>\n            </div>\n            <div>\n              <p className=\"text-muted-foreground\">Control</p>\n              <p className=\"font-semibold text-purple-500 text-lg\">{data.origin?.startingStats.control}</p>\n            </div>\n            <div>\n              <p className=\"text-muted-foreground\">Influence</p>\n              <p className=\"font-semibold text-amber-500 text-lg\">{data.origin?.startingStats.influence}</p>\n            </div>\n            <div>\n              <p className=\"text-muted-foreground\">Empathy</p>\n              <p className=\"font-semibold text-pink-500 text-lg\">{data.origin?.startingStats.empathy}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Traits */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-xl\">Traits</CardTitle>\n            <Badge variant=\"secondary\">\n              {calculateTraitCost(selectedTraits)} / {data.origin?.traitPoints} TP\n            </Badge>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-2\">\n            {selectedTraits.map(trait => (\n              <Badge key={trait.id} variant=\"outline\" className=\"text-sm\">\n                {trait.name}\n              </Badge>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Powers */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-xl\">Starting Powers</CardTitle>\n            <Badge variant=\"secondary\">\n              {selectedPowers.length} selected\n            </Badge>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2\">\n            {selectedPowers.map(power => (\n              <div key={power.id} className=\"flex items-center justify-between p-2 bg-muted rounded-md\">\n                <div>\n                  <p className=\"font-semibold text-sm\">{power.name}</p>\n                  <p className=\"text-xs text-muted-foreground capitalize\">{power.type.replace(\"-\", \" \")}</p>\n                </div>\n                <Badge variant=\"outline\" className=\"capitalize text-xs\">\n                  {power.rarity}\n                </Badge>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"p-4 bg-primary/10 rounded-md border border-primary\">\n        <p className=\"text-sm font-semibold text-center\">\n          Ready to begin your life in Hell. Click \"Begin Your Life in Hell\" to start!\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5763},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/pages/not-found.tsx":{"content":"import { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { AlertCircle, Home } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background to-card flex items-center justify-center p-4\">\n      <Card className=\"max-w-md w-full p-8 border-2 border-destructive/50 text-center space-y-6\">\n        <div className=\"space-y-2\">\n          <div className=\"flex justify-center mb-4\">\n            <AlertCircle className=\"w-12 h-12 text-destructive\" />\n          </div>\n          <h1 className=\"font-display text-3xl font-bold\">404</h1>\n          <p className=\"text-lg font-semibold\">Page Not Found</p>\n        </div>\n\n        <p className=\"text-muted-foreground\">\n          The page you're looking for doesn't exist. It's probably lost in the depths of Hell somewhere.\n        </p>\n\n        <Link href=\"/\">\n          <Button className=\"w-full gap-2\" data-testid=\"button-home\">\n            <Home className=\"w-4 h-4\" />\n            Return to Home\n          </Button>\n        </Link>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":1152},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, jsonb, boolean, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// ==================== CHARACTER & GAME STATE ====================\n\nexport const characters = pgTable(\"characters\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  \n  // Origin & Appearance\n  origin: text(\"origin\").notNull(), // royal-born, hellborn, sinner-weak, deal-immigrant, accidental\n  appearance: jsonb(\"appearance\").$type<{\n    horns: string;\n    wings: string;\n    colorPalette: string[];\n  }>().notNull(),\n  \n  // Core Stats\n  power: integer(\"power\").notNull().default(10),\n  control: integer(\"control\").notNull().default(10),\n  influence: integer(\"influence\").notNull().default(10),\n  corruption: integer(\"corruption\").notNull().default(0),\n  empathy: integer(\"empathy\").notNull().default(10),\n  health: integer(\"health\").notNull().default(100),\n  wealth: integer(\"wealth\").notNull().default(100),\n  soulcoins: integer(\"soulcoins\").notNull().default(0),\n  mythicalShards: integer(\"mythical_shards\").notNull().default(0),\n  \n  // Powers & Traits\n  powers: jsonb(\"powers\").$type<string[]>().notNull().default(sql`'[]'::jsonb`),\n  traits: jsonb(\"traits\").$type<string[]>().notNull().default(sql`'[]'::jsonb`),\n  \n  // Meta Stats\n  age: integer(\"age\").notNull().default(0),\n  currentRank: text(\"current_rank\").notNull().default(\"street-demon\"), // street-demon, rising-power, overlord-candidate, overlord, supreme-overlord, hells-apex\n  currentLocation: text(\"current_location\").notNull().default(\"hotel-district\"),\n  rank: text(\"rank\").notNull().default(\"street-demon\"), // For backward compatibility\n  \n  // Turn & Progression\n  currentTurn: integer(\"current_turn\").notNull().default(0),\n  \n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const gameStates = pgTable(\"game_states\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  characterId: varchar(\"character_id\").notNull().references(() => characters.id, { onDelete: 'cascade' }),\n  \n  // Active Powers (IDs of equipped abilities)\n  activePowers: jsonb(\"active_powers\").$type<string[]>().notNull().default(sql`'[]'::jsonb`),\n  \n  // Power Levels (powerID -> level)\n  powerLevels: jsonb(\"power_levels\").$type<Record<string, number>>().notNull().default(sql`'{}'::jsonb`),\n  \n  // Power Cooldowns (powerID -> turns remaining)\n  powerCooldowns: jsonb(\"power_cooldowns\").$type<Record<string, number>>().notNull().default(sql`'{}'::jsonb`),\n  \n  // Trait IDs\n  traits: jsonb(\"traits\").$type<string[]>().notNull().default(sql`'[]'::jsonb`),\n  \n  // Contract Clauses (for Deal Immigrants)\n  contractClauses: jsonb(\"contract_clauses\").$type<string[]>().notNull().default(sql`'[]'::jsonb`),\n  \n  // Faction Reputations (factionID -> rep value)\n  factionReps: jsonb(\"faction_reps\").$type<Record<string, number>>().notNull().default(sql`'{}'::jsonb`),\n  \n  // NPC Relationships (npcID -> affinity value)\n  npcRelationships: jsonb(\"npc_relationships\").$type<Record<string, {\n    affinity: number;\n    isRomanced: boolean;\n    isRival: boolean;\n    favorsOwed: number;\n  }>>().notNull().default(sql`'{}'::jsonb`),\n  \n  // Territory Control (districtID -> ownership info)\n  territories: jsonb(\"territories\").$type<Record<string, {\n    owned: boolean;\n    ownerId: string | null;\n    tributePerTurn: number;\n  }>>().notNull().default(sql`'{}'::jsonb`),\n  \n  // Event History (completed event IDs)\n  completedEvents: jsonb(\"completed_events\").$type<string[]>().notNull().default(sql`'[]'::jsonb`),\n  \n  // Story Flags\n  storyFlags: jsonb(\"story_flags\").$type<Record<string, any>>().notNull().default(sql`'{}'::jsonb`),\n  \n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const saves = pgTable(\"saves\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  slotNumber: integer(\"slot_number\").notNull(), // 1-5 for save slots\n  characterId: varchar(\"character_id\").notNull().references(() => characters.id, { onDelete: 'cascade' }),\n  gameStateId: varchar(\"game_state_id\").notNull().references(() => gameStates.id, { onDelete: 'cascade' }),\n  saveName: text(\"save_name\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// ==================== SCHEMAS ====================\n\nexport const insertCharacterSchema = createInsertSchema(characters).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertGameStateSchema = createInsertSchema(gameStates).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport const insertSaveSchema = createInsertSchema(saves).omit({\n  id: true,\n  createdAt: true,\n});\n\n// ==================== TYPES ====================\n\nexport type Character = typeof characters.$inferSelect;\nexport type InsertCharacter = z.infer<typeof insertCharacterSchema>;\n\nexport type GameState = typeof gameStates.$inferSelect;\nexport type InsertGameState = z.infer<typeof insertGameStateSchema>;\n\nexport type Save = typeof saves.$inferSelect;\nexport type InsertSave = z.infer<typeof insertSaveSchema>;\n\n// ==================== GAME DATA TYPES (JSON-based) ====================\n\nexport type Origin = {\n  id: string;\n  name: string;\n  description: string;\n  startingStats: {\n    power: number;\n    control: number;\n    influence: number;\n    corruption: number;\n    empathy: number;\n    health: number;\n    wealth: number;\n  };\n  traitPoints: number;\n  lockedTraits: string[]; // traits exclusive to this origin\n  suggestedPowers: string[]; // power IDs to choose from\n};\n\nexport type PowerType = \"hellfire\" | \"voice-broadcast\" | \"shadow-eldritch\" | \"contract\" | \"seduction\" | \"tech-cyber\" | \"pheromone\" | \"regeneration\" | \"teleportation\" | \"necromancy\" | \"glamour\" | \"musical\" | \"physical\" | \"illusion\" | \"divine\";\n\nexport type Power = {\n  id: string;\n  name: string;\n  type: PowerType;\n  basePower: number;\n  controlReq: number;\n  corruptionCost: number;\n  cooldown: number; // in turns\n  effect: string;\n  description: string;\n  rarity: \"common\" | \"uncommon\" | \"rare\" | \"epic\" | \"legendary\" | \"mythical\";\n  unlockConditions: {\n    origin?: string[];\n    minPower?: number;\n    minControl?: number;\n    minInfluence?: number;\n    requiredEvent?: string;\n  };\n  isPassive: boolean;\n};\n\nexport type Trait = {\n  id: string;\n  name: string;\n  description: string;\n  category: \"moral\" | \"social\" | \"physical\" | \"magical\" | \"quirky\";\n  cost: number; // negative = gives extra TP\n  mechanics: {\n    statModifiers?: Record<string, number>; // stat name -> modifier\n    multipliers?: Record<string, number>; // e.g., \"corruptionGainMultiplier\": 0.9\n    specialEffects?: string[]; // special flags\n  };\n  originLocked?: string; // if locked to specific origin\n};\n\nexport type District = {\n  id: string;\n  name: string;\n  description: string;\n  currentRuler: string; // NPC ID or \"player\"\n  difficultyRating: number; // 1-10 for challenge level\n  tributeValue: number; // soulcoins per turn when owned\n  specialEvents: string[]; // event IDs unique to this district\n  aesthetic: {\n    colorScheme: string[];\n    musicTrack: string;\n  };\n};\n\nexport type NPC = {\n  id: string;\n  name: string;\n  faction: string;\n  description: string;\n  basePower: number;\n  affinityTraits: string[]; // trait IDs they like\n  dislikedTraits: string[]; // trait IDs they dislike\n  romanceable: boolean;\n  canBeRival: boolean;\n  specialDialogue: Record<string, string[]>; // eventID -> dialogue options\n  portrait?: string; // path to portrait image\n};\n\nexport type GameEventChoice = {\n  id: string;\n  text: string;\n  outcomes: {\n    statChanges?: Record<string, number>;\n    narrativeText: string;\n    affinityChanges?: Record<string, number>;\n  };\n};\n\nexport type GameEvent = {\n  id: string;\n  title: string;\n  description: string;\n  type: \"daily\" | \"career\" | \"contract\" | \"romance\" | \"war\" | \"misfortune\";\n  choices: GameEventChoice[];\n  onlyOnce?: boolean;\n};\n\nexport type Event = {\n  id: string;\n  title: string;\n  description: string;\n  type: \"daily\" | \"career\" | \"contract\" | \"romance\" | \"war\" | \"misfortune\";\n  triggerConditions: {\n    minTurn?: number;\n    location?: string[];\n    statRequirements?: Record<string, number>;\n    requiredFlags?: string[];\n    randomChance?: number; // 0-1\n  };\n  choices: {\n    id: string;\n    text: string;\n    requirements?: Record<string, number>; // stat checks\n    outcomes: {\n      statChanges?: Record<string, number>;\n      powerGrant?: string[]; // power IDs\n      traitGrant?: string[]; // trait IDs\n      reputationChanges?: Record<string, number>; // factionID -> change\n      npcAffinityChanges?: Record<string, number>; // npcID -> change\n      corruptionChange?: number;\n      wealthChange?: number;\n      healthChange?: number;\n      storyFlags?: Record<string, any>;\n      nextEvent?: string; // chain to next event\n      narrativeText?: string;\n    };\n  }[];\n  onlyOnce: boolean;\n};\n\nexport type Faction = {\n  id: string;\n  name: string;\n  description: string;\n  leaderNPC?: string;\n  territoryIds: string[];\n  baseReputation: number;\n};\n\nexport type Ending = {\n  id: string;\n  name: string;\n  description: string;\n  tier: \"good\" | \"neutral\" | \"bad\";\n  requirements: {\n    minStats?: Record<string, number>;\n    maxStats?: Record<string, number>;\n    requiredFactionRep?: Record<string, number>;\n    requiredTerritories?: string[];\n    requiredFlags?: string[];\n  };\n  narrativeText: string;\n  unlocks?: {\n    newOrigin?: string;\n    newPowers?: string[];\n    newTraits?: string[];\n  };\n};\n\n// ==================== SOUNDTRACK ====================\n\nexport type SoundtrackTrack = {\n  id: string;\n  name: string;\n  location: string[]; // which locations/districts this plays in\n  url: string; // audio file path\n  artist?: string;\n  loopable: boolean;\n};\n","size_bytes":9889},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/components/game/stats-panel.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { getStatBarColor, getRankTitle } from \"@/lib/gameHelpers\";\nimport { Crown, Zap, Sparkles, Heart, Skull, Coins, Users, Gem, Flame } from \"lucide-react\";\n\ninterface StatsPanelProps {\n  character: {\n    rank: string;\n    age: number;\n    power: number;\n    control: number;\n    influence: number;\n    corruption: number;\n    empathy: number;\n    health: number;\n    wealth: number;\n    soulcoins?: number;\n  };\n}\n\nexport default function StatsPanel({ character }: StatsPanelProps) {\n  const level = Math.floor(character.age / 5);\n  // Calculate battle health (scales with age)\n  const battleHealth = character.health + Math.floor(character.age * 2);\n  \n  const stats = [\n    { name: \"Power\", value: character.power, max: 100, icon: Zap, color: \"text-red-500\" },\n    { name: \"Control\", value: character.control, max: 100, icon: Sparkles, color: \"text-purple-500\" },\n    { name: \"Influence\", value: character.influence, max: 100, icon: Crown, color: \"text-amber-500\" },\n    { name: \"Corruption\", value: character.corruption, max: 100, icon: Skull, color: \"text-red-900\" },\n    { name: \"Empathy\", value: character.empathy, max: 100, icon: Heart, color: \"text-pink-500\" },\n    { name: \"Wealth\", value: character.wealth, max: 1000, icon: Coins, color: \"text-yellow-500\" },\n  ];\n\n  return (\n    <Card className=\"border-2 border-card-border\" data-testid=\"card-stats\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-display\">Character Stats</CardTitle>\n          <div className=\"flex gap-2\">\n            <Badge variant=\"secondary\" className=\"capitalize\">\n              {getRankTitle(character.rank)}\n            </Badge>\n            <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n              <Flame className=\"w-3 h-3\" />\n              Lv. {level}\n            </Badge>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        <div className=\"text-xs text-muted-foreground text-center\">\n          Age {character.age.toFixed(1)} (Progress to Lv. {level + 1}: {Math.floor((character.age % 5) / 5 * 100)}%)\n        </div>\n        \n        <div className=\"p-3 bg-muted/50 rounded-md\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <Heart className=\"w-4 h-4 text-green-500\" />\n            <span className=\"text-sm font-semibold\">Health</span>\n          </div>\n          <Progress value={Math.min(character.health, 100)} className=\"h-2\" />\n          <p className=\"text-xs text-muted-foreground mt-1\">{character.health} / 100 <span className=\"text-amber-400\">(‚öîÔ∏è Battle: {battleHealth})</span></p>\n        </div>\n\n        {character.soulcoins !== undefined && (\n          <div className=\"p-3 bg-purple-500/10 border border-purple-500/30 rounded-md\">\n            <div className=\"flex items-center gap-2\">\n              <Gem className=\"w-4 h-4 text-purple-500\" />\n              <span className=\"text-sm font-semibold\">Soulcoins</span>\n              <span className=\"ml-auto text-sm font-bold text-purple-400\">{character.soulcoins}</span>\n            </div>\n          </div>\n        )}\n\n        {stats.map((stat) => {\n          const Icon = stat.icon;\n          const percentage = (stat.value / stat.max) * 100;\n          \n          return (\n            <div key={stat.name} className=\"space-y-1\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Icon className={`w-4 h-4 ${stat.color}`} />\n                  <span className=\"text-sm font-semibold\">{stat.name}</span>\n                </div>\n                <span className=\"text-sm font-bold\">{stat.value}</span>\n              </div>\n              <Progress \n                value={percentage} \n                className=\"h-1.5\" \n                data-testid={`progress-${stat.name.toLowerCase()}`}\n              />\n            </div>\n          );\n        })}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4193},"client/src/data/ai-scenarios.ts":{"content":"export interface ScenarioOutcome {\n  title: string;\n  narrative: string;\n  statChanges: Record<string, number>;\n}\n\nexport interface ScenarioTemplate {\n  keywords: string[];\n  outcomes: ScenarioOutcome[];\n  minPower?: number;\n  minCorruption?: number;\n  type: 'power' | 'social' | 'survival' | 'manipulation' | 'dark' | 'redemption' | 'exploration';\n}\n\nexport const scenarios: ScenarioTemplate[] = [\n  // POWER-BASED ACTIONS (40+ scenarios)\n  {\n    keywords: ['fight', 'battle', 'attack', 'combat', 'duel', 'strike', 'hit', 'punch', 'kick', 'destroy'],\n    type: 'power',\n    outcomes: [\n      {\n        title: \"Overwhelming Dominance\",\n        narrative: \"Your magical assault is devastating. Enemies crumble before your raw power, leaving them broken and defeated.\",\n        statChanges: { power: 2 / 3, health: 1, control: 1 }\n      },\n      {\n        title: \"Combat Mastery\",\n        narrative: \"Years of experience shine through. Each blow is perfectly placed, each dodge flawless. Victory is inevitable.\",\n        statChanges: { power: 2 / 3, control: 1, wealth: 66 / 3 }\n      },\n      {\n        title: \"Brutal Takedown\",\n        narrative: \"You show no mercy. The battle is quick, vicious, and absolutely final. Your opponent won't stand again.\",\n        statChanges: { power: 2 / 3, corruption: 1, health: 1 }\n      },\n      {\n        title: \"Strategic Victory\",\n        narrative: \"You analyze their every move, predict their attacks, and strike where they're weakest. An intellectual victory.\",\n        statChanges: { power: 1 / 3, control: 1, influence: 1 }\n      },\n      {\n        title: \"Unleashed Fury\",\n        narrative: \"All restraint abandoned. Pure magical energy explodes outward. Everything in the area suffers your wrath.\",\n        statChanges: { power: 3 / 3, corruption: 2, health: 1, control: 1 }\n      },\n      {\n        title: \"Precise Strike\",\n        narrative: \"One perfect hit. That's all it takes. Your opponent falls before they even realize what happened.\",\n        statChanges: { power: 1 / 3, control: 2 }\n      },\n      {\n        title: \"Tactical Genius\",\n        narrative: \"You've already won this before they even started. Every move they make plays directly into your plan.\",\n        statChanges: { control: 2, influence: 1, power: 1 / 3 }\n      },\n      {\n        title: \"Magical Devastation\",\n        narrative: \"Arcane forces swirl around you. Spells interweave in a symphony of destruction. Reality itself bends.\",\n        statChanges: { power: 4 / 3, health: 1, control: 1, corruption: 1 }\n      },\n      {\n        title: \"Confident Victory\",\n        narrative: \"You barely break a sweat. This was never even close. Your opponent was outclassed from the start.\",\n        statChanges: { power: 1 / 3, influence: 1, wealth: 50 / 3 }\n      },\n      {\n        title: \"Berserker Rampage\",\n        narrative: \"Something primal awakens. You lose yourself in combat, becoming a force of pure destruction.\",\n        statChanges: { power: 3 / 3, corruption: 2, control: 1, health: 1 }\n      },\n      {\n        title: \"Elegant Slaughter\",\n        narrative: \"Combat becomes art. Each strike is a masterpiece. Bodies fall in a beautiful pattern.\",\n        statChanges: { power: 2 / 3, control: 2, influence: 1, corruption: 1 }\n      },\n      {\n        title: \"Crushing Blow\",\n        narrative: \"You summon all your strength into one final strike. It shatters bone and will alike.\",\n        statChanges: { power: 2 / 3, health: 1, wealth: 33 / 3 }\n      },\n      {\n        title: \"Supernatural Strength\",\n        narrative: \"Demonic power flows through your muscles. Opponents are sent flying by your casual strikes.\",\n        statChanges: { power: 3 / 3, control: 1, corruption: 2 }\n      },\n      {\n        title: \"Combat Instinct\",\n        narrative: \"You move on pure instinct now. Your body knows what to do before your mind catches up.\",\n        statChanges: { power: 2 / 3, control: 2, health: 1 }\n      },\n      {\n        title: \"Victory Through Attrition\",\n        narrative: \"You outlast them. They tire, you press harder. Eventually, there's only one standing.\",\n        statChanges: { power: 1 / 3, health: 1, influence: 1 }\n      }\n    ]\n  },\n\n  // SEDUCTION & CHARM (35+ scenarios)\n  {\n    keywords: ['seduce', 'charm', 'flirt', 'romance', 'kiss', 'attract', 'love', 'tempt', 'enchant', 'desire'],\n    type: 'social',\n    outcomes: [\n      {\n        title: \"Irresistible Charm\",\n        narrative: \"Your natural magnetism is intoxicating. They're drawn to you like moths to flame, unable to resist.\",\n        statChanges: { influence: 2, wealth: 50 / 3, empathy: 1 }\n      },\n      {\n        title: \"Perfect Seduction\",\n        narrative: \"Every word is perfectly chosen, every gesture calculated. They fall into your arms willingly.\",\n        statChanges: { influence: 2, control: 1, corruption: 1, wealth: 66 / 3 }\n      },\n      {\n        title: \"Genuine Connection\",\n        narrative: \"Despite yourself, there's real chemistry. A true connection forms between you, surprising in its depth.\",\n        statChanges: { influence: 1, empathy: 1, wealth: 33 / 3 }\n      },\n      {\n        title: \"Manipulation Masterclass\",\n        narrative: \"You toy with their emotions expertly. They think it's real, but you're always five steps ahead.\",\n        statChanges: { influence: 2, control: 1, corruption: 2, wealth: 83 / 3 }\n      },\n      {\n        title: \"Intoxicating Presence\",\n        narrative: \"Your very essence captivates them. They're under your spell, willing to do anything for you.\",\n        statChanges: { influence: 3, power: 1 / 3, corruption: 1 }\n      },\n      {\n        title: \"Heartfelt Affection\",\n        narrative: \"Something genuine blooms. They see the real you, and they like what they see. It's mutual.\",\n        statChanges: { empathy: 2, influence: 1, wealth: 16 / 3 }\n      },\n      {\n        title: \"Dangerous Allure\",\n        narrative: \"Your dark magnetism is intoxicating. They're attracted to the danger you represent.\",\n        statChanges: { influence: 2, power: 1 / 3, corruption: 2, control: 1 }\n      },\n      {\n        title: \"Strategic Romance\",\n        narrative: \"You use their feelings as currency. Each gesture buys you power, influence, or wealth.\",\n        statChanges: { influence: 2, control: 2, corruption: 1, wealth: 100 / 3 }\n      },\n      {\n        title: \"Passionate Encounter\",\n        narrative: \"Desire burns between you. The night is intense, memorable, and leaves them wanting more.\",\n        statChanges: { influence: 1, wealth: 33 / 3, empathy: 1, corruption: 1 }\n      },\n      {\n        title: \"Fatal Attraction\",\n        narrative: \"They can't get enough of you, even knowing you're dangerous. Perhaps especially because you're dangerous.\",\n        statChanges: { influence: 2, power: 1 / 3, corruption: 2 }\n      },\n      {\n        title: \"Whispered Promises\",\n        narrative: \"Your words paint impossible futures. They believe every lie because they want to.\",\n        statChanges: { influence: 3, control: 2, corruption: 1, wealth: 66 / 3 }\n      },\n      {\n        title: \"Stolen Kisses\",\n        narrative: \"A moment of passion that changes everything. They're yours now, body and soul.\",\n        statChanges: { influence: 2, empathy: 1, wealth: 50 / 3 }\n      },\n      {\n        title: \"Masterful Seducer\",\n        narrative: \"You know exactly what they want, and you deliver it perfectly. They worship you.\",\n        statChanges: { influence: 3, control: 1, corruption: 1, wealth: 100 / 3 }\n      },\n      {\n        title: \"Mystical Attraction\",\n        narrative: \"Something almost supernatural draws them to you. They can't explain why they love you.\",\n        statChanges: { influence: 2, power: 1 / 3, wealth: 33 / 3 }\n      },\n      {\n        title: \"Sweet Surrender\",\n        narrative: \"They give up all resistance. You win them over completely and utterly.\",\n        statChanges: { influence: 2, control: 2, empathy: 1, wealth: 66 / 3 }\n      },\n      {\n        title: \"Honeyed Words\",\n        narrative: \"Your compliments are like poison. Sweet, addictive, and completely toxic.\",\n        statChanges: { influence: 2, corruption: 1, control: 1, wealth: 50 / 3 }\n      }\n    ]\n  },\n\n  // STEALTH & SNEAKING (35+ scenarios)\n  {\n    keywords: ['sneak', 'steal', 'hide', 'lurk', 'shadow', 'creep', 'pickpocket', 'thief', 'infiltrate', 'spy', 'silent'],\n    type: 'survival',\n    outcomes: [\n      {\n        title: \"Shadow Master\",\n        narrative: \"You move like a ghost through the darkness. No one sees you, no one suspects a thing.\",\n        statChanges: { control: 2, wealth: 100 / 3, influence: 1 }\n      },\n      {\n        title: \"Perfect Heist\",\n        narrative: \"You slip past guards, bypass traps, and steal exactly what you came for without a trace.\",\n        statChanges: { control: 2, wealth: 133 / 3, corruption: 1 }\n      },\n      {\n        title: \"Whispered Escape\",\n        narrative: \"You vanish into the night. When they realize what happened, you're already long gone.\",\n        statChanges: { control: 1, wealth: 83 / 3, influence: 1 }\n      },\n      {\n        title: \"Calculated Theft\",\n        narrative: \"Every step planned. Every exit mapped. You execute perfectly, leaving no evidence behind.\",\n        statChanges: { control: 2, wealth: 116 / 3, power: 1 / 3 }\n      },\n      {\n        title: \"Silent Killer\",\n        narrative: \"Your target never even knew you were there. Professional. Clean. Efficient.\",\n        statChanges: { power: 1 / 3, control: 2, corruption: 3, influence: 1 }\n      },\n      {\n        title: \"Invisible Thief\",\n        narrative: \"You become one with the shadows. The guards look right at you and see nothing.\",\n        statChanges: { control: 3, wealth: 83 / 3, power: 1 / 3 }\n      },\n      {\n        title: \"Daring Robbery\",\n        narrative: \"Risky, bold, and absolutely successful. You walk out with what you came for and their respect.\",\n        statChanges: { control: 1, wealth: 166 / 3, power: 1 / 3, influence: 1 }\n      },\n      {\n        title: \"Ghost In The Machine\",\n        narrative: \"You slip through their security like it isn't there. They'll never know what hit them.\",\n        statChanges: { control: 2, wealth: 133 / 3, corruption: 1 }\n      },\n      {\n        title: \"Shadowy Escape\",\n        narrative: \"Discovered, but you're faster. You disappear into the darkness before they can react.\",\n        statChanges: { control: 1, wealth: 66 / 3, power: 1 / 3, health: 1 }\n      },\n      {\n        title: \"Artful Deception\",\n        narrative: \"They never even realized something was stolen. Your skill is so perfect, it's like it was never there.\",\n        statChanges: { control: 2, wealth: 116 / 3, corruption: 1, influence: 1 }\n      },\n      {\n        title: \"Supernatural Stealth\",\n        narrative: \"You exist in the shadows themselves. They literally cannot perceive you.\",\n        statChanges: { control: 3, power: 1 / 3, wealth: 100 / 3 }\n      },\n      {\n        title: \"Vault Breached\",\n        narrative: \"Security meant nothing. You breached the impossible and claimed forbidden treasures.\",\n        statChanges: { control: 3, wealth: 200 / 3, corruption: 1 }\n      },\n      {\n        title: \"Phantom Touch\",\n        narrative: \"You took it right in front of them. They'll never know how.\",\n        statChanges: { control: 2, wealth: 83 / 3, influence: 1 }\n      },\n      {\n        title: \"Unseen Passage\",\n        narrative: \"Secret tunnels, hidden doors, impossible passages. You know them all.\",\n        statChanges: { control: 2, wealth: 66 / 3, influence: 1 }\n      },\n      {\n        title: \"Master of Shadows\",\n        narrative: \"Darkness is your ally. Light cannot touch you when you don't wish it.\",\n        statChanges: { control: 3, power: 1 / 3, wealth: 116 / 3 }\n      }\n    ]\n  },\n\n  // NEGOTIATION & DIPLOMACY (35+ scenarios)\n  {\n    keywords: ['negotiate', 'deal', 'bargain', 'talk', 'convince', 'persuade', 'contract', 'agreement', 'pact', 'trade', 'propose'],\n    type: 'social',\n    outcomes: [\n      {\n        title: \"Master Negotiator\",\n        narrative: \"Words flow like honey. You've got them eating out of your hand before they realize they've already agreed.\",\n        statChanges: { influence: 2, wealth: 133 / 3, control: 1 }\n      },\n      {\n        title: \"Perfect Deal\",\n        narrative: \"Both sides walk away happy. You've created a win-win that leaves everyone richer than before.\",\n        statChanges: { influence: 2, wealth: 100 / 3, empathy: 1 }\n      },\n      {\n        title: \"Outsmart The Opposition\",\n        narrative: \"You see what they want before they do. You dangle it in front of them and take everything in return.\",\n        statChanges: { influence: 3, control: 2, corruption: 1, wealth: 166 / 3 }\n      },\n      {\n        title: \"Convincing Argument\",\n        narrative: \"Your logic is airtight. They can't argue with you. By the end, they thank you for the 'opportunity.'\",\n        statChanges: { influence: 2, wealth: 66 / 3, control: 1 }\n      },\n      {\n        title: \"Demonic Pact\",\n        narrative: \"You lock them into a binding agreement written in darkness itself. They can never back out.\",\n        statChanges: { power: 1 / 3, control: 2, corruption: 2, influence: 1 }\n      },\n      {\n        title: \"Honeyed Words\",\n        narrative: \"Your persuasion is almost magical. They do exactly what you want and believe it was their idea.\",\n        statChanges: { influence: 2, wealth: 83 / 3, corruption: 1 }\n      },\n      {\n        title: \"Iron Will\",\n        narrative: \"You refuse to budge. Your resolve is absolute. Eventually, they cave and accept your terms.\",\n        statChanges: { influence: 1, control: 2, wealth: 100 / 3 }\n      },\n      {\n        title: \"Twisted Deal\",\n        narrative: \"The fine print is deliberately hidden. They think they've won, but you've actually taken everything.\",\n        statChanges: { influence: 2, control: 2, corruption: 3, wealth: 200 / 3 }\n      },\n      {\n        title: \"Mutual Understanding\",\n        narrative: \"You find common ground. Trust is established. This is the beginning of something powerful.\",\n        statChanges: { influence: 2, empathy: 1, wealth: 50 / 3 }\n      },\n      {\n        title: \"Verbal Domination\",\n        narrative: \"Your words are weapons. You dismantle their arguments piece by piece until they surrender.\",\n        statChanges: { influence: 3, control: 1, power: 1 / 3, wealth: 83 / 3 }\n      },\n      {\n        title: \"Silver-Tongued Devil\",\n        narrative: \"You could sell water to a drowning man. Your offer is irresistible.\",\n        statChanges: { influence: 3, wealth: 150 / 3, control: 1 }\n      },\n      {\n        title: \"Alliance Forged\",\n        narrative: \"Through negotiation, two enemies become powerful allies.\",\n        statChanges: { influence: 2, power: 1 / 3, wealth: 66 / 3 }\n      },\n      {\n        title: \"Profitable Compromise\",\n        narrative: \"Everyone leaves richer. Your negotiation skills turned a simple deal into a goldmine.\",\n        statChanges: { influence: 2, wealth: 116 / 3, empathy: 1 }\n      },\n      {\n        title: \"Binding Contract\",\n        narrative: \"The terms are airtight. They're locked into your deal for eternity.\",\n        statChanges: { influence: 3, control: 3, corruption: 1 }\n      },\n      {\n        title: \"Masterful Compromise\",\n        narrative: \"You find the perfect middle ground that satisfies everyone perfectly.\",\n        statChanges: { influence: 2, wealth: 100 / 3, empathy: 1, control: 1 }\n      }\n    ]\n  },\n\n  // MAGIC & DARK POWERS (40+ scenarios)\n  {\n    keywords: ['magic', 'spell', 'curse', 'ritual', 'incantation', 'hex', 'enchant', 'power', 'summon', 'invoke', 'arcane', 'mystical'],\n    type: 'power',\n    minPower: 1,\n    outcomes: [\n      {\n        title: \"Spell Perfection\",\n        narrative: \"Arcane energy flows through you effortlessly. The spell manifests with devastating precision.\",\n        statChanges: { power: 3 / 3, control: 1, corruption: 1 }\n      },\n      {\n        title: \"Dark Incantation\",\n        narrative: \"Forbidden words tear through reality. Something ancient answers your call, hungry for power.\",\n        statChanges: { power: 4 / 3, corruption: 3, control: 1, health: 1 }\n      },\n      {\n        title: \"Ritual Mastery\",\n        narrative: \"Every component perfectly placed, every word perfectly intoned. The magic takes hold absolutely.\",\n        statChanges: { power: 3 / 3, control: 2, corruption: 1 }\n      },\n      {\n        title: \"Cursed Existence\",\n        narrative: \"You weave a curse that will plague them for eternity. Their suffering will be exquisite.\",\n        statChanges: { power: 2 / 3, corruption: 4, influence: 1 }\n      },\n      {\n        title: \"Reality Warping\",\n        narrative: \"The laws of nature bend to your will. The impossible becomes possible through sheer magical force.\",\n        statChanges: { power: 5 / 3, control: 1, corruption: 1, health: 1 }\n      },\n      {\n        title: \"Elegant Casting\",\n        narrative: \"Magic flows like water. Your spells are beautiful in their efficiency and devastating in their effect.\",\n        statChanges: { power: 3 / 3, control: 2, influence: 1 }\n      },\n      {\n        title: \"Demonic Invocation\",\n        narrative: \"You call upon powers best left sleeping. The air grows cold as something answers your summons.\",\n        statChanges: { power: 4 / 3, corruption: 5, control: 1, health: 1 }\n      },\n      {\n        title: \"Protective Ward\",\n        narrative: \"Magic surrounds you like armor. No harm can touch you‚Äîyou're wrapped in power itself.\",\n        statChanges: { power: 2 / 3, control: 2, health: 1 }\n      },\n      {\n        title: \"Chaos Magick\",\n        narrative: \"You abandon all structure. Raw magical chaos erupts, unpredictable and terrifyingly powerful.\",\n        statChanges: { power: 3 / 3, corruption: 2, control: 1 }\n      },\n      {\n        title: \"Arcane Knowledge\",\n        narrative: \"Ancient secrets flood your mind. You understand magic at levels most demons never reach.\",\n        statChanges: { power: 3 / 3, control: 2, corruption: 1, influence: 1 }\n      },\n      {\n        title: \"Spellweaving Mastery\",\n        narrative: \"Multiple spells intertwine perfectly, creating effects greater than the sum of their parts.\",\n        statChanges: { power: 4 / 3, control: 2, influence: 1 }\n      },\n      {\n        title: \"Soul Binding\",\n        narrative: \"You've bound a powerful spirit to your will. It obeys absolutely.\",\n        statChanges: { power: 4 / 3, corruption: 2, control: 3 }\n      },\n      {\n        title: \"Eldritch Knowledge\",\n        narrative: \"You've glimpsed truths that break mortal minds. You're stronger, but less human.\",\n        statChanges: { power: 4 / 3, corruption: 3, control: 1, empathy: 1 }\n      },\n      {\n        title: \"Transmutation Success\",\n        narrative: \"Base materials become precious metals. The impossible transformation is complete.\",\n        statChanges: { power: 2 / 3, wealth: 166 / 3, control: 1 }\n      },\n      {\n        title: \"Magical Amplification\",\n        narrative: \"Your magic is unstoppable. Enemies fall like wheat before the scythe.\",\n        statChanges: { power: 4 / 3, influence: 1, control: 1 }\n      }\n    ]\n  },\n\n  // CORRUPTION & DARKNESS (40+ scenarios)\n  {\n    keywords: ['corrupt', 'dark', 'evil', 'sin', 'torture', 'sadistic', 'cruel', 'dominate', 'enslave', 'consume', 'vile', 'malice'],\n    type: 'dark',\n    minCorruption: 1,\n    outcomes: [\n      {\n        title: \"Complete Corruption\",\n        narrative: \"You embrace the darkness fully. Morality becomes a distant memory as power consumes you.\",\n        statChanges: { corruption: 5, power: 3 / 3, empathy: 1, control: 1 }\n      },\n      {\n        title: \"Inflicted Suffering\",\n        narrative: \"Their pain is exquisite music. You extend their torment, savoring every scream.\",\n        statChanges: { corruption: 4, power: 2 / 3, empathy: 1, influence: 1 }\n      },\n      {\n        title: \"Soul Corruption\",\n        narrative: \"You've twisted someone's very essence. They're no longer who they were‚Äîthey're who you made them.\",\n        statChanges: { corruption: 4, power: 2 / 3, control: 2, empathy: 1 }\n      },\n      {\n        title: \"Darkness Embraced\",\n        narrative: \"All pretense of goodness falls away. You are what you always were‚Äîpure, distilled evil.\",\n        statChanges: { corruption: 5, power: 4 / 3, control: 2, empathy: 1 }\n      },\n      {\n        title: \"Enslaved Will\",\n        narrative: \"Your victim's mind breaks. They serve you now, grateful for the scraps of attention you give them.\",\n        statChanges: { control: 3, corruption: 3, power: 1 / 3, empathy: 1 }\n      },\n      {\n        title: \"Sadistic Pleasure\",\n        narrative: \"Cruelty becomes art. Each act of malice is a brushstroke on your canvas of destruction.\",\n        statChanges: { corruption: 3, power: 2 / 3, wealth: 66 / 3, empathy: 1 }\n      },\n      {\n        title: \"Evil Incarnate\",\n        narrative: \"Something fundamental shifts within you. You've become something worse than demon‚Äîsomething truly evil.\",\n        statChanges: { corruption: 6, power: 4 / 3, control: 3, empathy: 1 }\n      },\n      {\n        title: \"Consuming Hunger\",\n        narrative: \"Your appetite for darkness is insatiable. You devour souls, power, and innocence itself.\",\n        statChanges: { corruption: 4, power: 3 / 3, health: 1, empathy: 1 }\n      },\n      {\n        title: \"Demonic Ascension\",\n        narrative: \"You shed your last shreds of humanity. What emerges is something ancient, powerful, and utterly vile.\",\n        statChanges: { corruption: 5, power: 5 / 3, influence: 1, empathy: 1 }\n      },\n      {\n        title: \"Twisted Joy\",\n        narrative: \"Evil feels good. Every cruel act fills you with joy. You're finally free to be what you truly are.\",\n        statChanges: { corruption: 4, power: 2 / 3, wealth: 83 / 3, empathy: 1 }\n      },\n      {\n        title: \"Malevolent Aura\",\n        narrative: \"Darkness radiates from you. People feel fear in your presence, instinctively knowing you're wrong.\",\n        statChanges: { corruption: 4, power: 3 / 3, control: 2, influence: 1 }\n      },\n      {\n        title: \"Atrocity Committed\",\n        narrative: \"The depths of your cruelty know no bounds. History will remember your name in terror.\",\n        statChanges: { corruption: 6, power: 4 / 3, empathy: 1, influence: 2 }\n      },\n      {\n        title: \"Broken Spirit\",\n        narrative: \"You've destroyed something fundamental in them. They're just an empty shell now.\",\n        statChanges: { corruption: 3, power: 1 / 3, empathy: 1, control: 2 }\n      },\n      {\n        title: \"Tyrannical Rule\",\n        narrative: \"Through fear and cruelty, you've built an empire of suffering.\",\n        statChanges: { corruption: 4, power: 3 / 3, control: 3, empathy: 1 }\n      },\n      {\n        title: \"Forbidden Desires\",\n        narrative: \"You've indulged in pleasures so dark they've changed you permanently.\",\n        statChanges: { corruption: 4, power: 2 / 3, wealth: 100 / 3, empathy: 1 }\n      }\n    ]\n  },\n\n  // REDEMPTION & GOODNESS (35+ scenarios)\n  {\n    keywords: ['help', 'save', 'redeem', 'protect', 'forgive', 'love', 'compassion', 'sacrifice', 'hope', 'atone', 'mercy', 'noble'],\n    type: 'redemption',\n    minCorruption: 1,\n    outcomes: [\n      {\n        title: \"Act of Redemption\",\n        narrative: \"You choose goodness despite your nature. Light blooms within you, burning away corruption.\",\n        statChanges: { empathy: 3, corruption: 1, influence: 1, control: 1 }\n      },\n      {\n        title: \"Selfless Sacrifice\",\n        narrative: \"You give up something precious to save another. The act transforms you in ways you didn't expect.\",\n        statChanges: { empathy: 4, corruption: 1, power: 1 / 3, influence: 1 }\n      },\n      {\n        title: \"Hope Restored\",\n        narrative: \"Your action proves that change is possible. You become a beacon of hope in the darkness.\",\n        statChanges: { empathy: 5, corruption: 1, influence: 2, wealth: 50 / 3 }\n      },\n      {\n        title: \"Forgiveness Granted\",\n        narrative: \"You forgive even when you have every right to punish. Grace flows through you like water.\",\n        statChanges: { empathy: 4, corruption: 1, control: 1, wealth: 16 / 3 }\n      },\n      {\n        title: \"Love Conquers\",\n        narrative: \"Pure, genuine love manifests through your actions. It touches something divine in this hellish place.\",\n        statChanges: { empathy: 5, corruption: 1, influence: 1, wealth: 100 / 3 }\n      },\n      {\n        title: \"Protection Offered\",\n        narrative: \"You stand between the innocent and harm. Your strength becomes a shield for the vulnerable.\",\n        statChanges: { empathy: 3, control: 1, power: 1 / 3, influence: 1 }\n      },\n      {\n        title: \"Compassion Awakens\",\n        narrative: \"You see their pain and truly understand. Empathy floods you, changing your perspective forever.\",\n        statChanges: { empathy: 4, corruption: 1, control: 1, influence: 1 }\n      },\n      {\n        title: \"Heavenly Light\",\n        narrative: \"Something holy blooms within you. The darkness that defined you begins to crack and fade.\",\n        statChanges: { empathy: 6, corruption: 1, power: 1 / 3, influence: 1 }\n      },\n      {\n        title: \"Changed Heart\",\n        narrative: \"You're not the monster you once were. Genuine change has taken root deep within your soul.\",\n        statChanges: { empathy: 4, corruption: 1, control: 1, influence: 1 }\n      },\n      {\n        title: \"Salvation Found\",\n        narrative: \"Maybe redemption was possible after all. Hope isn't just a dream‚Äîit's becoming your reality.\",\n        statChanges: { empathy: 6, corruption: 1, influence: 2, power: 1 / 3 }\n      },\n      {\n        title: \"Second Chance Taken\",\n        narrative: \"You could have gone back to darkness, but instead you chose light.\",\n        statChanges: { empathy: 4, corruption: 1, influence: 1, control: 1 }\n      },\n      {\n        title: \"Life Saved\",\n        narrative: \"Someone lives today because you chose to help. It matters more than you know.\",\n        statChanges: { empathy: 3, corruption: 1, influence: 1 }\n      },\n      {\n        title: \"Moral Victory\",\n        narrative: \"You've proven that evil doesn't define you. Your choice to be better is powerful.\",\n        statChanges: { empathy: 4, corruption: 1, control: 1, influence: 1 }\n      },\n      {\n        title: \"Acts of Kindness\",\n        narrative: \"Small kindnesses add up. You're genuinely making the world better.\",\n        statChanges: { empathy: 3, corruption: 1, influence: 1 }\n      },\n      {\n        title: \"Divine Favor\",\n        narrative: \"Your redemption is real. Even the heavens take notice of your change.\",\n        statChanges: { empathy: 5, corruption: 1, influence: 2, power: 1 / 3 }\n      }\n    ]\n  },\n\n  // SURVIVAL & INSTINCT (35+ scenarios)\n  {\n    keywords: ['run', 'escape', 'survive', 'hide', 'flee', 'evade', 'dodge', 'duck', 'retreat', 'abandon', 'endure', 'adapt'],\n    type: 'survival',\n    outcomes: [\n      {\n        title: \"Narrow Escape\",\n        narrative: \"Death grazes your shoulder as you slip away. A moment slower and you'd be finished.\",\n        statChanges: { control: 1, health: 1, power: 1 / 3 }\n      },\n      {\n        title: \"Desperate Flight\",\n        narrative: \"You run faster than you ever have. The mob falls further behind with every desperate bound.\",\n        statChanges: { control: 1, health: 1, wealth: 50 / 3 }\n      },\n      {\n        title: \"Perfect Evasion\",\n        narrative: \"You knew the alley would open up ahead. They didn't. You escape clean.\",\n        statChanges: { control: 2, influence: 1 }\n      },\n      {\n        title: \"Lucky Survival\",\n        narrative: \"A fortuitous crack in the wall. A moment of inattention from your pursuer. Luck saves you.\",\n        statChanges: { control: 1, health: 1 }\n      },\n      {\n        title: \"Cunning Escape\",\n        narrative: \"You leave a false trail that sends them the wrong way. By the time they realize, you're gone.\",\n        statChanges: { control: 2, influence: 1, corruption: 1 }\n      },\n      {\n        title: \"Magical Vanishing\",\n        narrative: \"Arcane energy envelops you. You fade from sight just as they close in.\",\n        statChanges: { power: 1 / 3, control: 1, health: 1 }\n      },\n      {\n        title: \"Bold Stand\",\n        narrative: \"You stop running and turn to face them. They weren't expecting a counter‚Äîand neither were you.\",\n        statChanges: { control: 1, power: 1 / 3, health: 1 }\n      },\n      {\n        title: \"Underground Refuge\",\n        narrative: \"You duck into the tunnels beneath Pentagram City. They'll never find you down here.\",\n        statChanges: { control: 1, influence: 1 }\n      },\n      {\n        title: \"Deceptive Misdirection\",\n        narrative: \"You leave your coat in an alley while you slip through shadows. They chase the coat.\",\n        statChanges: { control: 2, influence: 1, corruption: 1 }\n      },\n      {\n        title: \"Sacrificial Distraction\",\n        narrative: \"You cause a chaos that draws attention away. It costs you, but you escape.\",\n        statChanges: { control: 1, wealth: 200 / 3, empathy: 1 }\n      },\n      {\n        title: \"Master Dodger\",\n        narrative: \"Every attack misses. You move with impossible grace, making them look foolish.\",\n        statChanges: { control: 2, influence: 1 }\n      },\n      {\n        title: \"Impossible Parkour\",\n        narrative: \"Jumping, climbing, defying gravity itself. You escape through maneuvers they can't follow.\",\n        statChanges: { control: 2, power: 1 / 3, health: 1 }\n      },\n      {\n        title: \"Hidden Haven\",\n        narrative: \"You know a place where they'll never find you. It becomes your sanctuary.\",\n        statChanges: { control: 2, influence: 1 }\n      },\n      {\n        title: \"Last Minute Reprieve\",\n        narrative: \"Just when all seems lost, opportunity strikes. You slip away in the chaos.\",\n        statChanges: { control: 1, influence: 1 }\n      },\n      {\n        title: \"Survivor's Luck\",\n        narrative: \"Against all odds, you make it. Somehow, you always do.\",\n        statChanges: { control: 1, health: 1 }\n      }\n    ]\n  },\n\n  // MANIPULATION & CONTROL (35+ scenarios)\n  {\n    keywords: ['manipulate', 'control', 'dominate', 'puppet', 'blackmail', 'coerce', 'threaten', 'bribe', 'leverage', 'scheme', 'command'],\n    type: 'manipulation',\n    outcomes: [\n      {\n        title: \"Puppet Master\",\n        narrative: \"They dance to your tune without even realizing there are strings. You are the master of their fate.\",\n        statChanges: { control: 3, influence: 2, corruption: 2, power: 1 / 3 }\n      },\n      {\n        title: \"Blackmail Success\",\n        narrative: \"One secret. That's all you needed. Now they'll do anything to keep it hidden.\",\n        statChanges: { control: 2, wealth: 116 / 3, corruption: 2, influence: 1 }\n      },\n      {\n        title: \"Information Extraction\",\n        narrative: \"You know exactly what to say to make them spill everything. Pressure applied perfectly.\",\n        statChanges: { control: 2, influence: 1, corruption: 1 }\n      },\n      {\n        title: \"Psychological Warfare\",\n        narrative: \"You break them mentally. They're yours now, their will shattered, their mind yours to use.\",\n        statChanges: { control: 3, power: 1 / 3, corruption: 2, empathy: 1 }\n      },\n      {\n        title: \"Coercive Persuasion\",\n        narrative: \"The threats are subtle but crystal clear. They understand what happens if they disobey.\",\n        statChanges: { control: 2, influence: 1, corruption: 1, power: 1 / 3 }\n      },\n      {\n        title: \"Strategic Bribery\",\n        narrative: \"Everyone has a price. You found theirs. Now they're working for you.\",\n        statChanges: { control: 2, wealth: 300 / 3, influence: 2, corruption: 1 }\n      },\n      {\n        title: \"Web of Lies\",\n        narrative: \"Half-truths and outright fabrications weave a web that traps them completely.\",\n        statChanges: { control: 3, influence: 1, corruption: 2 }\n      },\n      {\n        title: \"Enforced Compliance\",\n        narrative: \"Through a combination of threats and violence, you've made your demands very clear.\",\n        statChanges: { control: 2, power: 1 / 3, corruption: 3, health: 1 }\n      },\n      {\n        title: \"Emotional Leverage\",\n        narrative: \"You know their weaknesses‚Äîwhat they love, what they fear. You exploit it mercilessly.\",\n        statChanges: { control: 3, influence: 2, corruption: 2, empathy: 1 }\n      },\n      {\n        title: \"Complete Domination\",\n        narrative: \"They're not just following your orders‚Äîthey're grateful to have you tell them what to do.\",\n        statChanges: { control: 3, influence: 2, corruption: 3, power: 1 / 3 }\n      },\n      {\n        title: \"Corporate Takeover\",\n        narrative: \"Through manipulation, you've gained control of an entire organization.\",\n        statChanges: { control: 3, influence: 3, wealth: 133 / 3, corruption: 1 }\n      },\n      {\n        title: \"Subtle Corruption\",\n        narrative: \"You didn't force them‚Äîyou just suggested. Now they're doing terrible things willingly.\",\n        statChanges: { control: 3, corruption: 3, influence: 2, empathy: 1 }\n      },\n      {\n        title: \"Debt Master\",\n        narrative: \"Through debt and obligation, you've trapped them in a cycle they can't escape.\",\n        statChanges: { control: 2, wealth: 100 / 3, influence: 1, corruption: 2 }\n      },\n      {\n        title: \"Mind Games\",\n        narrative: \"You've turned their own insecurities against them. They're paralyzed by doubt.\",\n        statChanges: { control: 3, influence: 1, corruption: 2 }\n      },\n      {\n        title: \"Authority Seized\",\n        narrative: \"Through cunning and manipulation, you've taken command.\",\n        statChanges: { control: 3, influence: 3, power: 1 / 3, corruption: 2 }\n      }\n    ]\n  },\n\n  // EXPLORATION & DISCOVERY (40+ scenarios)\n  {\n    keywords: ['explore', 'discover', 'investigate', 'search', 'find', 'uncover', 'seek', 'quest', 'venture', 'expedition'],\n    type: 'exploration',\n    outcomes: [\n      {\n        title: \"Treasure Found\",\n        narrative: \"Hidden beneath rubble and guarded by forgotten magic, you discover wealth beyond imagination.\",\n        statChanges: { wealth: 200, influence: 1, control: 1 }\n      },\n      {\n        title: \"Ancient Knowledge\",\n        narrative: \"Forbidden texts reveal secrets of creation itself. Power untapped for eons is now yours to wield.\",\n        statChanges: { power: 2 / 3, control: 1, corruption: 1 }\n      },\n      {\n        title: \"Lost City\",\n        narrative: \"Behind an impossible wall lies a city frozen in time. Its resources are legendary.\",\n        statChanges: { wealth: 133, influence: 1, power: 1 / 3 }\n      },\n      {\n        title: \"Dangerous Artifact\",\n        narrative: \"You find something powerful and incredibly dangerous. One wrong move could doom you.\",\n        statChanges: { power: 3 / 3, control: 1, corruption: 1, health: 1 }\n      },\n      {\n        title: \"Secret Alliance\",\n        narrative: \"In hidden chambers, you find powerful allies waiting. Together, you could shake Hell itself.\",\n        statChanges: { influence: 2, wealth: 66 / 3, power: 1 / 3 }\n      },\n      {\n        title: \"Dark Secret\",\n        narrative: \"You uncover a truth so terrible that knowing it changes you. The weight of it settles on you.\",\n        statChanges: { control: 1, corruption: 1, empathy: 1, influence: 1 }\n      },\n      {\n        title: \"Hidden Sanctuary\",\n        narrative: \"You find a place of peace in the heart of Hell. It becomes your refuge.\",\n        statChanges: { control: 1, empathy: 1, health: 3 }\n      },\n      {\n        title: \"Cursed Riches\",\n        narrative: \"Gold and jewels are everywhere, but they're cursed. Taking them feels like a terrible mistake.\",\n        statChanges: { wealth: 166, corruption: 2, power: 1 / 3, health: 1 }\n      },\n      {\n        title: \"Forbidden Library\",\n        narrative: \"Infinite knowledge contained in one impossible place. You could study for lifetimes.\",\n        statChanges: { power: 2 / 3, control: 2, influence: 1 }\n      },\n      {\n        title: \"Way Out\",\n        narrative: \"You discover a passage that might lead beyond Hell. Hope and fear war within you.\",\n        statChanges: { influence: 1, empathy: 1, control: 1, corruption: 1 }\n      },\n      {\n        title: \"Underground Empire\",\n        narrative: \"An entire civilization thrives beneath the surface. You've found a new world.\",\n        statChanges: { wealth: 233, influence: 2, power: 1 / 3 }\n      },\n      {\n        title: \"Celestial Device\",\n        narrative: \"An artifact of heavenly origin. Its power could reshape reality itself.\",\n        statChanges: { power: 5 / 3, control: 1, influence: 2, corruption: 1 }\n      },\n      {\n        title: \"Hidden Graves\",\n        narrative: \"Ancient burial chambers contain forgotten warriors and untold riches.\",\n        statChanges: { wealth: 133, power: 1 / 3, corruption: 2 }\n      },\n      {\n        title: \"Lost Knowledge\",\n        narrative: \"You've found information that rewrites history. The truth is yours.\",\n        statChanges: { influence: 3, control: 2, power: 1 / 3 }\n      },\n      {\n        title: \"Portal Discovered\",\n        narrative: \"A gateway to another realm. What lies beyond is both terrifying and wondrous.\",\n        statChanges: { power: 3 / 3, control: 2, influence: 1, corruption: 1 }\n      }\n    ]\n  },\n\n  // WEALTH & GREED (40+ scenarios)\n  {\n    keywords: ['money', 'wealth', 'rich', 'steal', 'rob', 'greedy', 'greed', 'lucrative', 'profit', 'gain', 'business'],\n    type: 'social',\n    outcomes: [\n      {\n        title: \"Financial Empire\",\n        narrative: \"Your business acumen is unmatched. Wealth flows to you from multiple sources.\",\n        statChanges: { wealth: 233, influence: 1, control: 1 }\n      },\n      {\n        title: \"Lucrative Scheme\",\n        narrative: \"A brilliant business idea becomes wildly profitable. Soon, you're rolling in cash.\",\n        statChanges: { wealth: 183, control: 1, corruption: 1 }\n      },\n      {\n        title: \"Grand Heist\",\n        narrative: \"A perfectly executed robbery nets you more gold than you've ever seen.\",\n        statChanges: { wealth: 200, control: 2, corruption: 1, health: 1 }\n      },\n      {\n        title: \"Corporate Takeover\",\n        narrative: \"You quietly consolidate power and take over a massive enterprise. It's yours now.\",\n        statChanges: { wealth: 166, influence: 2, control: 2, corruption: 1 }\n      },\n      {\n        title: \"Extortion Operation\",\n        narrative: \"Fear is a commodity, and you're the dealer. Regular payments pour in.\",\n        statChanges: { wealth: 133, control: 2, corruption: 3, influence: 1 }\n      },\n      {\n        title: \"Investment Success\",\n        narrative: \"Every investment you make turns to gold. Your reputation as a financial genius grows.\",\n        statChanges: { wealth: 150, influence: 1, control: 1 }\n      },\n      {\n        title: \"Black Market Trading\",\n        narrative: \"Forbidden goods flow through your network. Profit margins are obscene.\",\n        statChanges: { wealth: 166, corruption: 2, influence: 1, power: 1 / 3 }\n      },\n      {\n        title: \"Debt Collection\",\n        narrative: \"You hunt down every penny owed to you. Nobody withholds from you twice.\",\n        statChanges: { wealth: 116, control: 2, corruption: 2, power: 1 / 3 }\n      },\n      {\n        title: \"Con Artist\",\n        narrative: \"Your schemes are elaborate and foolproof. Mark after mark falls into your traps.\",\n        statChanges: { wealth: 160, control: 2, corruption: 2, influence: 1 }\n      },\n      {\n        title: \"Mob Money\",\n        narrative: \"You've earned the favor of powerful interests. Protection and profit go hand in hand.\",\n        statChanges: { wealth: 183, power: 1 / 3, control: 1, corruption: 3, influence: 1 }\n      },\n      {\n        title: \"Treasure Hoard\",\n        narrative: \"Your vault is overflowing with riches. You're wealthier than most kingdoms.\",\n        statChanges: { wealth: 266, influence: 2, control: 1 }\n      },\n      {\n        title: \"Monopoly Established\",\n        narrative: \"You control the supply. They have no choice but to pay your prices.\",\n        statChanges: { wealth: 200, influence: 2, control: 2, corruption: 2 }\n      },\n      {\n        title: \"Lucky Windfall\",\n        narrative: \"Chance and fate smile upon you. Suddenly, you're vastly wealthier.\",\n        statChanges: { wealth: 166, control: 1 }\n      },\n      {\n        title: \"Lucrative Trade\",\n        narrative: \"You found the perfect market gap. Profits are astronomical.\",\n        statChanges: { wealth: 183, influence: 1, control: 1 }\n      },\n      {\n        title: \"Fortune Tripled\",\n        narrative: \"Through skill and cunning, your wealth has tripled.\",\n        statChanges: { wealth: 233, control: 1, influence: 1 }\n      }\n    ]\n  },\n\n  // VIOLENCE & CONQUEST (35+ scenarios)\n  {\n    keywords: ['conquer', 'take over', 'territory', 'dominate', 'rule', 'expand', 'claim', 'seize', 'overthrow', 'war', 'invade'],\n    type: 'power',\n    outcomes: [\n      {\n        title: \"Territory Conquered\",\n        narrative: \"Through force and cunning, new lands bow before you. Your domain expands exponentially.\",\n        statChanges: { power: 4 / 3, influence: 2, control: 2, wealth: 100 / 3, corruption: 1 }\n      },\n      {\n        title: \"Bloody Triumph\",\n        narrative: \"Opposition was crushed beneath your heel. Now, all yield to your rule.\",\n        statChanges: { power: 4 / 3, influence: 2, corruption: 4, health: 1, wealth: 66 / 3 }\n      },\n      {\n        title: \"Strategic Conquest\",\n        narrative: \"You took the territory without unnecessary bloodshed. Everyone respects that.\",\n        statChanges: { power: 3 / 3, control: 3, influence: 2, wealth: 83 / 3 }\n      },\n      {\n        title: \"Tyrannical Rule\",\n        narrative: \"You've become an absolute tyrant. Fear keeps your subjects in line.\",\n        statChanges: { power: 3 / 3, control: 3, corruption: 4, influence: 2, empathy: 1 }\n      },\n      {\n        title: \"Empire Building\",\n        narrative: \"One territory down, dozens more to go. Your empire is just beginning.\",\n        statChanges: { influence: 3, power: 3 / 3, control: 2, wealth: 133 / 3 }\n      },\n      {\n        title: \"Mercenary Deployment\",\n        narrative: \"You hired the best killers Hell has to offer. The battle was swift and devastating.\",\n        statChanges: { power: 2 / 3, wealth: 250 / 3, influence: 2, control: 1 }\n      },\n      {\n        title: \"Psychological Conquest\",\n        narrative: \"You broke their will before battle even started. They surrendered without fighting.\",\n        statChanges: { influence: 3, control: 2, power: 2 / 3, corruption: 2 }\n      },\n      {\n        title: \"Magical Dominion\",\n        narrative: \"Reality itself warps to your will. Your enemies couldn't oppose you even if they wanted to.\",\n        statChanges: { power: 5 / 3, control: 2, corruption: 2, health: 1 }\n      },\n      {\n        title: \"Fragile Peace\",\n        narrative: \"You've conquered through force, but must now maintain control through even greater strength.\",\n        statChanges: { power: 3 / 3, control: 2, influence: 1, corruption: 1 }\n      },\n      {\n        title: \"Kingdom Claimed\",\n        narrative: \"You've done it. You're now a ruler of Hell itself, with everything that comes with it.\",\n        statChanges: { power: 4 / 3, influence: 4, control: 3, wealth: 166 / 3, corruption: 2 }\n      },\n      {\n        title: \"Legendary Victory\",\n        narrative: \"Your victory is so complete, so decisive, they'll sing songs about it for centuries.\",\n        statChanges: { power: 5 / 3, influence: 4, wealth: 133 / 3, control: 3 }\n      },\n      {\n        title: \"Blitzkrieg Success\",\n        narrative: \"Lightning fast, overwhelming force. They never stood a chance.\",\n        statChanges: { power: 4 / 3, control: 2, influence: 2, wealth: 100 / 3 }\n      },\n      {\n        title: \"Siege Mastery\",\n        narrative: \"You've laid siege to their stronghold and broken their will to resist.\",\n        statChanges: { power: 3 / 3, control: 2, influence: 2, wealth: 83 / 3 }\n      },\n      {\n        title: \"Final Victory\",\n        narrative: \"The last obstacle is gone. The territory is yours completely.\",\n        statChanges: { power: 4 / 3, influence: 3, control: 2, wealth: 116 / 3 }\n      },\n      {\n        title: \"Unstoppable Expansion\",\n        narrative: \"Your momentum is impossible to stop. Each victory fuels the next.\",\n        statChanges: { power: 4 / 3, influence: 3, wealth: 133 / 3, control: 2 }\n      }\n    ]\n  },\n\n  // BETRAYAL & DECEPTION (35+ scenarios)\n  {\n    keywords: ['betray', 'backstab', 'lie', 'deceive', 'trick', 'cheat', 'double-cross', 'fool', 'deceive', 'scheme'],\n    type: 'manipulation',\n    outcomes: [\n      {\n        title: \"Perfect Betrayal\",\n        narrative: \"They trusted you completely. That makes the knife in their back all the more devastating.\",\n        statChanges: { control: 3, corruption: 4, power: 1 / 3, influence: 1, empathy: 1 }\n      },\n      {\n        title: \"Elaborate Deception\",\n        narrative: \"Your lie was so perfect, so intricate, that they'll never figure out the truth.\",\n        statChanges: { control: 3, corruption: 2, influence: 2, wealth: 100 / 3 }\n      },\n      {\n        title: \"Double Agent\",\n        narrative: \"Playing both sides perfectly. Neither realizes you're working for the other.\",\n        statChanges: { control: 3, influence: 2, wealth: 133 / 3, corruption: 3 }\n      },\n      {\n        title: \"Stolen Identity\",\n        narrative: \"You wore their face, lived their life, and destroyed everything they had from the inside.\",\n        statChanges: { control: 3, corruption: 3, power: 1 / 3, influence: 1 }\n      },\n      {\n        title: \"Confidence Shattered\",\n        narrative: \"Your betrayal has broken something in them. They'll never trust anyone again.\",\n        statChanges: { corruption: 3, influence: 1, empathy: 1, control: 2 }\n      },\n      {\n        title: \"Alliance Turned\",\n        narrative: \"Their allies are now your allies. You've stolen their entire power structure through cunning.\",\n        statChanges: { influence: 4, control: 3, power: 2 / 3, corruption: 3 }\n      },\n      {\n        title: \"Masterful Gambit\",\n        narrative: \"A complex series of lies finally pays off. Everything fell into place exactly as planned.\",\n        statChanges: { control: 3, influence: 2, wealth: 116 / 3, corruption: 2 }\n      },\n      {\n        title: \"Poisoned Friendship\",\n        narrative: \"You weaponized their love against them. They destroyed themselves for you.\",\n        statChanges: { control: 3, corruption: 4, empathy: 1, influence: 1 }\n      },\n      {\n        title: \"Forged Evidence\",\n        narrative: \"False documents and manipulated witnesses convince everyone of your lies.\",\n        statChanges: { control: 3, influence: 2, corruption: 2, wealth: 66 / 3 }\n      },\n      {\n        title: \"Conspiracy Executed\",\n        narrative: \"Years of careful planning culminate in a single, devastating moment of truth.\",\n        statChanges: { control: 4, influence: 3, power: 1 / 3, corruption: 3, wealth: 133 / 3 }\n      },\n      {\n        title: \"Fake Death\",\n        narrative: \"You faked your demise. Now they mourn while you operate from the shadows.\",\n        statChanges: { control: 3, corruption: 3, influence: 2, wealth: 83 / 3 }\n      },\n      {\n        title: \"Seduced and Betrayed\",\n        narrative: \"Love was the weapon. Broken hearts are your greatest achievements.\",\n        statChanges: { influence: 3, corruption: 3, control: 2, empathy: 1 }\n      },\n      {\n        title: \"Sold Out\",\n        narrative: \"You sold them out to the highest bidder. It was a lucrative decision.\",\n        statChanges: { wealth: 166, control: 2, corruption: 4, influence: 1 }\n      },\n      {\n        title: \"Inside Man\",\n        narrative: \"You've been their inside operative all along. The organization falls from within.\",\n        statChanges: { control: 3, influence: 3, power: 2 / 3, corruption: 3 }\n      },\n      {\n        title: \"Legendary Treachery\",\n        narrative: \"Your betrayal is so complete, so final, that it will be remembered forever.\",\n        statChanges: { control: 4, corruption: 4, influence: 3, power: 1 / 3, empathy: 1 }\n      }\n    ]\n  },\n\n  // COLLABORATION & ALLIANCE (30+ scenarios)\n  {\n    keywords: ['team up', 'ally', 'cooperate', 'join', 'partnership', 'together', 'unite', 'combine', 'group', 'band', 'fellowship'],\n    type: 'social',\n    outcomes: [\n      {\n        title: \"Powerful Alliance\",\n        narrative: \"Together, you're unstoppable. Combined, your power is greater than the sum of parts.\",\n        statChanges: { influence: 3, power: 2 / 3, wealth: 100 / 3, empathy: 1 }\n      },\n      {\n        title: \"United Front\",\n        narrative: \"Your enemies don't stand a chance against your unified force.\",\n        statChanges: { power: 3 / 3, influence: 3, control: 1 }\n      },\n      {\n        title: \"Found Family\",\n        narrative: \"Bound by more than strategy now. These are the people you'd die for.\",\n        statChanges: { empathy: 2, influence: 2, wealth: 66 / 3 }\n      },\n      {\n        title: \"Strategic Partnership\",\n        narrative: \"Each party brings unique skills. Together, you cover every base.\",\n        statChanges: { influence: 2, wealth: 133 / 3, control: 1 }\n      },\n      {\n        title: \"Unified Conquest\",\n        narrative: \"With these allies at your side, nothing in Hell is beyond your reach.\",\n        statChanges: { power: 4 / 3, influence: 3, wealth: 116 / 3, control: 2 }\n      },\n      {\n        title: \"Mutual Respect\",\n        narrative: \"You've found equals. True peers who challenge and inspire you.\",\n        statChanges: { influence: 2, empathy: 1, control: 1 }\n      },\n      {\n        title: \"Hidden Network\",\n        narrative: \"A secret society of powerful individuals. You're now part of something ancient.\",\n        statChanges: { influence: 4, power: 1 / 3, wealth: 166 / 3, control: 1 }\n      },\n      {\n        title: \"Synergistic Bond\",\n        narrative: \"Your combined abilities create something neither of you could achieve alone.\",\n        statChanges: { power: 3 / 3, influence: 3, control: 2, empathy: 1 }\n      },\n      {\n        title: \"Blood Oath\",\n        narrative: \"Bound by magic and oath, you're connected for eternity. Loyalty runs deep.\",\n        statChanges: { influence: 3, power: 2 / 3, control: 2, corruption: 1 }\n      },\n      {\n        title: \"Unstoppable Force\",\n        narrative: \"History will remember what you accomplish together. Hell itself trembles.\",\n        statChanges: { power: 5 / 3, influence: 4, wealth: 133 / 3, control: 2 }\n      }\n    ]\n  },\n\n  // POWER GAIN & EVOLUTION (30+ scenarios)\n  {\n    keywords: ['power up', 'evolve', 'transcend', 'transform', 'ascend', 'unleash', 'awaken', 'grow', 'strengthen', 'consume'],\n    type: 'power',\n    outcomes: [\n      {\n        title: \"Ultimate Transformation\",\n        narrative: \"You've transcended your previous limitations. You're something greater now.\",\n        statChanges: { power: 6 / 3, control: 3, corruption: 2, health: 3 }\n      },\n      {\n        title: \"Ascended Being\",\n        narrative: \"You've become more demon than anything else. Your power is now absolute.\",\n        statChanges: { power: 6 / 3, influence: 3, control: 2, corruption: 3 }\n      },\n      {\n        title: \"Evolution Complete\",\n        narrative: \"The cocoon breaks. What emerges is stronger, faster, deadlier.\",\n        statChanges: { power: 5 / 3, control: 3, health: 5, wealth: 66 / 3 }\n      },\n      {\n        title: \"Consumed Essence\",\n        narrative: \"You absorbed your enemy's power. Now their strength is yours.\",\n        statChanges: { power: 4 / 3, corruption: 2, control: 2, health: 1 }\n      },\n      {\n        title: \"Awakened Potential\",\n        narrative: \"Abilities you didn't know you had suddenly manifest. You're far more capable than you realized.\",\n        statChanges: { power: 5 / 3, control: 2, influence: 1 }\n      },\n      {\n        title: \"Divine Ascension\",\n        narrative: \"You're no longer fully demon. Something heavenly has touched you.\",\n        statChanges: { power: 4 / 3, empathy: 3, corruption: 1, influence: 2 }\n      },\n      {\n        title: \"Demonic Perfection\",\n        narrative: \"All your training culminates in perfection. You're the ideal demon warrior.\",\n        statChanges: { power: 5 / 3, control: 4, corruption: 2 }\n      },\n      {\n        title: \"Godlike Status\",\n        narrative: \"Few things in Hell can challenge you now. You're approaching godhood.\",\n        statChanges: { power: 6 / 3, influence: 4, control: 3, wealth: 100 / 3 }\n      },\n      {\n        title: \"Primal Awakening\",\n        narrative: \"Ancient, bestial power stirs within you. Instinct overwhelms reason.\",\n        statChanges: { power: 5 / 3, corruption: 4, control: 1, health: 1 }\n      },\n      {\n        title: \"Pinnacle Reached\",\n        narrative: \"You've reached the peak of power. Further ascension seems impossible.\",\n        statChanges: { power: 6 / 3, control: 3, influence: 3, corruption: 2 }\n      }\n    ]\n  },\n\n  // LEARNING & TRAINING (25+ scenarios)\n  {\n    keywords: ['train', 'practice', 'learn', 'study', 'meditate', 'discipline', 'master', 'improve', 'develop', 'refine'],\n    type: 'power',\n    outcomes: [\n      {\n        title: \"Breakthrough Training Session\",\n        narrative: \"Hours of intense training suddenly click. New techniques become second nature.\",\n        statChanges: { power: 2 / 3, control: 2, health: 1 }\n      },\n      {\n        title: \"Mentor's Wisdom\",\n        narrative: \"An elder shares ancient knowledge. You absorb years of experience in moments.\",\n        statChanges: { power: 2 / 3, control: 2, influence: 1 }\n      },\n      {\n        title: \"Self-Discovery\",\n        narrative: \"Through meditation, you unlock hidden aspects of yourself.\",\n        statChanges: { control: 2, empathy: 1, power: 1 / 3 }\n      },\n      {\n        title: \"Grueling Regimen\",\n        narrative: \"You push yourself to the absolute limit. Growth through suffering.\",\n        statChanges: { power: 3 / 3, health: 1, corruption: 1 }\n      },\n      {\n        title: \"Gradual Mastery\",\n        narrative: \"Small, consistent improvements add up. You're becoming a true master.\",\n        statChanges: { power: 1 / 3, control: 2, health: 1 }\n      }\n    ]\n  },\n\n  // DEALS & BARGAINS (20+ scenarios)\n  {\n    keywords: ['deal', 'contract', 'bargain', 'offer', 'negotiate', 'trade', 'exchange', 'sell', 'agreement'],\n    type: 'manipulation',\n    outcomes: [\n      {\n        title: \"Favorable Exchange\",\n        narrative: \"You strike a deal that heavily favors you. Your negotiation skills are unmatched.\",\n        statChanges: { wealth: 166, control: 1, influence: 1, corruption: 1 }\n      },\n      {\n        title: \"Soul Debt\",\n        narrative: \"You make a deal that requires payment in spiritual essence. Worth it though.\",\n        statChanges: { wealth: 100, corruption: 2, power: 1 / 3, health: 1 }\n      },\n      {\n        title: \"Mutual Benefit\",\n        narrative: \"Both parties walk away satisfied. An honest deal in a dishonest place.\",\n        statChanges: { wealth: 66, influence: 2, empathy: 1 }\n      },\n      {\n        title: \"Gambled and Won\",\n        narrative: \"You wagered everything on this deal. The odds were against you, but luck favors the bold.\",\n        statChanges: { wealth: 266, control: 1, corruption: 1 }\n      }\n    ]\n  },\n\n  // EXPLORATION & DISCOVERY (25+ scenarios)\n  {\n    keywords: ['explore', 'discover', 'venture', 'search', 'find', 'uncover', 'locate', 'investigate', 'traverse', 'journey'],\n    type: 'exploration',\n    outcomes: [\n      {\n        title: \"Hidden Treasure\",\n        narrative: \"Deep in forgotten places, you find wealth beyond measure.\",\n        statChanges: { wealth: 333, power: 1 / 3, control: 1 }\n      },\n      {\n        title: \"Ancient Knowledge\",\n        narrative: \"You discover forbidden texts containing incredible secrets.\",\n        statChanges: { power: 2 / 3, control: 2, corruption: 1 }\n      },\n      {\n        title: \"Lost Sanctuary\",\n        narrative: \"A place of pure peace. You meditate and emerge renewed.\",\n        statChanges: { health: 10, empathy: 1, corruption: 1 }\n      },\n      {\n        title: \"Danger Zone\",\n        narrative: \"You venture too deep into a dangerous area. Barely escape with your life.\",\n        statChanges: { health: 1, power: 1 / 3, control: 2 }\n      },\n      {\n        title: \"Fateful Encounter\",\n        narrative: \"Deep in your travels, you meet someone who changes everything.\",\n        statChanges: { influence: 2, empathy: 1, wealth: 66 / 3 }\n      }\n    ]\n  },\n\n  // HELP & REDEMPTION (20+ scenarios)\n  {\n    keywords: ['help', 'save', 'protect', 'assist', 'support', 'rescue', 'aid', 'defend', 'charity', 'mercy'],\n    type: 'redemption',\n    outcomes: [\n      {\n        title: \"Heroic Rescue\",\n        narrative: \"Against the odds, you save someone's life. A genuine hero's moment.\",\n        statChanges: { empathy: 3, influence: 2, corruption: 1, power: 1 / 3 }\n      },\n      {\n        title: \"Small Kindness\",\n        narrative: \"A tiny act of kindness creates a ripple of positive change.\",\n        statChanges: { empathy: 2, control: 1, wealth: 50 / 3 }\n      },\n      {\n        title: \"Protecting the Innocent\",\n        narrative: \"You stand between evil and those who cannot defend themselves.\",\n        statChanges: { empathy: 2, power: 1 / 3, corruption: 1, influence: 1 }\n      },\n      {\n        title: \"Genuine Connection\",\n        narrative: \"Through helping others, you rediscover your own humanity.\",\n        statChanges: { empathy: 4, health: 3, corruption: 1 }\n      }\n    ]\n  },\n\n  // BETRAYAL & CONFLICT (20+ scenarios)\n  {\n    keywords: ['betray', 'backstab', 'deceive', 'trick', 'plot', 'scheme', 'manipulate', 'lie', 'cheat', 'double-cross'],\n    type: 'dark',\n    outcomes: [\n      {\n        title: \"Perfect Deception\",\n        narrative: \"Your lie is so perfect, they'll never know what hit them.\",\n        statChanges: { control: 3, corruption: 2, wealth: 100 / 3, influence: 2 }\n      },\n      {\n        title: \"Betrayal Complete\",\n        narrative: \"You turn on an ally. The deed is done, and they'll pay for trusting you.\",\n        statChanges: { corruption: 4, control: 2, power: 1 / 3, empathy: 1 }\n      },\n      {\n        title: \"Con Artist's Dream\",\n        narrative: \"A masterclass in manipulation. They fell for it completely.\",\n        statChanges: { control: 4, wealth: 166 / 3, influence: 2, corruption: 2 }\n      },\n      {\n        title: \"Uncomfortable Victory\",\n        narrative: \"You won through treachery, but the guilt gnaws at you.\",\n        statChanges: { wealth: 66, control: 2, corruption: 1, empathy: 1 }\n      }\n    ]\n  }\n];\n\nexport function getRelevantScenarios(userInput: string, gameState: any): ScenarioTemplate[] {\n  const input = userInput.toLowerCase();\n  \n  // Find all scenarios that match any keyword in the user input\n  const matches = scenarios.filter(scenario => {\n    const hasKeywordMatch = scenario.keywords.some(keyword => \n      input.includes(keyword)\n    );\n    \n    // Apply stat filters if defined\n    if (hasKeywordMatch) {\n      if (scenario.minPower !== undefined && gameState.character.power < scenario.minPower) {\n        return false;\n      }\n      if (scenario.minCorruption !== undefined && gameState.character.corruption < scenario.minCorruption) {\n        return false;\n      }\n    }\n    \n    return hasKeywordMatch;\n  });\n\n  return matches.length > 0 ? matches : [scenarios[Math.floor(Math.random() * scenarios.length)]];\n}\n","size_bytes":60042},"client/src/components/character-creation/traits-step.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { calculateTraitCost } from \"@/lib/gameHelpers\";\nimport traitsData from \"@/data/traits.json\";\nimport type { CharacterData } from \"@/pages/character-creation\";\nimport type { Trait } from \"@shared/schema\";\n\ninterface TraitsStepProps {\n  data: CharacterData;\n  onChange: (data: Partial<CharacterData>) => void;\n}\n\nexport default function TraitsStep({ data, onChange }: TraitsStepProps) {\n  const traits = traitsData as Trait[];\n  const maxPoints = data.origin?.traitPoints || 10;\n  \n  const selectedTraitObjects = traits.filter(t => data.selectedTraits.includes(t.id));\n  const usedPoints = calculateTraitCost(selectedTraitObjects);\n  const remainingPoints = maxPoints - usedPoints;\n\n  const categories = [\"moral\", \"social\", \"physical\", \"magical\", \"quirky\"] as const;\n\n  const toggleTrait = (traitId: string) => {\n    const trait = traits.find(t => t.id === traitId);\n    if (!trait) return;\n\n    if (data.selectedTraits.includes(traitId)) {\n      onChange({\n        selectedTraits: data.selectedTraits.filter(id => id !== traitId)\n      });\n    } else {\n      const newSelected = traits.filter(t => \n        [...data.selectedTraits, traitId].includes(t.id)\n      );\n      const newCost = calculateTraitCost(newSelected);\n      \n      if (newCost <= maxPoints) {\n        onChange({\n          selectedTraits: [...data.selectedTraits, traitId]\n        });\n      }\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Points Display */}\n      <Card className=\"bg-gradient-to-r from-primary/10 to-secondary/10 border-2\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Trait Points</p>\n              <p className=\"text-2xl font-bold\">\n                <span className={remainingPoints < 0 ? \"text-destructive\" : \"text-primary\"}>\n                  {remainingPoints}\n                </span>\n                <span className=\"text-base text-muted-foreground\"> / {maxPoints}</span>\n              </p>\n            </div>\n            <div className=\"text-right\">\n              <p className=\"text-sm text-muted-foreground\">Selected Traits</p>\n              <p className=\"text-2xl font-bold text-secondary\">{data.selectedTraits.length}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Traits Selection */}\n      <Tabs defaultValue=\"moral\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-5\">\n          {categories.map(cat => (\n            <TabsTrigger key={cat} value={cat} className=\"capitalize\">\n              {cat}\n            </TabsTrigger>\n          ))}\n        </TabsList>\n\n        {categories.map(category => (\n          <TabsContent key={category} value={category} className=\"mt-4\">\n            <ScrollArea className=\"h-[400px] pr-4\">\n              <div className=\"space-y-2\">\n                {traits\n                  .filter(trait => trait.category === category)\n                  .filter(trait => !trait.originLocked || trait.originLocked === data.origin?.id)\n                  .map(trait => {\n                    const isSelected = data.selectedTraits.includes(trait.id);\n                    const canAfford = remainingPoints >= trait.cost || isSelected;\n                    \n                    return (\n                      <Card\n                        key={trait.id}\n                        className={`cursor-pointer transition-all ${\n                          isSelected\n                            ? \"ring-2 ring-primary border-primary\"\n                            : canAfford\n                            ? \"hover-elevate border-card-border\"\n                            : \"opacity-50 cursor-not-allowed\"\n                        }`}\n                        onClick={() => canAfford && toggleTrait(trait.id)}\n                        data-testid={`button-trait-${trait.id}`}\n                      >\n                        <CardHeader className=\"p-4\">\n                          <div className=\"flex items-start justify-between gap-4\">\n                            <div className=\"flex-1\">\n                              <CardTitle className=\"text-base\">{trait.name}</CardTitle>\n                              <CardDescription className=\"text-sm mt-1\">\n                                {trait.description}\n                              </CardDescription>\n                            </div>\n                            <Badge \n                              variant={trait.cost < 0 ? \"destructive\" : trait.cost === 0 ? \"secondary\" : \"default\"}\n                              className=\"shrink-0\"\n                            >\n                              {trait.cost > 0 ? `-${trait.cost}` : trait.cost < 0 ? `+${Math.abs(trait.cost)}` : \"Free\"}\n                            </Badge>\n                          </div>\n                        </CardHeader>\n                      </Card>\n                    );\n                  })}\n              </div>\n            </ScrollArea>\n          </TabsContent>\n        ))}\n      </Tabs>\n\n      {remainingPoints < 0 && (\n        <div className=\"p-3 bg-destructive/10 border border-destructive rounded-md\">\n          <p className=\"text-sm text-destructive font-semibold\">\n            You've exceeded your trait points! Remove some traits to continue.\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":5715},"client/src/components/character-creation/origin-step.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport originsData from \"@/data/origins.json\";\nimport type { CharacterData } from \"@/pages/character-creation\";\nimport type { Origin } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface OriginStepProps {\n  data: CharacterData;\n  onChange: (data: Partial<CharacterData>) => void;\n}\n\nconst ORIGIN_COSTS: Record<string, number> = {\n  \"sinner-weak\": 0,\n  \"hellborn\": 50,\n  \"deal-immigrant\": 75,\n  \"royal-born\": 150,\n  \"accidental\": 250 // Fallen Angel - most expensive\n};\n\nfunction getOriginCost(originId: string): number {\n  return ORIGIN_COSTS[originId] || 0;\n}\n\nexport default function OriginStep({ data, onChange }: OriginStepProps) {\n  const { toast } = useToast();\n  const origins = originsData as Origin[];\n  const ownedSet = new Set(data.ownedOrigins);\n\n  const handleBuyOrigin = (origin: Origin) => {\n    const cost = getOriginCost(origin.id);\n    \n    if (ownedSet.has(origin.id)) {\n      // Already owned, can't buy again\n      return;\n    }\n    \n    // Check if can afford\n    if (data.soulcoins < cost) {\n      toast({\n        title: \"Not Enough Soulcoins\",\n        description: `You need ${cost} soulcoins but only have ${data.soulcoins}`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    // Buy the origin\n    onChange({\n      ownedOrigins: [...data.ownedOrigins, origin.id],\n      soulcoins: data.soulcoins - cost,\n      origin: origin // Auto-select when bought\n    });\n\n    toast({\n      title: \"Origin Purchased\",\n      description: `You now have access to ${origin.name}`\n    });\n  };\n\n  const handleSelectOrigin = (origin: Origin) => {\n    if (ownedSet.has(origin.id)) {\n      onChange({ origin });\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"grid gap-4\">\n        {origins.map((origin) => {\n          const isOwned = ownedSet.has(origin.id);\n          const cost = getOriginCost(origin.id);\n          const canAfford = data.soulcoins >= cost;\n          const isSelected = data.origin?.id === origin.id;\n\n          return (\n            <Card\n              key={origin.id}\n              className={`transition-all ${\n                isSelected\n                  ? \"ring-2 ring-primary border-primary bg-primary/5\"\n                  : isOwned\n                  ? \"cursor-pointer hover-elevate border-card-border\"\n                  : \"opacity-75 border-card-border\"\n              }`}\n              data-testid={`button-origin-${origin.id}`}\n            >\n              <CardHeader>\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <CardTitle className=\"font-display text-xl\">{origin.name}</CardTitle>\n                      {isOwned && (\n                        <Badge variant=\"secondary\" className=\"text-xs\">Owned</Badge>\n                      )}\n                      {isSelected && (\n                        <Badge className=\"text-xs bg-primary\">Selected</Badge>\n                      )}\n                    </div>\n                    <CardDescription className=\"mt-1\">{origin.description}</CardDescription>\n                  </div>\n                  <div className=\"shrink-0 text-right space-y-1\">\n                    <Badge variant=\"secondary\">{origin.traitPoints} TP</Badge>\n                    <Badge variant=\"outline\" className={origin.id === \"sinner-weak\" ? \"bg-green-500/20 border-green-700\" : \"\"}>\n                      {origin.id === \"sinner-weak\" ? \"Free\" : `${cost} SC`}\n                    </Badge>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm\">\n                    <div className=\"space-y-1\">\n                      <p className=\"text-muted-foreground text-xs\">Power</p>\n                      <p className=\"font-semibold text-red-500\">{origin.startingStats.power}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-muted-foreground text-xs\">Control</p>\n                      <p className=\"font-semibold text-purple-500\">{origin.startingStats.control}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-muted-foreground text-xs\">Influence</p>\n                      <p className=\"font-semibold text-amber-500\">{origin.startingStats.influence}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-muted-foreground text-xs\">Empathy</p>\n                      <p className=\"font-semibold text-pink-500\">{origin.startingStats.empathy}</p>\n                    </div>\n                  </div>\n                  {origin.lockedTraits.length > 0 && (\n                    <div>\n                      <p className=\"text-xs text-muted-foreground mb-1\">Unique Trait:</p>\n                      <div className=\"flex gap-2\">\n                        {origin.lockedTraits.map((trait) => (\n                          <Badge key={trait} variant=\"outline\" className=\"capitalize\">\n                            {trait.replace(\"-\", \" \")}\n                          </Badge>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                  \n                  {/* Action Buttons */}\n                  <div className=\"flex gap-2 pt-2\">\n                    {!isOwned ? (\n                      <Button\n                        onClick={() => handleBuyOrigin(origin)}\n                        disabled={!canAfford}\n                        variant={canAfford ? \"default\" : \"ghost\"}\n                        className=\"flex-1\"\n                        size=\"sm\"\n                      >\n                        {cost === 0 ? \"Unlock\" : `Buy (${cost} SC)`}\n                      </Button>\n                    ) : (\n                      <Button\n                        onClick={() => handleSelectOrigin(origin)}\n                        variant={isSelected ? \"default\" : \"outline\"}\n                        className=\"flex-1\"\n                        size=\"sm\"\n                      >\n                        {isSelected ? \"Selected\" : \"Select\"}\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","size_bytes":6713},"client/src/lib/gameHelpers.ts":{"content":"import type { Origin, Trait, Power, Character } from \"@shared/schema\";\nimport namesData from \"@/data/names.json\";\n\nexport function generateRandomName(origin?: string): { firstName: string; lastName: string } {\n  const firstNameCategories = Object.values(namesData.firstNames).flat();\n  const lastNameCategories = Object.values(namesData.lastNames).flat();\n  \n  const firstName = firstNameCategories[Math.floor(Math.random() * firstNameCategories.length)];\n  const lastName = lastNameCategories[Math.floor(Math.random() * lastNameCategories.length)];\n  \n  return { firstName, lastName };\n}\n\nexport function generateSuggestedNames(origin: string, count: number = 3): Array<{ firstName: string; lastName: string }> {\n  const suggestions: Array<{ firstName: string; lastName: string }> = [];\n  \n  for (let i = 0; i < count; i++) {\n    suggestions.push(generateRandomName(origin));\n  }\n  \n  return suggestions;\n}\n\nexport function calculateTraitCost(traits: Trait[]): number {\n  return traits.reduce((sum, trait) => sum + trait.cost, 0);\n}\n\nexport function canAffordTrait(currentTraits: Trait[], newTrait: Trait, maxPoints: number): boolean {\n  const currentCost = calculateTraitCost(currentTraits);\n  return currentCost + newTrait.cost <= maxPoints;\n}\n\nexport function getPowerTypeColor(type: string): string {\n  const colors: Record<string, string> = {\n    \"hellfire\": \"from-red-600 to-orange-500\",\n    \"voice-broadcast\": \"from-blue-600 to-cyan-500\",\n    \"shadow-eldritch\": \"from-purple-700 to-red-900\",\n    \"contract\": \"from-amber-600 to-yellow-500\",\n    \"seduction\": \"from-pink-600 to-rose-500\",\n    \"tech-cyber\": \"from-cyan-600 to-blue-500\",\n    \"pheromone\": \"from-purple-500 to-pink-500\",\n    \"regeneration\": \"from-green-600 to-emerald-500\",\n    \"teleportation\": \"from-indigo-600 to-purple-500\",\n    \"necromancy\": \"from-gray-700 to-purple-900\",\n    \"glamour\": \"from-violet-600 to-fuchsia-500\",\n    \"musical\": \"from-yellow-600 to-amber-500\",\n    \"physical\": \"from-stone-600 to-gray-500\",\n    \"illusion\": \"from-teal-600 to-cyan-500\",\n    \"divine\": \"from-gold-400 to-yellow-300\"\n  };\n  \n  return colors[type] || \"from-gray-600 to-gray-500\";\n}\n\nexport function getRarityColor(rarity: string): string {\n  const colors: Record<string, string> = {\n    \"common\": \"text-gray-400\",\n    \"uncommon\": \"text-green-400\",\n    \"rare\": \"text-blue-400\",\n    \"epic\": \"text-purple-400\",\n    \"legendary\": \"text-amber-400\"\n  };\n  \n  return colors[rarity] || \"text-gray-400\";\n}\n\nexport function formatStatChange(stat: string, value: number): string {\n  const prefix = value > 0 ? \"+\" : \"\";\n  return `${prefix}${value} ${stat}`;\n}\n\nexport function getStatColor(statName: string): string {\n  const colors: Record<string, string> = {\n    \"power\": \"text-red-500\",\n    \"control\": \"text-purple-500\",\n    \"influence\": \"text-amber-500\",\n    \"corruption\": \"text-red-900 dark:text-red-700\",\n    \"empathy\": \"text-pink-500\",\n    \"health\": \"text-green-500\",\n    \"wealth\": \"text-yellow-500\"\n  };\n  \n  return colors[statName.toLowerCase()] || \"text-gray-500\";\n}\n\nexport function getStatBarColor(statName: string): string {\n  const colors: Record<string, string> = {\n    \"power\": \"bg-red-500\",\n    \"control\": \"bg-purple-500\",\n    \"influence\": \"bg-amber-500\",\n    \"corruption\": \"bg-red-900 dark:bg-red-700\",\n    \"empathy\": \"bg-pink-500\",\n    \"health\": \"bg-green-500\",\n    \"wealth\": \"bg-yellow-500\"\n  };\n  \n  return colors[statName.toLowerCase()] || \"bg-gray-500\";\n}\n\nexport function getRankTitle(rank: string): string {\n  const titles: Record<string, string> = {\n    \"street-demon\": \"Street Demon\",\n    \"rising-power\": \"Rising Power\",\n    \"overlord-candidate\": \"Overlord Candidate\",\n    \"overlord\": \"Overlord\",\n    \"supreme-overlord\": \"Supreme Overlord\",\n    \"hells-apex\": \"Hell's Apex\"\n  };\n  \n  return titles[rank] || rank;\n}\n\nexport function checkPowerUnlock(power: Power, character: Character): boolean {\n  const { unlockConditions } = power;\n  \n  if (unlockConditions.origin && !unlockConditions.origin.includes(character.origin)) {\n    return false;\n  }\n  \n  if (unlockConditions.minPower && character.power < unlockConditions.minPower) {\n    return false;\n  }\n  \n  if (unlockConditions.minControl && character.control < unlockConditions.minControl) {\n    return false;\n  }\n  \n  if (unlockConditions.minInfluence && character.influence < unlockConditions.minInfluence) {\n    return false;\n  }\n  \n  return true;\n}\n","size_bytes":4378},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/game/power-selector.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Zap, X } from \"lucide-react\";\nimport powersData from \"@/data/powers.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface PowerSelectorProps {\n  gameState: GameState;\n  selectedPowerIds: string[];\n  onTogglePower: (powerId: string) => void;\n  onClose: () => void;\n}\n\nexport default function PowerSelector({\n  gameState,\n  selectedPowerIds,\n  onTogglePower,\n  onClose\n}: PowerSelectorProps) {\n  const powers = powersData as any[];\n  const activePowers = (gameState as any).activePowers || [];\n\n  const availablePowers = powers.filter(p =>\n    activePowers.includes(p.id) || selectedPowerIds.includes(p.id)\n  );\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/50 flex items-center justify-center\" data-testid=\"modal-power-selector\">\n      <div className=\"bg-card border-2 border-primary rounded-lg p-6 max-w-2xl max-h-96 overflow-y-auto w-11/12\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-lg font-bold flex items-center gap-2\">\n            <Zap className=\"w-5 h-5 text-primary\" />\n            Select Powers to Use\n          </h2>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onClose}\n            data-testid=\"button-close-selector\"\n          >\n            <X className=\"w-5 h-5\" />\n          </Button>\n        </div>\n\n        <div className=\"space-y-2 mb-4\">\n          {availablePowers.length === 0 ? (\n            <p className=\"text-muted-foreground text-sm\">No powers available. Learn new powers to use them in actions.</p>\n          ) : (\n            availablePowers.map(power => (\n              <div\n                key={power.id}\n                className={`p-3 border rounded cursor-pointer transition-all ${\n                  selectedPowerIds.includes(power.id)\n                    ? \"border-primary bg-primary/10\"\n                    : \"border-card-border hover:border-primary/50\"\n                }`}\n                onClick={() => onTogglePower(power.id)}\n                data-testid={`button-power-${power.id}`}\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"font-semibold text-sm\">{power.name}</div>\n                    <div className=\"text-xs text-muted-foreground\">{power.description}</div>\n                  </div>\n                  {selectedPowerIds.includes(power.id) && (\n                    <Badge className=\"ml-2\">Selected</Badge>\n                  )}\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n\n        <Button\n          className=\"w-full\"\n          onClick={onClose}\n          data-testid=\"button-confirm-powers\"\n        >\n          Done ({selectedPowerIds.length} selected)\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2933},"client/src/lib/ai-event-client.ts":{"content":"/**\n * Client-side AI event generation\n * Communicates with backend API for AI-powered event generation\n */\n\nexport interface AIEventRequest {\n  theme?: string;\n  location?: string;\n  characterPower?: number;\n  characterCorruption?: number;\n}\n\n/**\n * Request a dynamically generated event from the server\n */\nexport async function requestAIEvent(options: AIEventRequest = {}) {\n  try {\n    const response = await fetch(\"/api/ai-event\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(options)\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    return await response.json();\n  } catch (error) {\n    console.error(\"Error requesting AI event:\", error);\n    return null;\n  }\n}\n\n/**\n * Request NPC dialogue from the server\n */\nexport async function requestNPCDialogue(npcName: string, context: string = \"\") {\n  try {\n    const response = await fetch(\"/api/npc-dialogue\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ npcName, context })\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    const data = await response.json();\n    return data.dialogue || \"...\";\n  } catch (error) {\n    console.error(\"Error requesting NPC dialogue:\", error);\n    return \"...\";\n  }\n}\n","size_bytes":1394},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/lib/territorySystem.ts":{"content":"import type { GameState } from \"./game-state\";\nimport districtsData from \"@/data/districts.json\";\n\nexport interface Territory {\n  districtId: string;\n  ownerId: string | null;\n  tributePerTurn: number;\n  defenseDifficulty: number;\n  challenger?: string;\n}\n\ninterface District {\n  id: string;\n  name: string;\n  dangerLevel: number;\n}\n\nconst DISTRICTS = districtsData as District[];\n\nexport function getDistrictById(id: string): District | undefined {\n  return DISTRICTS.find(d => d.id === id);\n}\n\nexport function canClaimTerritory(gameState: GameState, districtId: string): { can: boolean; reason?: string; difficultyRating?: string } {\n  const district = getDistrictById(districtId);\n  if (!district) return { can: false, reason: \"District not found\" };\n  \n  const territory = (gameState.territory as any)[districtId];\n  const alreadyOwned = territory?.ownerId === gameState.character.firstName;\n  if (alreadyOwned) return { can: false, reason: \"You already own this territory\" };\n  \n  const powerNeeded = 20 + (district.dangerLevel * 8);\n  if (gameState.character.power < powerNeeded) {\n    return { can: false, reason: `Requires ${powerNeeded} Power (you have ${gameState.character.power})` };\n  }\n  \n  const difficultyRatings = [\"Easy\", \"Moderate\", \"Hard\", \"Very Hard\", \"Extreme\", \"Overlord\", \"Supreme\"];\n  const difficulty = Math.min(district.dangerLevel - 1, difficultyRatings.length - 1);\n  \n  return { can: true, difficultyRating: difficultyRatings[Math.max(0, difficulty)] };\n}\n\nexport function claimTerritory(gameState: GameState, districtId: string): Partial<GameState> {\n  const district = getDistrictById(districtId);\n  if (!district) return {};\n  \n  const tribute = 50 + (district.dangerLevel * 15);\n  \n  return {\n    territory: {\n      ...gameState.territory,\n      [districtId]: {\n        ownerId: gameState.character.firstName,\n        tributePerTurn: tribute,\n        defenseDifficulty: district.dangerLevel\n      }\n    },\n    character: {\n      ...gameState.character,\n      influence: gameState.character.influence + 3,\n      corruption: gameState.character.corruption + 3,\n      power: Math.max(1, gameState.character.power - 5)\n    }\n  };\n}\n\nexport function getTributeIncome(gameState: GameState): number {\n  let totalTribute = 0;\n  Object.values(gameState.territory).forEach((territory: any) => {\n    if (territory.ownerId === gameState.character.firstName) {\n      totalTribute += territory.tributePerTurn || 0;\n    }\n  });\n  return totalTribute;\n}\n\nexport function getControlledDistricts(gameState: GameState): string[] {\n  return Object.entries(gameState.territory)\n    .filter(([_, territory]: any) => territory.ownerId === gameState.character.firstName)\n    .map(([districtId]) => districtId);\n}\n","size_bytes":2723},"client/src/components/game/ranking-panel.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { Crown, TrendingUp, ChevronDown, ChevronUp } from \"lucide-react\";\nimport { calculateRankProgress, getRankTitle, generateRivals } from \"@/lib/rankingSystem\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface RankingPanelProps {\n  gameState: GameState;\n}\n\nexport default function RankingPanel({ gameState }: RankingPanelProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const { currentRank, nextRank, progressPercent } = calculateRankProgress(gameState.character.power);\n  const rivals = generateRivals(gameState);\n\n  if (!isExpanded) {\n    return (\n      <Card>\n        <Button\n          onClick={() => setIsExpanded(true)}\n          variant=\"outline\"\n          className=\"w-full justify-between\"\n        >\n          <div className=\"flex items-center gap-2\">\n            <Crown className=\"w-4 h-4\" />\n            Power Ranking\n          </div>\n          <ChevronDown className=\"w-4 h-4\" />\n        </Button>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"border-2 border-card-border\" data-testid=\"card-ranking\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-display flex items-center gap-2\">\n            <Crown className=\"w-5 h-5 text-primary\" />\n            Power Ranking\n          </CardTitle>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => setIsExpanded(false)}\n          >\n            <ChevronUp className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"p-3 bg-primary/10 rounded-md border border-primary/30\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"font-semibold text-sm\">{getRankTitle(currentRank)}</span>\n            <Badge variant=\"default\">{gameState.character.power} Power</Badge>\n          </div>\n          {nextRank && (\n            <>\n              <Progress value={progressPercent} className=\"h-2 mb-1\" />\n              <p className=\"text-xs text-muted-foreground\">\n                Progress to {getRankTitle(nextRank)}: {Math.round(progressPercent)}%\n              </p>\n            </>\n          )}\n          {!nextRank && (\n            <p className=\"text-xs text-green-500 font-semibold\">You've reached Hell's Apex!</p>\n          )}\n        </div>\n\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center gap-2\">\n            <TrendingUp className=\"w-4 h-4 text-amber-500\" />\n            <span className=\"text-sm font-semibold\">Active Rivals</span>\n          </div>\n          {rivals.map((rival, i) => (\n            <div key={i} className=\"p-2 bg-muted/50 rounded-md border border-card-border text-sm\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"font-semibold\">{rival.name}</span>\n                <span className=\"text-xs text-muted-foreground\">{Math.round(rival.power)} Power</span>\n              </div>\n            </div>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":3384},"client/src/pages/home.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Play, Save, Info, Trash2 } from \"lucide-react\";\nimport SplashScreen from \"@/components/splash-screen\";\nimport { initAudio, playMenuMusic } from \"@/lib/audio\";\nimport { loadGame, getAllSaves, deleteGame, deleteAllSaves, loadLatestSave } from \"@/lib/game-state\";\nimport type { SaveSlot } from \"@/lib/game-state\";\n\nexport default function Home() {\n  const [, setLocation] = useLocation();\n  const [showSplash, setShowSplash] = useState(true);\n  const [fadeIn, setFadeIn] = useState(false);\n  const [saves, setSaves] = useState<SaveSlot[]>([]);\n  const [showLoadDialog, setShowLoadDialog] = useState(false);\n\n  useEffect(() => {\n    if (!showSplash) {\n      setFadeIn(true);\n    }\n  }, [showSplash]);\n\n  // Initialize audio and play menu music on mount\n  useEffect(() => {\n    initAudio();\n    playMenuMusic();\n  }, []);\n\n  // Check for saved games on mount\n  useEffect(() => {\n    const allSaves = getAllSaves();\n    setSaves(allSaves);\n  }, []);\n\n  const handleContinue = async () => {\n    const latest = await loadLatestSave();\n    if (latest) {\n      setLocation(\"/game\");\n    }\n  };\n\n  const handleLoadGame = async (slot: number) => {\n    const save = await loadGame(slot);\n    if (save) {\n      setShowLoadDialog(false);\n      setLocation(\"/game\");\n    }\n  };\n\n  const handleDeleteSave = (slot: number, e: React.MouseEvent) => {\n    e.stopPropagation();\n    deleteGame(slot);\n    setSaves(getAllSaves());\n  };\n\n  const handleClearAllSaves = async () => {\n    if (confirm(\"Are you sure? This will delete ALL saves and give you a fresh start.\")) {\n      await deleteAllSaves();\n      setSaves([]);\n      setShowLoadDialog(false);\n    }\n  };\n\n  const hasSaves = saves.length > 0;\n\n  if (showSplash) {\n    return <SplashScreen onComplete={() => setShowSplash(false)} />;\n  }\n\n  return (\n    <div className={`min-h-screen bg-gradient-to-b from-background via-card to-background flex items-center justify-center p-4 transition-opacity duration-1000 ${fadeIn ? \"opacity-100\" : \"opacity-0\"}`}>\n      <div className=\"w-full max-w-2xl space-y-8\">\n        {/* Title */}\n        <div className=\"text-center space-y-2\">\n          <h1 className=\"font-display text-5xl md:text-7xl font-bold text-primary tracking-tight\">\n            Hazbin Hotel\n          </h1>\n          <h2 className=\"font-display text-2xl md:text-3xl text-muted-foreground\">\n            Life in Hell\n          </h2>\n          <p className=\"text-sm text-muted-foreground max-w-md mx-auto mt-4\">\n            Live your demon life. Rise from sinner to overlord. Claim territories across the Pentagram. Shape your destiny.\n          </p>\n        </div>\n\n        {/* Main Menu */}\n        <Card className=\"p-8 space-y-4 border-2 border-card-border hover-elevate\">\n          <Link href=\"/character-creation\" data-testid=\"link-new-game\">\n            <Button \n              className=\"w-full gap-2 min-h-12 text-lg font-semibold\"\n              size=\"lg\"\n              data-testid=\"button-new-game\"\n            >\n              <Play className=\"w-5 h-5\" />\n              New Game\n            </Button>\n          </Link>\n\n          <Button \n            variant=\"secondary\"\n            className=\"w-full gap-2 min-h-12 text-lg\"\n            size=\"lg\"\n            disabled={!hasSaves}\n            onClick={handleContinue}\n            data-testid=\"button-continue\"\n          >\n            <Save className=\"w-5 h-5\" />\n            {hasSaves ? \"Continue\" : \"No Save Available\"}\n          </Button>\n\n          <Button \n            variant=\"outline\"\n            className=\"w-full gap-2 min-h-12\"\n            size=\"lg\"\n            disabled={!hasSaves}\n            onClick={() => setShowLoadDialog(true)}\n            data-testid=\"button-load-game\"\n          >\n            Load Game ({saves.length}/5)\n          </Button>\n        </Card>\n\n        {/* Save Selection Dialog */}\n        <Dialog open={showLoadDialog} onOpenChange={setShowLoadDialog}>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Select Save</DialogTitle>\n              <DialogDescription>Choose a save to load</DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n              {saves.length === 0 ? (\n                <p className=\"text-center text-muted-foreground\">No saves available</p>\n              ) : (\n                <>\n                  {saves.map((save) => (\n                    <Card \n                      key={save.slot}\n                      className=\"p-3 cursor-pointer hover-elevate\"\n                      onClick={() => handleLoadGame(save.slot)}\n                      data-testid={`button-load-slot-${save.slot}`}\n                    >\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"font-semibold text-sm\">{save.characterName}</p>\n                          <p className=\"text-xs text-muted-foreground\">Slot {save.slot} ‚Ä¢ Turn {save.gameState.turn}</p>\n                          <p className=\"text-xs text-muted-foreground\">{new Date(save.timestamp).toLocaleString()}</p>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={(e) => handleDeleteSave(save.slot, e)}\n                          data-testid={`button-delete-slot-${save.slot}`}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      </div>\n                    </Card>\n                  ))}\n                  <Button\n                    variant=\"destructive\"\n                    className=\"w-full mt-4\"\n                    onClick={handleClearAllSaves}\n                    data-testid=\"button-clear-all-saves\"\n                  >\n                    Clear All Saves\n                  </Button>\n                </>\n              )}\n            </div>\n          </DialogContent>\n        </Dialog>\n\n        {/* Info Footer */}\n        <div className=\"text-center space-y-2\">\n          <p className=\"text-xs text-muted-foreground flex items-center justify-center gap-2\">\n            <Info className=\"w-4 h-4\" />\n            A BitLife-style experience set in the Hazbin Hotel universe\n          </p>\n          <div className=\"flex items-center justify-center gap-4 text-xs text-muted-foreground\">\n            <span>Power ‚Ä¢ Corruption ‚Ä¢ Redemption</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6851},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/lib/rankingSystem.ts":{"content":"import type { GameState } from \"./game-state\";\n\nexport const RANK_TIERS = [\n  { id: \"weak-sinner\", title: \"Weak Sinner\", minPower: 0 },\n  { id: \"street-demon\", title: \"Street Demon\", minPower: 20 },\n  { id: \"rising-power\", title: \"Rising Power\", minPower: 50 },\n  { id: \"overlord-candidate\", title: \"Overlord Candidate\", minPower: 100 },\n  { id: \"overlord\", title: \"Overlord\", minPower: 150 },\n  { id: \"supreme-overlord\", title: \"Supreme Overlord\", minPower: 200 },\n  { id: \"hells-apex\", title: \"Hell's Apex\", minPower: 250 }\n];\n\nexport function calculateRank(power: number): string {\n  for (let i = RANK_TIERS.length - 1; i >= 0; i--) {\n    if (power >= RANK_TIERS[i].minPower) {\n      return RANK_TIERS[i].id;\n    }\n  }\n  return \"weak-sinner\";\n}\n\nexport function getRankTitle(rankId: string): string {\n  const tier = RANK_TIERS.find(t => t.id === rankId);\n  return tier ? tier.title : \"Unknown\";\n}\n\nexport function calculateRankProgress(power: number): { currentRank: string; nextRank: string | null; progressPercent: number } {\n  const currentRankId = calculateRank(power);\n  const currentTierIndex = RANK_TIERS.findIndex(t => t.id === currentRankId);\n  \n  let progressPercent = 0;\n  let nextRank: string | null = null;\n  \n  if (currentTierIndex < RANK_TIERS.length - 1) {\n    const nextTier = RANK_TIERS[currentTierIndex + 1];\n    nextRank = nextTier.id;\n    \n    const currentMin = RANK_TIERS[currentTierIndex].minPower;\n    const nextMin = nextTier.minPower;\n    const progress = power - currentMin;\n    const needed = nextMin - currentMin;\n    progressPercent = Math.min(100, (progress / needed) * 100);\n  } else {\n    progressPercent = 100; // At apex\n  }\n  \n  return { currentRank: currentRankId, nextRank, progressPercent };\n}\n\nexport function generateRivals(gameState: GameState): Array<{ id: string; name: string; power: number; rank: string }> {\n  const rivalNames = [\"Crimson Wraith\", \"Obsidian Tyrant\", \"Scarlet Sentinel\", \"Void Reaper\", \"Ash Decimator\"];\n  const currentTierIndex = RANK_TIERS.findIndex(t => t.id === gameState.character.rank);\n  \n  return rivalNames.slice(0, Math.min(3, currentTierIndex + 1)).map((name, i) => ({\n    id: `rival-${i}`,\n    name,\n    power: gameState.character.power - 10 + Math.random() * 20,\n    rank: gameState.character.rank\n  }));\n}\n","size_bytes":2287},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"README.md":{"content":"# Hazbin Hotel BitLife-Style Life Simulation Game\n\nA comprehensive single-player, choice-driven life simulation game set in the Hazbin Hotel universe. Play as a demon in Hell, navigate complex relationships, acquire powers, and shape your destiny through multiple branching paths.\n\n## Features\n\n### üéÆ Core Systems\n\n#### Character Creation\n- **5 Origin Paths**: Royal-born, Hellborn, Weak Sinner, Deal Immigrant, + unlockable special origins\n- **Customizable Appearance**: Horns, wings, and color palette selections\n- **8 Core Stats**: Power, Control, Influence, Corruption, Empathy, Health, Wealth, Reputation\n- **Dynamic Trait System**: 60+ traits with point-based selection and balancing\n\n#### Power System\n- **15 Power Types** with 45+ abilities:\n  - Hellfire/Infernal Flame\n  - Voice/Broadcast Magic (Vox-style)\n  - Shadow & Eldritch (Alastor-esque)\n  - Contract Magic/Bargaining\n  - Seduction/Charm (Succubi/Incubi)\n  - Tech/Cyber Glamour (Velvette-style)\n  - Pheromone/Scent Control (Valentino-style)\n  - Regeneration/Durability\n  - Teleportation/Movement Magic\n  - Necromancy/Soulcraft\n  - Glamour & Shapeshift\n  - Musical/Performance Magic\n  - Physical/Brute Abilities\n  - Illusion & Mind-Bend\n  - Divine/Whitefire (rare, Charlie/angelic)\n\n- **Power Growth**: Use-based XP system with individual leveling\n- **Loadout System**: Equip 3-5 active powers + passive abilities with cooldown mechanics\n\n#### Gameplay Systems\n- **Event-Driven Gameplay**: Dynamic events with branching choices and stat consequences\n- **NPC Relationships**: Deep relationship system with canon Hazbin Hotel characters\n- **Territory Control**: Expand your domain across 7 districts in Pentagram City\n- **Faction Reputation**: Multiple factions with shifting allegiances\n- **AI-Powered Events**: Houndify integration for dynamic dialogue and event generation\n- **Turn-Based Progression**: Play at your own pace with turn-based mechanics\n\n#### Multiple Endings\n- **Redemption**: High Empathy, low Corruption, strong Hotel reputation\n- **Hell's Apex**: Overlord supremacy through power and dominion\n- **Syndicate Emperor**: Criminal underworld control\n- **Media Dominion**: Control through information and broadcasts\n- **The New Crown**: Overthrow Hell's royalty\n- **Apocalypse Unchained**: Corruption-driven collapse\n- **Faded to Nothing**: The forgotten path\n- **Forever Hedonist**: Pleasure-seeking retirement\n- **Radio Demon's Equal**: Match Alastor in power and legend\n- **Charlie's Hope**: Become redemption's guardian\n\n## Technical Stack\n\n- **Frontend**: React with TypeScript, Vite\n- **Backend**: Express.js with TypeScript\n- **Styling**: Tailwind CSS + shadcn/ui components\n- **State Management**: TanStack Query (React Query) for data fetching\n- **Routing**: Wouter for client-side routing\n- **Data Persistence**: LocalStorage for game saves\n- **UI Framework**: shadcn/ui with Art Deco Hazbin Hotel theming\n- **AI Integration**: Houndify for dynamic event generation\n- **Audio**: Howler.js for soundtrack integration (prepared)\n\n## Project Structure\n\n```\nclient/src/\n‚îú‚îÄ‚îÄ pages/\n‚îÇ   ‚îú‚îÄ‚îÄ home.tsx                 # Main menu\n‚îÇ   ‚îú‚îÄ‚îÄ character-creation.tsx   # Character creation flow\n‚îÇ   ‚îú‚îÄ‚îÄ game.tsx                 # Main game interface\n‚îÇ   ‚îî‚îÄ‚îÄ not-found.tsx            # 404 page\n‚îú‚îÄ‚îÄ components/\n‚îÇ   ‚îú‚îÄ‚îÄ character-creation/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ name-step.tsx\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ appearance-step.tsx\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ origin-step.tsx\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ traits-step.tsx\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ powers-step.tsx\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ summary-step.tsx\n‚îÇ   ‚îî‚îÄ‚îÄ game/\n‚îÇ       ‚îú‚îÄ‚îÄ stats-panel.tsx\n‚îÇ       ‚îú‚îÄ‚îÄ powers-panel.tsx\n‚îÇ       ‚îú‚îÄ‚îÄ event-card.tsx\n‚îÇ       ‚îú‚îÄ‚îÄ actions-panel.tsx\n‚îÇ       ‚îú‚îÄ‚îÄ map-panel.tsx\n‚îÇ       ‚îî‚îÄ‚îÄ npc-panel.tsx\n‚îú‚îÄ‚îÄ data/\n‚îÇ   ‚îú‚îÄ‚îÄ origins.json             # 5 origin paths\n‚îÇ   ‚îú‚îÄ‚îÄ traits.json              # 60+ traits\n‚îÇ   ‚îú‚îÄ‚îÄ powers.json              # 45+ abilities\n‚îÇ   ‚îú‚îÄ‚îÄ districts.json           # 7 Pentagram City districts\n‚îÇ   ‚îú‚îÄ‚îÄ npcs.json                # Canon Hazbin characters\n‚îÇ   ‚îú‚îÄ‚îÄ factions.json            # Faction definitions\n‚îÇ   ‚îú‚îÄ‚îÄ endings.json             # 10+ endings\n‚îÇ   ‚îú‚îÄ‚îÄ events.json              # Event templates\n‚îÇ   ‚îî‚îÄ‚îÄ names.json               # Name generation data\n‚îú‚îÄ‚îÄ lib/\n‚îÇ   ‚îú‚îÄ‚îÄ gameHelpers.ts           # Game logic utilities\n‚îÇ   ‚îú‚îÄ‚îÄ game-state.ts            # Save/load system\n‚îÇ   ‚îú‚îÄ‚îÄ game-context.tsx         # Game state context provider\n‚îÇ   ‚îú‚îÄ‚îÄ ai-event-client.ts       # AI event client\n‚îÇ   ‚îî‚îÄ‚îÄ queryClient.ts           # TanStack Query configuration\n‚îî‚îÄ‚îÄ App.tsx                       # Main app component\n\nserver/\n‚îú‚îÄ‚îÄ routes.ts                    # API endpoints\n‚îú‚îÄ‚îÄ storage.ts                   # Storage interface (in-memory)\n‚îú‚îÄ‚îÄ lib/\n‚îÇ   ‚îî‚îÄ‚îÄ ai-events.ts            # AI event generation service\n‚îî‚îÄ‚îÄ index-dev.ts                # Dev server entry\n\nshared/\n‚îî‚îÄ‚îÄ schema.ts                    # TypeScript types and Zod schemas\n```\n\n## Game Design Principles\n\n### Balance\n- Early game: Forgiving, encourages experimentation\n- Mid game: Faction arcs, powerful contracts, playstyle shifts\n- Late game: Domain powers with catastrophic risks via high Corruption\n- Soft caps: Stats (Power/Control ~100) unlock story-based progression\n\n### Progression\n- **Use-based XP**: Powers grow through use\n- **Trait Investment**: Traits define playstyle and unlock options\n- **Relationship Depth**: NPCs evolve based on player choices\n- **Territory Control**: Visible map control progression\n\n### Narrative\n- Dark comedy with Hazbin Hotel tone\n- Meaningful choice consequences\n- Multiple valid playpaths to different endings\n- Branching storylines with faction wars\n\n## Data Structures\n\n### Character\n```typescript\n{\n  firstName: string\n  lastName: string\n  origin: string\n  age: number\n  stats: { power, control, influence, corruption, empathy, health, wealth }\n  traits: string[]\n  powers: { id, level, experience }[]\n  rank: string\n}\n```\n\n### Power\n```typescript\n{\n  id: string\n  name: string\n  type: string\n  basePower: number\n  controlReq: number\n  corruptionCost: number\n  cooldown: number\n  isPassive: boolean\n  description: string\n  rarity: string\n  unlockConditions: { origin?, minPower?, minControl?, minInfluence? }\n}\n```\n\n### Event\n```typescript\n{\n  id: string\n  title: string\n  description: string\n  type: 'daily' | 'contract' | 'career' | 'romance' | 'war' | 'random'\n  choices: {\n    id: string\n    text: string\n    requirements?: { control, power, influence }\n    outcomes: {\n      statChanges?: Record<string, number>\n      narrativeText: string\n      powerGrant?: string[]\n      reputationChanges?: Record<string, number>\n    }\n  }[]\n  onlyOnce: boolean\n}\n```\n\n## API Endpoints\n\n### AI Event Generation\n- `POST /api/ai-event` - Generate dynamic event\n- `POST /api/npc-dialogue` - Generate NPC dialogue\n- `POST /api/event-chain` - Generate event follow-ups\n- `GET /api/health` - Health check\n\n## Customization\n\n### Design Theme\nLocated in `client/src/index.css` - Hazbin Hotel Art Deco theme with red/black/gold palette:\n- Primary: Crimson red (#8B0000)\n- Secondary: Deep purple\n- Accent: Gold (#FFD700)\n- Font: Playfair Display (headings) + DM Sans (body)\n\n### Game Balance\nEdit `client/src/data/` JSON files to adjust:\n- Starting stats per origin\n- Power costs and cooldowns\n- Trait points and modifiers\n- Event triggers and outcomes\n- NPC affinities\n\n## Saving & Loading\n\nGames are automatically saved to browser LocalStorage after every turn. Players can:\n- Continue last game from home screen\n- Export game as JSON (future feature)\n- Import game from JSON backup (future feature)\n\n## Development\n\n### Running Locally\n```bash\nnpm install\nnpm run dev\n```\n\nThe dev server runs on `http://localhost:5000`\n\n### Building for Production\n```bash\nnpm run build\n```\n\n## Future Enhancements\n\n- [ ] Full Houndify AI integration for dynamic dialogue\n- [ ] Battle system for territory control\n- [ ] Soundtrack integration (Howler.js prepared)\n- [ ] More complex NPC interactions\n- [ ] Unlockable cosmetics and badges\n- [ ] New Game+ with carry-over bonuses\n- [ ] Multiplayer seasonal events (if server-based)\n- [ ] Mobile app version\n\n## Credits\n\n- **Game Design**: Based on BitLife game mechanics\n- **Universe**: Hazbin Hotel by Vivziepop\n- **UI Components**: shadcn/ui\n- **Styling**: Tailwind CSS\n\n---\n\n**Ready to begin your life in Hell!**\n","size_bytes":8567},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/game/animated-loading.tsx":{"content":"import { useEffect, useState } from \"react\";\n\nexport default function AnimatedLoading() {\n  const [dots, setDots] = useState(\".\");\n  \n  useEffect(() => {\n    const interval = setInterval(() => {\n      setDots(prev => {\n        if (prev === \".\") return \"..\";\n        if (prev === \"..\") return \"...\";\n        return \".\";\n      });\n    }, 500);\n    \n    return () => clearInterval(interval);\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col items-center justify-center gap-8\">\n      {/* Animated red/gold circles */}\n      <div className=\"relative w-32 h-32\">\n        <div className=\"absolute inset-0 animate-spin border-4 border-transparent border-t-primary border-r-accent rounded-full\"></div>\n        <div className=\"absolute inset-2 animate-spin border-4 border-transparent border-b-primary border-l-accent rounded-full\" style={{ animationDirection: \"reverse\", animationDuration: \"2s\" }}></div>\n        <div className=\"absolute inset-4 flex items-center justify-center\">\n          <div className=\"text-primary text-3xl font-bold\">‚ú¶</div>\n        </div>\n      </div>\n      \n      {/* Text */}\n      <div className=\"text-center space-y-4\">\n        <h1 className=\"font-display text-3xl font-bold text-foreground\">\n          Descending into Hell{dots}\n        </h1>\n        <p className=\"text-muted-foreground text-lg\">\n          Preparing your hellish adventure\n        </p>\n      </div>\n      \n      {/* Progress bar */}\n      <div className=\"w-64 h-1 bg-card rounded-full overflow-hidden\">\n        <div className=\"h-full bg-gradient-to-r from-primary to-accent animate-pulse\"></div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1650},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"server/lib/houndify-proxy.ts":{"content":"import type { Express } from \"express\";\n\n// Houndify API configuration\nconst HOUNDIFY_API_ENDPOINT = \"https://api.houndify.com/v1/text\";\nconst CLIENT_ID = process.env.VITE_HOUNDIFY_CLIENT_ID || \"\";\nconst CLIENT_KEY = process.env.HOUNDIFY_CLIENT_KEY || \"\";\n\nexport function setupHoundifyRoutes(app: Express) {\n  // Proxy endpoint for Houndify text queries\n  app.post(\"/api/houndify-query\", async (req, res) => {\n    try {\n      const { query, userId = \"hazbin-player\" } = req.body;\n\n      if (!query) {\n        return res.status(400).json({ error: \"Query is required\" });\n      }\n\n      if (!CLIENT_ID || !CLIENT_KEY) {\n        console.warn(\"Houndify credentials missing\");\n        return res.status(503).json({ error: \"AI service not configured\" });\n      }\n\n      // Make request to Houndify API with authentication\n      const response = await fetch(HOUNDIFY_API_ENDPOINT, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-Houndify-Client-ID\": CLIENT_ID,\n          \"X-Houndify-Client-Key\": CLIENT_KEY,\n        },\n        body: JSON.stringify({\n          Query: query,\n          UserID: userId,\n          RequestID: `req-${Date.now()}-${Math.random()}`,\n        }),\n      });\n\n      if (!response.ok) {\n        console.error(`Houndify error: ${response.status}`);\n        return res.status(response.status).json({\n          error: `Houndify API error: ${response.statusText}`,\n        });\n      }\n\n      const data = await response.json();\n      res.json(data);\n    } catch (error) {\n      console.error(\"Houndify proxy error:\", error);\n      res.status(500).json({\n        error: \"Failed to process AI query\",\n        message: error instanceof Error ? error.message : \"Unknown error\",\n      });\n    }\n  });\n}\n","size_bytes":1765},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/game/event-card.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Sparkles, Zap, Send } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport eventsData from \"@/data/events.json\";\nimport { generateAIEvent } from \"@/lib/aiEventClient\";\nimport { generateEventWithUserInput } from \"@/lib/smart-ai\";\nimport { applyNpcAffects } from \"@/lib/relationshipSystem\";\nimport PowerSelector from \"@/components/game/power-selector\";\nimport type { GameState } from \"@/lib/game-state\";\nimport type { GameEvent } from \"@shared/schema\";\n\ninterface EventCardProps {\n  gameState: GameState;\n  onUpdateCharacter: (updates: Partial<GameState[\"character\"]>) => void;\n  onUpdateGameState?: (updates: any) => void;\n}\n\nexport default function EventCard({ gameState, onUpdateCharacter, onUpdateGameState }: EventCardProps) {\n  const { toast } = useToast();\n  const [currentEvent, setCurrentEvent] = useState<GameEvent | null>(null);\n  const [selectedChoice, setSelectedChoice] = useState<string | null>(null);\n  const [isAIGenerated, setIsAIGenerated] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [customInput, setCustomInput] = useState(\"\");\n  const [showCustomBox, setShowCustomBox] = useState(false);\n  const [isSubmittingCustom, setIsSubmittingCustom] = useState(false);\n\n  const events = eventsData as GameEvent[];\n  \n  const [selectedPowers, setSelectedPowers] = useState<string[]>([]);\n  const [showPowerSelector, setShowPowerSelector] = useState(false);\n\n  const handleCustomSubmit = async () => {\n    if (!customInput.trim()) return;\n    \n    setIsSubmittingCustom(true);\n    const customEvent = await generateEventWithUserInput(customInput, gameState, selectedPowers);\n    \n    if (customEvent) {\n      setCurrentEvent(customEvent);\n      setShowCustomBox(false);\n      setCustomInput(\"\");\n      setSelectedPowers([]);\n      setIsAIGenerated(true);\n      toast({ title: \"Custom Action\", description: \"Your unique approach unfolds...\" });\n    } else {\n      toast({ \n        title: \"Failed\", \n        description: \"Could not process your action.\",\n        variant: \"destructive\"\n      });\n    }\n    setIsSubmittingCustom(false);\n  };\n\n  // Load random event on mount or turn change\n  useEffect(() => {\n    loadNewEvent();\n  }, [gameState.turn]);\n\n  const loadNewEvent = async () => {\n    setIsLoading(true);\n    setSelectedChoice(null);\n    \n    // 40% chance of AI-generated event\n    const useAI = Math.random() < 0.4;\n    \n    if (useAI) {\n      const aiEvent = await generateAIEvent(gameState);\n      if (aiEvent && aiEvent.title) {\n        setCurrentEvent(aiEvent as GameEvent);\n        setIsAIGenerated(true);\n        setIsLoading(false);\n        return;\n      }\n    }\n    \n    // Fall back to static events\n    const availableEvents = events.filter(e => !e.onlyOnce || !gameState.eventLog.some(log => log.title === e.title));\n    \n    if (availableEvents.length > 0) {\n      const randomEvent = availableEvents[Math.floor(Math.random() * availableEvents.length)];\n      setCurrentEvent(randomEvent);\n      setIsAIGenerated(false);\n    }\n    setIsLoading(false);\n  };\n\n  const handleChoice = (choiceId: string, onUpdateGameState?: (updates: any) => void) => {\n    if (!currentEvent) return;\n\n    const choice = currentEvent.choices.find((c: any) => c.id === choiceId);\n    if (!choice) return;\n\n    const { outcomes } = choice;\n\n    // Apply stat changes\n    if (outcomes.statChanges) {\n      const updated = { ...gameState.character };\n      Object.entries(outcomes.statChanges).forEach(([stat, rawValue]: [string, unknown]) => {\n        const value = rawValue as number;\n        const currentValue = updated[stat as keyof typeof updated];\n        if (typeof currentValue === \"number\") {\n          // Cap health at 100, other stats grow infinitely\n          const newValue = currentValue + value;\n          if (stat === \"health\") {\n            (updated[stat as keyof typeof updated] as any) = Math.max(0, Math.min(100, newValue));\n          } else {\n            (updated[stat as keyof typeof updated] as any) = Math.max(0, newValue);\n          }\n        }\n      });\n      onUpdateCharacter(updated);\n    }\n\n    // Apply affinity changes based on choice\n    if ((currentEvent as any).npcAffinity && onUpdateGameState) {\n      const affinityChanges = (currentEvent as any).npcAffinity[choiceId];\n      if (affinityChanges) {\n        const newRelationships = { ...gameState.relationships };\n        Object.entries(affinityChanges).forEach(([npcId, change]: [string, any]) => {\n          const numChange = change as number;\n          if (newRelationships[npcId]) {\n            newRelationships[npcId] = applyNpcAffects(\n              { [npcId]: newRelationships[npcId] },\n              { [npcId]: numChange }\n            )[npcId];\n          }\n        });\n        onUpdateGameState({ relationships: newRelationships });\n      }\n    }\n\n    // Show outcome with stat changes summary\n    let statSummary = \"\";\n    if (outcomes.statChanges) {\n      const changes = Object.entries(outcomes.statChanges)\n        .filter(([_, v]: [string, unknown]) => v !== 0)\n        .map(([stat, rawValue]: [string, unknown]) => {\n          const value = rawValue as number;\n          return `${value > 0 ? \"+\" : \"\"}${value} ${stat}`;\n        })\n        .join(\", \");\n      if (changes) statSummary = `\\n\\n${changes}`;\n    }\n\n    toast({\n      title: choice.text,\n      description: outcomes.narrativeText + statSummary,\n      duration: 5000\n    });\n\n    setSelectedChoice(choiceId);\n  };\n\n  if (isLoading) {\n    return (\n      <Card className=\"border-2 border-card-border\" data-testid=\"card-event\">\n        <CardContent className=\"p-6 text-center text-muted-foreground\">\n          <p>Generating scenario...</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (!currentEvent) {\n    return (\n      <Card className=\"border-2 border-card-border\" data-testid=\"card-event\">\n        <CardContent className=\"p-6 text-center text-muted-foreground\">\n          <p>No events available. Rest for a turn.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className={`border-2 bg-gradient-to-br ${isAIGenerated ? \"border-amber-500/50 from-card to-amber-900/5\" : \"border-primary/50 from-card to-primary/5\"}`} data-testid=\"card-event\">\n      <CardHeader>\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              {isAIGenerated ? (\n                <Zap className=\"w-5 h-5 text-amber-500\" />\n              ) : (\n                <Sparkles className=\"w-5 h-5 text-primary\" />\n              )}\n              <Badge variant=\"secondary\" className=\"capitalize\">\n                {isAIGenerated ? \"AI-Generated\" : (currentEvent as any).type} Event\n              </Badge>\n            </div>\n            <CardTitle className=\"font-display text-2xl\">{currentEvent.title}</CardTitle>\n            <CardDescription className=\"mt-2 text-base\">\n              {currentEvent.description}\n            </CardDescription>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        {showCustomBox ? (\n          <div className=\"space-y-2\">\n            <Textarea\n              placeholder=\"Describe your own approach to this situation...\"\n              value={customInput}\n              onChange={(e) => setCustomInput(e.target.value)}\n              className=\"min-h-24\"\n              data-testid=\"input-custom-action\"\n            />\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={handleCustomSubmit}\n                disabled={!customInput.trim() || isSubmittingCustom}\n                className=\"flex-1 gap-2\"\n                data-testid=\"button-submit-custom\"\n              >\n                <Send className=\"w-4 h-4\" />\n                {isSubmittingCustom ? \"Processing...\" : \"Take Action\"}\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => { setShowCustomBox(false); setCustomInput(\"\"); }}\n                data-testid=\"button-cancel-custom\"\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        ) : (\n          <>\n            {showPowerSelector && (\n              <PowerSelector\n                gameState={gameState}\n                selectedPowerIds={selectedPowers}\n                onTogglePower={(powerId) => {\n                  setSelectedPowers(prev =>\n                    prev.includes(powerId)\n                      ? prev.filter(p => p !== powerId)\n                      : [...prev, powerId]\n                  );\n                }}\n                onClose={() => setShowPowerSelector(false)}\n              />\n            )}\n            {currentEvent.choices.map((choice) => (\n              <Card\n                key={choice.id}\n                className={`cursor-pointer hover-elevate active-elevate-2 border-card-border transition-all ${\n                  selectedChoice === choice.id ? \"ring-2 ring-primary\" : \"\"\n                }`}\n                onClick={() => !selectedChoice && handleChoice(choice.id)}\n                data-testid={`button-choice-${choice.id}`}\n              >\n                <CardContent className=\"p-4\">\n                  <p className=\"font-semibold mb-2\">{choice.text}</p>\n                  {selectedChoice !== choice.id && (\n                    <p className=\"text-xs text-muted-foreground\">Click to choose</p>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n            {!selectedChoice && (\n              <div className=\"space-y-2\">\n                {showCustomBox && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"w-full\"\n                    onClick={() => setShowPowerSelector(!showPowerSelector)}\n                    data-testid=\"button-toggle-powers\"\n                  >\n                    ‚ö° {showPowerSelector ? \"Hide Powers\" : \"Select Powers\"}\n                  </Button>\n                )}\n                <Button\n                  variant=\"outline\"\n                  className=\"w-full\"\n                  onClick={() => setShowCustomBox(true)}\n                  data-testid=\"button-custom-action\"\n                >\n                  üé≤ Create Your Own Path\n                </Button>\n              </div>\n            )}\n          </>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":10711},"client/src/components/game/map-panel.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MapPin } from \"lucide-react\";\nimport districtsData from \"@/data/districts.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface MapPanelProps {\n  territories: GameState[\"territory\"];\n}\n\nexport default function MapPanel({ territories }: MapPanelProps) {\n  const districts = districtsData as Array<{ id: string; name: string; dangerLevel: number }>;\n\n  return (\n    <Card className=\"border-2 border-card-border\" data-testid=\"card-map\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-lg font-display flex items-center gap-2\">\n          <MapPin className=\"w-5 h-5\" />\n          Pentagram City\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-2 gap-2\">\n          {districts.map((district) => {\n            const isControlled = territories[district.id]?.owned || false;\n            \n            return (\n              <div\n                key={district.id}\n                className={`p-3 rounded-md border transition-all hover-elevate cursor-pointer ${\n                  isControlled\n                    ? \"bg-primary/10 border-primary\"\n                    : \"bg-card border-card-border\"\n                }`}\n                data-testid={`district-${district.id}`}\n              >\n                <div className=\"flex items-start justify-between gap-2 mb-1\">\n                  <span className=\"font-semibold text-sm\">{district.name}</span>\n                  {isControlled && (\n                    <Badge variant=\"default\" className=\"text-xs\">Your Territory</Badge>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <span className=\"text-xs text-muted-foreground\">Danger:</span>\n                  <div className=\"flex gap-0.5\">\n                    {[...Array(5)].map((_, i) => (\n                      <div\n                        key={i}\n                        className={`w-2 h-2 rounded-full ${\n                          i < district.dangerLevel ? \"bg-red-500\" : \"bg-muted\"\n                        }`}\n                      />\n                    ))}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":2397},"client/src/components/game/npc-panel.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Heart, Users } from \"lucide-react\";\nimport npcsData from \"@/data/npcs.json\";\nimport { getRelationshipStatus, getRelationshipColor } from \"@/lib/relationshipSystem\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface NPCPanelProps {\n  relationships: GameState[\"relationships\"];\n}\n\nexport default function NPCPanel({ relationships }: NPCPanelProps) {\n  const npcs = npcsData as Array<{ id: string; name: string; faction: string }>;\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center gap-2\">\n        <Users className=\"w-5 h-5 text-primary\" />\n        <h2 className=\"font-display text-xl font-bold\">Relationships</h2>\n      </div>\n\n      {npcs.map((npc) => {\n        const rel = relationships[npc.id] || { affinity: 0, isRomanced: false, isRival: false, favorsOwed: 0 };\n        const status = getRelationshipStatus(rel.affinity);\n        const color = getRelationshipColor(rel.affinity);\n\n        return (\n          <Card key={npc.id} className=\"border-card-border\" data-testid={`npc-${npc.id}`}>\n            <CardHeader className=\"pb-2\">\n              <div className=\"flex items-start justify-between gap-2\">\n                <div className=\"flex-1\">\n                  <CardTitle className=\"text-base\">{npc.name}</CardTitle>\n                  <p className=\"text-xs text-muted-foreground\">{npc.faction}</p>\n                </div>\n                {rel.isRomanced && (\n                  <Heart className=\"w-4 h-4 text-pink-500\" />\n                )}\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center justify-between text-xs\">\n                  <span className=\"text-muted-foreground\">Affinity</span>\n                  <span className={`font-semibold ${color}`}>\n                    {rel.affinity > 0 ? \"+\" : \"\"}{rel.affinity}\n                  </span>\n                </div>\n                <Progress \n                  value={Math.max(0, Math.min(100, rel.affinity + 50))} \n                  className=\"h-1.5\" \n                />\n              </div>\n              <Badge variant={rel.affinity >= 50 ? \"secondary\" : rel.affinity < -30 ? \"destructive\" : \"outline\"} className=\"text-xs\">\n                {status}\n              </Badge>\n            </CardContent>\n          </Card>\n        );\n      })}\n    </div>\n  );\n}\n","size_bytes":2583},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/lib/smart-ai.ts":{"content":"import type { GameState } from \"./game-state\";\nimport { scenarios, getRelevantScenarios } from \"@/data/ai-scenarios\";\nimport districts from \"@/data/districts.json\";\n\nexport interface SmartOutcome {\n  title: string;\n  narrative: string;\n  statChanges: Record<string, number>;\n}\n\n/**\n * Smart AI system that generates contextual outcomes based on player actions\n * Considers game state, character stats, and action keywords\n */\nexport async function generateSmartOutcome(\n  userInput: string,\n  gameState: GameState\n): Promise<SmartOutcome | null> {\n  try {\n    // Get relevant scenarios based on keywords\n    const relevantScenarios = getRelevantScenarios(userInput, gameState);\n    \n    if (!relevantScenarios || relevantScenarios.length === 0) {\n      return null;\n    }\n\n    // Select a random scenario from matches\n    const scenario = relevantScenarios[Math.floor(Math.random() * relevantScenarios.length)];\n    \n    // Pick a random outcome from the scenario\n    const outcome = scenario.outcomes[Math.floor(Math.random() * scenario.outcomes.length)];\n    \n    // Apply modifiers based on character stats for more dynamic results\n    const modifiedStatChanges = applyCharacterModifiers(\n      { ...outcome.statChanges },\n      gameState.character\n    );\n\n    return {\n      title: outcome.title,\n      narrative: enrichNarrative(outcome.narrative, gameState.character),\n      statChanges: modifiedStatChanges\n    };\n  } catch (error) {\n    console.error(\"Error generating smart outcome:\", error);\n    return null;\n  }\n}\n\n/**\n * Apply character-specific modifiers to stat changes\n * High power characters get better combat outcomes, etc.\n */\nfunction applyCharacterModifiers(\n  statChanges: Record<string, number>,\n  character: any\n): Record<string, number> {\n  const modified = { ...statChanges };\n\n  // High power characters are more effective at power-based actions\n  if (character.power > 15 && modified.power && modified.power > 0) {\n    modified.power = Math.round(modified.power * 1.2);\n  }\n\n  // High corruption influences outcome morality\n  if (character.corruption > 20 && modified.corruption !== undefined) {\n    modified.corruption = Math.round(modified.corruption * 1.1);\n  }\n\n  // High empathy softens negative consequences\n  if (character.empathy > 15 && modified.health && modified.health < 0) {\n    modified.health = Math.round(modified.health * 0.8);\n  }\n\n  // High control increases success at manipulation\n  if (character.control > 15 && modified.control && modified.control > 0) {\n    modified.control = Math.round(modified.control * 1.15);\n  }\n\n  // Cap stat changes at reasonable levels\n  Object.keys(modified).forEach(key => {\n    if (Math.abs(modified[key]) > 30) {\n      modified[key] = Math.sign(modified[key]) * 30;\n    }\n  });\n\n  return modified;\n}\n\n/**\n * Enrich narrative with character-specific details\n */\nfunction enrichNarrative(narrative: string, character: any): string {\n  // Add character name to make it personal\n  if (!narrative.includes(\"you\") && !narrative.includes(\"You\")) {\n    return `${character.firstName}, ${narrative}`;\n  }\n\n  // Customize based on power level\n  if (character.power > 20 && !narrative.includes(\"your\")) {\n    // Already detailed enough\n  }\n\n  return narrative;\n}\n\n/**\n * Generate custom outcome from user action with AI templates\n */\nexport async function generateCustomOutcome(\n  userInput: string,\n  gameState: GameState\n): Promise<SmartOutcome | null> {\n  // Use smart AI system instead of Houndify API\n  return generateSmartOutcome(userInput, gameState);\n}\n\n/**\n * Generate full event object for custom player actions\n */\nexport async function generateEventWithUserInput(\n  userInput: string,\n  gameState: GameState,\n  selectedPowers?: string[]\n): Promise<any | null> {\n  try {\n    const outcome = await generateCustomOutcome(userInput, gameState);\n    if (!outcome) return null;\n\n    // Include power descriptions if selected\n    let powerBonus = \"\";\n    if (selectedPowers && selectedPowers.length > 0) {\n      powerBonus = ` [Powers Used: ${selectedPowers.join(\", \")}]`;\n      // Enhance outcome with power benefits\n      Object.entries(outcome.statChanges).forEach(([key, value]) => {\n        if (typeof value === \"number\") {\n          outcome.statChanges[key] = Math.round(value * 1.3); // 30% boost from powers\n        }\n      });\n    }\n\n    return {\n      id: `custom-${Date.now()}`,\n      title: outcome.title,\n      description: `You decide to: \"${userInput}\"${powerBonus}`,\n      type: \"custom\",\n      choices: [\n        {\n          id: \"accept\",\n          text: \"Accept this outcome\",\n          outcomes: {\n            statChanges: outcome.statChanges,\n            narrativeText: outcome.narrative\n          }\n        },\n        {\n          id: \"undo\",\n          text: \"Reconsider your action\",\n          outcomes: {\n            statChanges: {},\n            narrativeText: \"You change your mind and take a different path.\"\n          }\n        }\n      ],\n      onlyOnce: false\n    };\n  } catch (error) {\n    console.error(\"Error generating event with user input:\", error);\n    return null;\n  }\n}\n\n/**\n * Generate outcome for district activities (challenges, territory claims, etc.)\n */\nexport async function generateActivityOutcome(\n  activity: any,\n  gameState: GameState,\n  district: any\n): Promise<SmartOutcome | null> {\n  try {\n    // Select outcome based on activity type and stats\n    const outcomes: Record<string, SmartOutcome[]> = {\n      \"challenge-overlord\": [\n        {\n          title: \"Victory Against All Odds\",\n          narrative: `You challenged the ruler of ${district?.name} and won. The power transfer is immediate and absolute.`,\n          statChanges: { power: 20, influence: 15, control: 10, wealth: 500, corruption: 5 }\n        },\n        {\n          title: \"Pyrrhic Victory\",\n          narrative: `You defeated the overlord, but the battle was costly. You won, but you're scarred.`,\n          statChanges: { power: 15, influence: 10, health: -40, wealth: 300, control: 8 }\n        },\n        {\n          title: \"Crushing Defeat\",\n          narrative: `The overlord was too powerful. You barely escaped with your life.`,\n          statChanges: { power: -5, health: -60, control: -5, wealth: -200, empathy: 2 }\n        }\n      ],\n      \"duel-rival\": [\n        {\n          title: \"Dominance Proven\",\n          narrative: \"You destroyed your rival in single combat. No one questions your superiority now.\",\n          statChanges: { power: 8, influence: 7, wealth: 250, control: 5 }\n        },\n        {\n          title: \"Narrow Victory\",\n          narrative: \"The duel was close, but you emerged victorious. Barely.\",\n          statChanges: { power: 5, health: -20, wealth: 150, influence: 4 }\n        },\n        {\n          title: \"Humiliating Defeat\",\n          narrative: \"You were outmatched. Your rival destroyed you in front of everyone.\",\n          statChanges: { power: -3, health: -40, influence: -8, control: -3 }\n        }\n      ],\n      \"seize-territory\": [\n        {\n          title: \"Territory Claimed\",\n          narrative: `${district?.name} is now yours. Sovereignty established through strength.`,\n          statChanges: { control: 12, influence: 12, power: 10, wealth: 400, corruption: 8 }\n        },\n        {\n          title: \"Partial Control\",\n          narrative: \"You've taken some control, but rivals still contest your rule.\",\n          statChanges: { control: 6, influence: 6, power: 5, wealth: 200, corruption: 4 }\n        },\n        {\n          title: \"Invasion Failed\",\n          narrative: \"The resistance was too strong. You're forced to retreat.\",\n          statChanges: { control: -3, power: -2, health: -30, wealth: -300 }\n        }\n      ],\n      \"gather-allies\": [\n        {\n          title: \"Powerful Alliance Formed\",\n          narrative: \"You've gathered a formidable coalition. Together, you're unstoppable.\",\n          statChanges: { influence: 12, power: 8, wealth: -150, control: 8 }\n        },\n        {\n          title: \"Some Join Your Cause\",\n          narrative: \"You've attracted several useful allies. Your network grows.\",\n          statChanges: { influence: 7, power: 4, wealth: -100, control: 4 }\n        },\n        {\n          title: \"Recruitment Failed\",\n          narrative: \"No one wants to join you. Your reputation precedes you, and not in a good way.\",\n          statChanges: { influence: -4, wealth: -50, control: -2 }\n        }\n      ],\n      \"undercover-plot\": [\n        {\n          title: \"Conspiracy Succeeds\",\n          narrative: \"Your plot unfolds perfectly. The district is yours to control from the shadows.\",\n          statChanges: { control: 14, influence: 10, power: 6, wealth: 300, corruption: 12 }\n        },\n        {\n          title: \"Plot Partially Succeeds\",\n          narrative: \"Part of your plan works. You've gained leverage.\",\n          statChanges: { control: 8, influence: 6, wealth: 150, corruption: 6 }\n        },\n        {\n          title: \"Discovered!\",\n          narrative: \"Your plot is exposed. Now you're hunted.\",\n          statChanges: { control: -8, power: -5, wealth: -400, corruption: 8, health: -30 }\n        }\n      ],\n      \"corrupt-locals\": [\n        {\n          title: \"Population Turned\",\n          narrative: \"The locals now serve you, not their ruler. A revolution is inevitable.\",\n          statChanges: { influence: 14, corruption: 14, control: 10, wealth: 250, power: 8 }\n        },\n        {\n          title: \"Some Corruption Takes Hold\",\n          narrative: \"You've turned some to your cause. Not enough, but it's a start.\",\n          statChanges: { influence: 7, corruption: 8, wealth: 100, control: 5 }\n        },\n        {\n          title: \"Resistance Unbreakable\",\n          narrative: \"The people refuse your darkness. Their hope is too strong.\",\n          statChanges: { influence: -5, corruption: -3, wealth: -200, empathy: -2 }\n        }\n      ]\n    };\n\n    const activityOutcomes = outcomes[activity.action] || [];\n    if (!activityOutcomes.length) return null;\n\n    // Weight outcomes based on character stats\n    let selectedIndex = Math.floor(Math.random() * activityOutcomes.length);\n    \n    // Better chance of success with high stats\n    if (gameState.character.power > 25) selectedIndex = 0;\n    else if (gameState.character.power > 15 && Math.random() < 0.6) selectedIndex = 0;\n    \n    const outcome = activityOutcomes[selectedIndex];\n    return outcome;\n  } catch (error) {\n    console.error(\"Error generating activity outcome:\", error);\n    return null;\n  }\n}\n","size_bytes":10501},"client/src/components/character-creation/name-step.tsx":{"content":"import { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Shuffle } from \"lucide-react\";\nimport { generateRandomName } from \"@/lib/gameHelpers\";\nimport type { CharacterData } from \"@/pages/character-creation\";\n\ninterface NameStepProps {\n  data: CharacterData;\n  onChange: (data: Partial<CharacterData>) => void;\n}\n\nexport default function NameStep({ data, onChange }: NameStepProps) {\n  const handleRandomize = () => {\n    const { firstName, lastName } = generateRandomName();\n    onChange({ firstName, lastName });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"firstName\" className=\"text-base font-semibold\">\n            First Name\n          </Label>\n          <Input\n            id=\"firstName\"\n            value={data.firstName}\n            onChange={(e) => onChange({ firstName: e.target.value })}\n            placeholder=\"Enter your demon's first name\"\n            className=\"text-lg\"\n            data-testid=\"input-first-name\"\n          />\n        </div>\n\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"lastName\" className=\"text-base font-semibold\">\n            Last Name\n          </Label>\n          <Input\n            id=\"lastName\"\n            value={data.lastName}\n            onChange={(e) => onChange({ lastName: e.target.value })}\n            placeholder=\"Enter your demon's last name\"\n            className=\"text-lg\"\n            data-testid=\"input-last-name\"\n          />\n        </div>\n\n        <Button\n          variant=\"outline\"\n          onClick={handleRandomize}\n          className=\"w-full gap-2\"\n          type=\"button\"\n          data-testid=\"button-randomize-name\"\n        >\n          <Shuffle className=\"w-4 h-4\" />\n          Randomize Name\n        </Button>\n      </div>\n\n      {data.firstName && data.lastName && (\n        <div className=\"p-4 bg-card rounded-md border border-card-border\">\n          <p className=\"text-sm text-muted-foreground mb-1\">Your demon name:</p>\n          <p className=\"font-display text-3xl font-bold text-primary\">\n            {data.firstName} {data.lastName}\n          </p>\n        </div>\n      )}\n\n      <div className=\"p-4 bg-muted/50 rounded-md space-y-2\">\n        <p className=\"text-sm font-semibold\">Name Suggestions:</p>\n        <p className=\"text-xs text-muted-foreground\">\n          Choose names that fit the dark, theatrical Hazbin Hotel aesthetic. Think Victorian elegance, sinful puns, or demonic wordplay.\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":2621},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/lib/game-state.ts":{"content":"import type { Character } from \"@shared/schema\";\nimport type { Relationship } from \"./relationshipSystem\";\n\nexport interface GameState {\n  character: Character;\n  turn: number;\n  slot: number; // Track which save slot this game is in\n  eventLog: Array<{ turn: number; title: string; choices: string[] }>;\n  relationships: Record<string, Relationship>;\n  territory: Record<string, string>; // district -> owner\n  actionCooldowns: Record<string, number>;\n  actionUseCounts: Record<string, number>;\n}\n\nexport interface SaveSlot {\n  slot: number;\n  gameState: GameState;\n  characterName: string;\n  timestamp: number;\n}\n\n// Import to ensure it's available\nimport { initializeAllRelationships } from \"./relationshipSystem\";\n\nconst STORAGE_KEY = \"hazbin-game-saves\";\nconst MAX_SAVES = 5;\n\n/**\n * Save game to a specific slot (default slot 1)\n */\nexport async function saveGame(state: GameState, slot: number = 1): Promise<void> {\n  try {\n    const saves = getAllSaves();\n    const slotData: SaveSlot = {\n      slot,\n      gameState: state,\n      characterName: state.character.name || \"Unknown\",\n      timestamp: Date.now()\n    };\n    \n    saves[slot - 1] = slotData;\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(saves));\n    console.log(`‚úì Game saved to slot ${slot}`);\n  } catch (error) {\n    console.error(\"Error saving game:\", error);\n  }\n}\n\n/**\n * Get all saves\n */\nexport function getAllSaves(): SaveSlot[] {\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY);\n    if (!saved) return [];\n    const parsed = JSON.parse(saved) as SaveSlot[];\n    return parsed.slice(0, MAX_SAVES);\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Load game from a specific slot (default slot 1)\n */\nexport async function loadGame(slot: number = 1): Promise<GameState | null> {\n  try {\n    const saves = getAllSaves();\n    const save = saves[slot - 1];\n    if (!save) return null;\n    \n    console.log(`‚úì Game loaded from slot ${slot}`);\n    return save.gameState;\n  } catch (error) {\n    console.error(\"Error loading game:\", error);\n    return null;\n  }\n}\n\n/**\n * Load the most recent save\n */\nexport async function loadLatestSave(): Promise<(GameState & { slot: number }) | null> {\n  try {\n    const saves = getAllSaves().filter(s => s);\n    if (saves.length === 0) return null;\n    const latest = saves.reduce((a, b) => (a.timestamp > b.timestamp ? a : b));\n    console.log(`‚úì Game loaded from slot ${latest.slot}`);\n    return { ...latest.gameState, slot: latest.slot };\n  } catch (error) {\n    console.error(\"Error loading latest game:\", error);\n    return null;\n  }\n}\n\n/**\n * Delete game from a specific slot\n */\nexport async function deleteGame(slot: number = 1): Promise<void> {\n  try {\n    const saves = getAllSaves();\n    saves[slot - 1] = null as any;\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(saves.filter(s => s)));\n    console.log(`‚úì Game deleted from slot ${slot}`);\n  } catch (error) {\n    console.error(\"Error deleting game:\", error);\n  }\n}\n\n/**\n * Delete all saves completely (for fresh start)\n */\nexport async function deleteAllSaves(): Promise<void> {\n  try {\n    localStorage.removeItem(STORAGE_KEY);\n    console.log(`‚úì All saves deleted`);\n  } catch (error) {\n    console.error(\"Error deleting all saves:\", error);\n  }\n}\n\n/**\n * Create new game state from character\n */\nexport function createNewGameState(character: Character, slot: number = 1): GameState {\n  return {\n    character,\n    turn: 1,\n    slot,\n    eventLog: [],\n    relationships: initializeAllRelationships(),\n    territory: {},\n    actionCooldowns: {},\n    actionUseCounts: {}\n  };\n}\n\n/**\n * Export game to JSON string\n */\nexport function exportGameSave(state: GameState): string {\n  return JSON.stringify(state, null, 2);\n}\n\n/**\n * Import game from JSON string\n */\nexport function importGameSave(json: string): GameState | null {\n  try {\n    const parsed = JSON.parse(json);\n    if (parsed.character && parsed.turn !== undefined && parsed.eventLog) {\n      return parsed as GameState;\n    }\n    return null;\n  } catch (error) {\n    console.error(\"Error parsing game save:\", error);\n    return null;\n  }\n}\n","size_bytes":4102},"client/src/lib/achievements.ts":{"content":"export interface Achievement {\n  id: string;\n  title: string;\n  description: string;\n  unlocked: boolean;\n  unlockedAt?: number;\n}\n\nexport const ALL_ACHIEVEMENTS: Achievement[] = [\n  { id: \"first-steps\", title: \"First Steps\", description: \"Create your character\", unlocked: false },\n  { id: \"power-seeker\", title: \"Power Seeker\", description: \"Reach 50 Power\", unlocked: false },\n  { id: \"overlord\", title: \"Overlord\", description: \"Reach Overlord rank\", unlocked: false },\n  { id: \"territory-master\", title: \"Territory Master\", description: \"Control 3 districts\", unlocked: false },\n  { id: \"social-butterfly\", title: \"Social Butterfly\", description: \"Reach 50 Influence\", unlocked: false },\n  { id: \"redemption\", title: \"Redemption\", description: \"Reach 100 Empathy\", unlocked: false },\n  { id: \"fallen\", title: \"Fallen\", description: \"Reach 50 Corruption\", unlocked: false },\n  { id: \"wealthy\", title: \"Wealthy Demon\", description: \"Accumulate 1000 soul coins\", unlocked: false },\n  { id: \"10-turns\", title: \"Survivor\", description: \"Survive 10 turns\", unlocked: false },\n  { id: \"romance\", title: \"Romantic\", description: \"Romance an NPC\", unlocked: false }\n];\n\nexport function checkAchievements(gameState: any): Achievement[] {\n  const achievements = [...ALL_ACHIEVEMENTS];\n  \n  if (gameState.turn >= 1) achievements.find(a => a.id === \"first-steps\")!.unlocked = true;\n  if (gameState.character.power >= 50) achievements.find(a => a.id === \"power-seeker\")!.unlocked = true;\n  if (gameState.character.rank === \"overlord\") achievements.find(a => a.id === \"overlord\")!.unlocked = true;\n  if (gameState.character.influence >= 50) achievements.find(a => a.id === \"social-butterfly\")!.unlocked = true;\n  if (gameState.character.empathy >= 100) achievements.find(a => a.id === \"redemption\")!.unlocked = true;\n  if (gameState.character.corruption >= 50) achievements.find(a => a.id === \"fallen\")!.unlocked = true;\n  if (gameState.character.wealth >= 1000) achievements.find(a => a.id === \"wealthy\")!.unlocked = true;\n  if (gameState.turn >= 10) achievements.find(a => a.id === \"10-turns\")!.unlocked = true;\n  \n  return achievements;\n}\n","size_bytes":2132},"server/app.ts":{"content":"import { type Server } from \"node:http\";\n\nimport express, {\n  type Express,\n  type Request,\n  Response,\n  NextFunction,\n} from \"express\";\n\nimport { registerRoutes } from \"./routes\";\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport const app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\nexport default async function runApp(\n  setup: (app: Express, server: Server) => Promise<void>,\n) {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly run the final setup after setting up all the other routes so\n  // the catch-all route doesn't interfere with the other routes\n  await setup(app, server);\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n}\n","size_bytes":2482},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n        display: [\"Playfair Display\", \"serif\"],\n        ui: [\"DM Sans\", \"Inter\", \"sans-serif\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4146},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/lib/relationshipSystem.ts":{"content":"import npcsData from \"@/data/npcs.json\";\n\nexport interface Relationship {\n  affinity: number;\n  isRomanced: boolean;\n  isRival: boolean;\n  favorsOwed: number;\n}\n\n// Initialize all NPCs with neutral relationships\nexport function initializeAllRelationships(): Record<string, Relationship> {\n  const relationships: Record<string, Relationship> = {};\n  const npcs = npcsData as any[];\n  \n  npcs.forEach(npc => {\n    relationships[npc.id] = {\n      affinity: 0,\n      isRomanced: false,\n      isRival: false,\n      favorsOwed: 0\n    };\n  });\n  \n  return relationships;\n}\n\nexport function getNpcData(npcId: string) {\n  const npcs = npcsData as any[];\n  return npcs.find(n => n.id === npcId);\n}\n\nexport function updateRelationship(current: Relationship | undefined, change: number, maxAffinity: number = 100): Relationship {\n  const existing = current || { affinity: 0, isRomanced: false, isRival: false, favorsOwed: 0 };\n  const newAffinity = Math.max(-100, Math.min(maxAffinity, existing.affinity + change));\n  \n  return {\n    ...existing,\n    affinity: newAffinity,\n    isRival: newAffinity < -30,\n    isRomanced: existing.isRomanced || newAffinity >= 75\n  };\n}\n\n// Calculate affinity change based on character traits and NPC preferences\nexport function calculateAffinityChange(\n  npcId: string,\n  characterTraits: string[],\n  interactionType: 'positive' | 'negative' | 'territory' | 'romance' | 'conflict'\n): number {\n  const npc = getNpcData(npcId);\n  if (!npc) return 0;\n\n  let change = 0;\n\n  if (interactionType === 'positive') {\n    const affinity = characterTraits.filter(t => npc.affinityTraits?.includes(t)).length;\n    change = 2 + (affinity * 1); // Reduced from 5 + (affinity * 3)\n  } else if (interactionType === 'negative') {\n    const disliked = characterTraits.filter(t => npc.dislikedTraits?.includes(t)).length;\n    change = -3 - (disliked * 1); // Reduced from -5 - (disliked * 2)\n  } else if (interactionType === 'territory') {\n    // Respect overlords in their own domain\n    change = 3; // Reduced from 8\n  } else if (interactionType === 'romance') {\n    change = 4; // Reduced from 10\n  } else if (interactionType === 'conflict') {\n    // Fighting overlords in their own domain damages affinity significantly\n    change = -15; // Keep same as it's already harsh\n  }\n\n  return change;\n}\n\nexport function getRelationshipStatus(affinity: number): string {\n  if (affinity >= 75) return \"Devoted Ally\";\n  if (affinity >= 50) return \"Close Friend\";\n  if (affinity >= 25) return \"Friendly\";\n  if (affinity >= 0) return \"Acquaintance\";\n  if (affinity >= -30) return \"Disliked\";\n  if (affinity >= -75) return \"Hostile\";\n  return \"Enemy\";\n}\n\nexport function getRelationshipColor(affinity: number): string {\n  if (affinity >= 75) return \"text-green-600\";\n  if (affinity >= 50) return \"text-green-500\";\n  if (affinity >= 25) return \"text-blue-500\";\n  if (affinity >= 0) return \"text-amber-500\";\n  if (affinity >= -30) return \"text-orange-500\";\n  if (affinity >= -75) return \"text-red-500\";\n  return \"text-red-700\";\n}\n\nexport function applyNpcAffects(relationships: Record<string, Relationship>, affinityChanges: Record<string, number>): Record<string, Relationship> {\n  const newRelationships = { ...relationships };\n  \n  Object.entries(affinityChanges).forEach(([npcId, change]) => {\n    newRelationships[npcId] = updateRelationship(\n      newRelationships[npcId],\n      change\n    );\n  });\n  \n  return newRelationships;\n}\n\n// Get battle affinity bonus\nexport function getBattleAffinityBonus(affinity: number): { healthBonus: number; damageReduction: number } {\n  const normalizedAffinity = Math.max(-100, Math.min(100, affinity));\n  const healthBonus = Math.max(0, Math.floor(normalizedAffinity * 1.5));\n  const damageReduction = Math.max(0, Math.floor(normalizedAffinity * 0.5));\n  return { healthBonus, damageReduction };\n}\n","size_bytes":3834},"client/src/lib/powerSystem.ts":{"content":"import type { GameState } from \"./game-state\";\nimport powersData from \"@/data/powers.json\";\n\nexport interface PowerState {\n  id: string;\n  level: number;\n  experience: number;\n  cooldownRemaining: number;\n}\n\nexport interface Power {\n  id: string;\n  name: string;\n  type: string;\n  description: string;\n  baseCooldown: number;\n  controlCost: number;\n  unlockRequirements?: { stat: string; minimum: number };\n  maxLevel?: number;\n}\n\nconst POWERS = powersData as Power[];\nconst XP_PER_LEVEL = 100;\nconst MAX_POWER_LEVEL = 10;\n\nexport function getPowerById(id: string): Power | undefined {\n  return POWERS.find(p => p.id === id);\n}\n\nexport function canUsePower(gameState: GameState, powerId: string, powers: PowerState[]): { can: boolean; reason?: string } {\n  const powerState = powers.find(p => p.id === powerId);\n  if (!powerState) return { can: false, reason: \"Power not equipped\" };\n  \n  if (powerState.cooldownRemaining > 0) {\n    return { can: false, reason: `On cooldown for ${powerState.cooldownRemaining} more turns` };\n  }\n  \n  const power = getPowerById(powerId);\n  if (!power) return { can: false, reason: \"Power not found\" };\n  \n  if (gameState.character.control < power.controlCost) {\n    return { can: false, reason: `Requires ${power.controlCost} Control (you have ${gameState.character.control})` };\n  }\n  \n  return { can: true };\n}\n\nexport function usePower(powerState: PowerState, baseCooldown: number): PowerState {\n  return {\n    ...powerState,\n    cooldownRemaining: baseCooldown,\n    experience: Math.min(powerState.experience + 15, XP_PER_LEVEL * MAX_POWER_LEVEL),\n    level: Math.min(\n      Math.floor((powerState.experience + 15) / XP_PER_LEVEL) + 1,\n      MAX_POWER_LEVEL\n    )\n  };\n}\n\nexport function tickPowerCooldowns(powers: PowerState[]): PowerState[] {\n  return powers.map(p => ({\n    ...p,\n    cooldownRemaining: Math.max(0, p.cooldownRemaining - 1)\n  }));\n}\n\nexport function getPowerProgress(experience: number): { level: number; levelXp: number; nextLevelXp: number } {\n  const level = Math.min(Math.floor(experience / XP_PER_LEVEL) + 1, MAX_POWER_LEVEL);\n  const levelXp = experience % XP_PER_LEVEL;\n  const nextLevelXp = Math.min(XP_PER_LEVEL, XP_PER_LEVEL);\n  return { level, levelXp, nextLevelXp };\n}\n","size_bytes":2238},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/lib/game-context.tsx":{"content":"import { createContext, useContext, useState, useCallback } from \"react\";\nimport type { Character } from \"@shared/schema\";\nimport { loadGame, saveGame, createNewGameState, type GameState } from \"./game-state\";\n\ninterface GameContextType {\n  gameState: GameState | null;\n  setGameState: (state: GameState) => void;\n  startNewGame: (character: Character) => void;\n  continueGame: () => boolean;\n  nextTurn: () => void;\n  updateCharacterStat: (stat: keyof Character, value: number) => void;\n  addEventToLog: (title: string, choices: string[]) => void;\n}\n\nconst GameContext = createContext<GameContextType | undefined>(undefined);\n\nexport function GameProvider({ children }: { children: React.ReactNode }) {\n  const [gameState, setGameStateInternal] = useState<GameState | null>(() => loadGame());\n\n  const setGameState = useCallback((state: GameState) => {\n    setGameStateInternal(state);\n    saveGame(state);\n  }, []);\n\n  const startNewGame = useCallback((character: Character) => {\n    const newState = createNewGameState(character);\n    setGameState(newState);\n  }, [setGameState]);\n\n  const continueGame = useCallback((): boolean => {\n    const saved = loadGame();\n    if (saved) {\n      setGameStateInternal(saved);\n      return true;\n    }\n    return false;\n  }, []);\n\n  const nextTurn = useCallback(() => {\n    if (!gameState) return;\n    \n    const updatedState = {\n      ...gameState,\n      turn: gameState.turn + 1\n    };\n    setGameState(updatedState);\n  }, [gameState, setGameState]);\n\n  const updateCharacterStat = useCallback((stat: keyof Character, value: number) => {\n    if (!gameState) return;\n\n    const updatedState = {\n      ...gameState,\n      character: {\n        ...gameState.character,\n        [stat]: Math.max(0, value)\n      }\n    };\n    setGameState(updatedState);\n  }, [gameState, setGameState]);\n\n  const addEventToLog = useCallback((title: string, choices: string[]) => {\n    if (!gameState) return;\n\n    const updatedState = {\n      ...gameState,\n      eventLog: [\n        ...gameState.eventLog,\n        {\n          turn: gameState.turn,\n          title,\n          choices\n        }\n      ]\n    };\n    setGameState(updatedState);\n  }, [gameState, setGameState]);\n\n  const value: GameContextType = {\n    gameState,\n    setGameState,\n    startNewGame,\n    continueGame,\n    nextTurn,\n    updateCharacterStat,\n    addEventToLog\n  };\n\n  return (\n    <GameContext.Provider value={value}>\n      {children}\n    </GameContext.Provider>\n  );\n}\n\nexport function useGameContext() {\n  const context = useContext(GameContext);\n  if (!context) {\n    throw new Error(\"useGameContext must be used within GameProvider\");\n  }\n  return context;\n}\n","size_bytes":2658},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport Home from \"@/pages/home\";\nimport CharacterCreation from \"@/pages/character-creation\";\nimport GamePage from \"@/pages/game\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Home} />\n      <Route path=\"/character-creation\" component={CharacterCreation} />\n      <Route path=\"/game\" component={GamePage} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nexport default function App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Router />\n        <Toaster />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n","size_bytes":913},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/game/location-panel.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MapPin, Compass } from \"lucide-react\";\nimport districts from \"@/data/districts.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface LocationPanelProps {\n  gameState: GameState;\n  onUpdateCharacter: (updates: any) => void;\n}\n\nexport default function LocationPanel({ gameState, onUpdateCharacter }: LocationPanelProps) {\n  const [expandedDistrict, setExpandedDistrict] = useState<string | null>(null);\n\n  const currentDistrict = districts.find(d => d.id === gameState.character.currentLocation);\n\n  const handleTravel = (districtId: string) => {\n    const newDistrict = districts.find(d => d.id === districtId);\n    if (!newDistrict) return;\n\n    // Check power requirement\n    const requiredPower = newDistrict.difficultyRating * 3 + 5; // Scale by difficulty\n    if (gameState.character.power < requiredPower) {\n      return; // Toast handled below\n    }\n\n    // Update character location\n    onUpdateCharacter({\n      ...gameState.character,\n      currentLocation: districtId\n    });\n  };\n\n  const getDifficultyColor = (rating: number) => {\n    if (rating <= 3) return \"text-green-500\";\n    if (rating <= 6) return \"text-yellow-500\";\n    if (rating <= 8) return \"text-orange-500\";\n    return \"text-red-500\";\n  };\n\n  return (\n    <Card className=\"border-2 border-card-border\" data-testid=\"card-location\">\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0\">\n        <div>\n          <CardTitle className=\"flex items-center gap-2\">\n            <MapPin className=\"w-5 h-5 text-primary\" />\n            Pentagram City\n          </CardTitle>\n          <CardDescription>\n            Currently: {currentDistrict?.name || \"Unknown\"}\n          </CardDescription>\n        </div>\n        <Compass className=\"w-5 h-5 text-muted-foreground\" />\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        <div className=\"grid grid-cols-1 gap-2 max-h-64 overflow-y-auto\">\n          {districts.map((district) => (\n            <div key={district.id}>\n              <Button\n                variant={gameState.character.currentLocation === district.id ? \"default\" : \"outline\"}\n                className=\"w-full justify-start text-left h-auto p-2\"\n                onClick={() => setExpandedDistrict(expandedDistrict === district.id ? null : district.id)}\n                data-testid={`button-district-${district.id}`}\n              >\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"font-semibold text-sm truncate\">{district.name}</div>\n                  <div className={`text-xs ${getDifficultyColor(district.difficultyRating)}`}>\n                    Difficulty: {district.difficultyRating}/10 ‚Ä¢ Tribute: {district.tributeValue}\n                  </div>\n                </div>\n              </Button>\n\n              {expandedDistrict === district.id && (\n                <div className=\"mt-2 p-3 bg-card-hover rounded border border-card-border space-y-2\" data-testid={`details-${district.id}`}>\n                  <p className=\"text-xs text-muted-foreground\">{district.description}</p>\n                  <p className=\"text-xs font-semibold\">\n                    Ruled by: <span className=\"text-primary capitalize\">{district.currentRuler}</span>\n                  </p>\n                  <div className=\"text-xs\">\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      Required Power: {district.difficultyRating * 3 + 5} (yours: {gameState.character.power})\n                    </Badge>\n                  </div>\n                  <div className=\"flex flex-wrap gap-1\">\n                    {district.specialEvents.map((event) => (\n                      <Badge key={event} variant=\"secondary\" className=\"text-xs\">\n                        {event}\n                      </Badge>\n                    ))}\n                  </div>\n                  {gameState.character.currentLocation !== district.id && (\n                    <Button\n                      size=\"sm\"\n                      className=\"w-full\"\n                      disabled={gameState.character.power < district.difficultyRating * 3 + 5}\n                      onClick={() => {\n                        if (gameState.character.power < district.difficultyRating * 3 + 5) return;\n                        handleTravel(district.id);\n                      }}\n                      data-testid={`button-travel-${district.id}`}\n                    >\n                      {gameState.character.power < district.difficultyRating * 3 + 5 \n                        ? \"Power Too Low\" \n                        : \"Travel Here\"}\n                    </Button>\n                  )}\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4988},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/pages/character-creation.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { initAudio, playMenuMusic } from \"@/lib/audio\";\nimport NameStep from \"@/components/character-creation/name-step\";\nimport AppearanceStep from \"@/components/character-creation/appearance-step\";\nimport OriginStep from \"@/components/character-creation/origin-step\";\nimport TraitsStep from \"@/components/character-creation/traits-step\";\nimport PowersStep from \"@/components/character-creation/powers-shop-step\";\nimport SummaryStep from \"@/components/character-creation/summary-step\";\nimport { saveGame, createNewGameState, getAllSaves } from \"@/lib/game-state\";\nimport allPowers from \"@/data/powers.json\";\nimport type { Origin, Character } from \"@shared/schema\";\n\n// Load globally-owned powers from all previous saves\n// Character creation soulcoin shop: all non-mythical powers purchased persist globally\n// In-game wealth shop: powers bought during gameplay are NOT persistent (per-run only)\n// Mythical shard shop: bridge between both shops - mythical powers always persist\nfunction getInitialOwnedPowers(): string[] {\n  try {\n    const saves = getAllSaves();\n    const globalOwnedPowers = new Set<string>();\n    \n    saves.forEach(save => {\n      if (save && save.gameState && save.gameState.character.powers) {\n        save.gameState.character.powers.forEach((p: string) => {\n          globalOwnedPowers.add(p);\n        });\n      }\n    });\n    \n    return Array.from(globalOwnedPowers);\n  } catch (error) {\n    console.error(\"Error loading owned powers:\", error);\n    return [];\n  }\n}\n\n// Load globally-owned origins from all previous saves\nfunction getInitialOwnedOrigins(): string[] {\n  try {\n    const saves = getAllSaves();\n    const globalOwnedOrigins = new Set<string>();\n    \n    // Always include free origin\n    globalOwnedOrigins.add(\"sinner-weak\");\n    \n    saves.forEach(save => {\n      if (save && save.gameState && save.gameState.character.origin) {\n        globalOwnedOrigins.add(save.gameState.character.origin);\n      }\n    });\n    \n    return Array.from(globalOwnedOrigins);\n  } catch (error) {\n    console.error(\"Error loading owned origins:\", error);\n    return [\"sinner-weak\"];\n  }\n}\n\n// Load total accumulated soulcoins from all previous saves (global shared pool)\n// This works like a hivemind currency - if you spent soulcoins buying powers,\n// every new character sees the reduced amount\nfunction getInitialSoulcoins(): number {\n  try {\n    const saves = getAllSaves();\n    \n    // First character gets 50 base soulcoins\n    if (saves.length === 0) {\n      return 50;\n    }\n    \n    // Subsequent characters get total from all previous saves (no additional 50)\n    let totalSoulcoins = 0;\n    saves.forEach(save => {\n      if (save && save.gameState && save.gameState.character.soulcoins !== undefined) {\n        totalSoulcoins += save.gameState.character.soulcoins;\n      }\n    });\n    \n    return totalSoulcoins;\n  } catch (error) {\n    console.error(\"Error loading soulcoins:\", error);\n    return 50;\n  }\n}\n\n// Calculate stat bonus multiplier based on power rarities\n// Stronger powers = better starting stats and faster growth\nfunction calculatePowerBonus(powerIds: string[]): number {\n  const rarityBonus: Record<string, number> = {\n    common: 0,\n    uncommon: 0.10,\n    rare: 0.20,\n    epic: 0.35,\n    legendary: 0.50,\n    mythical: 0.75\n  };\n  \n  const powers = allPowers as any[];\n  let totalBonus = 0;\n  \n  powerIds.forEach(powerId => {\n    const power = powers.find(p => p.id === powerId);\n    if (power) {\n      totalBonus += rarityBonus[power.rarity] || 0;\n    }\n  });\n  \n  // Average bonus across all powers, capped at 0.75 (mythical tier)\n  const avgBonus = powerIds.length > 0 ? Math.min(totalBonus / powerIds.length, 0.75) : 0;\n  return 1 + avgBonus;\n}\n\nexport type CharacterData = {\n  firstName: string;\n  lastName: string;\n  appearance: {\n    horns: string;\n    wings: string;\n    colorPalette: string[];\n  };\n  origin: Origin | null;\n  selectedTraits: string[];\n  ownedPowers: string[]; // Powers player has bought\n  equippedPowers: string[]; // Powers player is actively using (max 5)\n  ownedOrigins: string[]; // Origins player has bought\n  soulcoins: number;\n  mythicalShards?: number;\n};\n\nexport default function CharacterCreation() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [step, setStep] = useState(0);\n  const [characterData, setCharacterData] = useState<CharacterData>(() => ({\n    firstName: \"\",\n    lastName: \"\",\n    appearance: {\n      horns: \"curved\",\n      wings: \"none\",\n      colorPalette: [\"#8B0000\", \"#000000\", \"#FFD700\"]\n    },\n    origin: null,\n    selectedTraits: [],\n    ownedPowers: getInitialOwnedPowers(),\n    equippedPowers: [],\n    ownedOrigins: getInitialOwnedOrigins(),\n    soulcoins: getInitialSoulcoins(),\n    mythicalShards: 0\n  }));\n\n  const steps = [\n    { title: \"Name\", description: \"Choose your demon identity\" },\n    { title: \"Appearance\", description: \"Customize your look\" },\n    { title: \"Origin\", description: \"Select your path in Hell\" },\n    { title: \"Traits\", description: \"Define your personality\" },\n    { title: \"Powers\", description: \"Choose and buy your abilities\" },\n    { title: \"Summary\", description: \"Review your character\" }\n  ];\n\n  const progress = ((step + 1) / steps.length) * 100;\n\n  // Initialize audio and play menu music on mount\n  useEffect(() => {\n    initAudio();\n    playMenuMusic();\n  }, []);\n\n  const handleNext = async () => {\n    if (step < steps.length - 1) {\n      setStep(step + 1);\n    } else {\n      // Create character and start game\n      try {\n        if (!characterData.origin) {\n          toast({ title: \"Error\", description: \"Please select an origin\", variant: \"destructive\" });\n          return;\n        }\n\n        // Build final powers list: all owned powers (both globally owned and newly bought)\n        // Use equipped powers for active use, but save ALL owned powers to the character\n        const allOwnedPowers = characterData.ownedPowers;\n        const finalPowers = allOwnedPowers.length > 0 \n          ? allOwnedPowers\n          : (allPowers as any[])\n              .filter(p => p.rarity === \"common\")\n              .map(p => p.id)\n              .slice(0, 3);\n\n        // Calculate power bonus multiplier for starting stats\n        const powerBonus = calculatePowerBonus(characterData.ownedPowers);\n        \n        // Create character with all required fields\n        const newCharacter: Character = {\n          id: `char-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n          name: `${characterData.firstName} ${characterData.lastName}`,\n          origin: characterData.origin.id,\n          appearance: characterData.appearance,\n          age: 25,\n          power: Math.round(characterData.origin.startingStats.power * powerBonus),\n          control: Math.round(characterData.origin.startingStats.control * powerBonus),\n          influence: Math.round(characterData.origin.startingStats.influence * powerBonus),\n          corruption: Math.round(characterData.origin.startingStats.corruption * powerBonus),\n          empathy: Math.round(characterData.origin.startingStats.empathy * powerBonus),\n          health: Math.round(characterData.origin.startingStats.health * powerBonus),\n          wealth: 1000,\n          soulcoins: characterData.soulcoins,\n          mythicalShards: characterData.mythicalShards || 0,\n          powers: finalPowers,\n          traits: characterData.selectedTraits,\n          currentRank: \"street-demon\",\n          currentLocation: \"hotel-district\",\n          currentTurn: 1,\n          rank: \"street-demon\",\n          createdAt: new Date(),\n          updatedAt: new Date()\n        };\n\n        // Calculate next available slot\n        const saves = getAllSaves();\n        const nextSlot = Math.min(saves.length + 1, 5);\n        const gameState = createNewGameState(newCharacter, nextSlot);\n        await saveGame(gameState, nextSlot);\n\n        toast({ title: \"Welcome to Hell!\", description: `Your life as ${characterData.firstName} ${characterData.lastName} begins...` });\n        setLocation(\"/game\");\n      } catch (error) {\n        console.error(\"Character creation error:\", error);\n        toast({ title: \"Error\", description: \"Failed to create character\", variant: \"destructive\" });\n      }\n    }\n  };\n\n  const handleBack = () => {\n    if (step > 0) {\n      setStep(step - 1);\n    }\n  };\n\n  const canProceed = () => {\n    switch (step) {\n      case 0:\n        return characterData.firstName && characterData.lastName;\n      case 1:\n        return true; // Appearance always valid\n      case 2:\n        return characterData.origin !== null;\n      case 3:\n        return characterData.selectedTraits.length > 0;\n      case 4:\n        return true; // Powers - at least something bought or confirmed\n      case 5:\n        return true; // Summary always valid\n      default:\n        return false;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background to-card p-4 md:p-8\">\n      <div className=\"max-w-5xl mx-auto space-y-6\">\n        {/* Header */}\n        <div className=\"text-center space-y-2\">\n          <h1 className=\"font-display text-4xl md:text-5xl font-bold text-primary\">\n            Character Creation\n          </h1>\n          <p className=\"text-muted-foreground\">\n            Step {step + 1} of {steps.length}: {steps[step].title}\n          </p>\n        </div>\n\n        {/* Progress Bar */}\n        <div className=\"space-y-2\">\n          <Progress value={progress} className=\"h-2\" data-testid=\"progress-creation\" />\n          <div className=\"flex justify-between text-xs text-muted-foreground\">\n            {steps.map((s, i) => (\n              <span key={i} className={i === step ? \"text-primary font-semibold\" : \"\"}>\n                {s.title}\n              </span>\n            ))}\n          </div>\n        </div>\n\n        {/* Step Content */}\n        <Card className=\"border-2 border-card-border\">\n          <CardHeader>\n            <CardTitle className=\"font-display text-2xl\">{steps[step].title}</CardTitle>\n            <CardDescription>{steps[step].description}</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {step === 0 && (\n              <NameStep\n                data={characterData}\n                onChange={(data) => setCharacterData({ ...characterData, ...data })}\n              />\n            )}\n            {step === 1 && (\n              <AppearanceStep\n                data={characterData}\n                onChange={(data) => setCharacterData({ ...characterData, ...data })}\n              />\n            )}\n            {step === 2 && (\n              <OriginStep\n                data={characterData}\n                onChange={(data) => setCharacterData({ ...characterData, ...data })}\n              />\n            )}\n            {step === 3 && (\n              <TraitsStep\n                data={characterData}\n                onChange={(data) => setCharacterData({ ...characterData, ...data })}\n              />\n            )}\n            {step === 4 && (\n              <PowersStep\n                data={characterData}\n                onChange={(data) => setCharacterData({ ...characterData, ...data })}\n              />\n            )}\n            {step === 5 && (\n              <SummaryStep data={characterData} />\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between items-center gap-4\">\n          <Button\n            variant=\"outline\"\n            onClick={handleBack}\n            disabled={step === 0}\n            className=\"gap-2\"\n            data-testid=\"button-back\"\n          >\n            <ChevronLeft className=\"w-4 h-4\" />\n            Back\n          </Button>\n\n          <Button\n            onClick={handleNext}\n            disabled={!canProceed()}\n            className=\"gap-2\"\n            data-testid=\"button-next\"\n          >\n            {step === steps.length - 1 ? \"Begin Your Life in Hell\" : \"Next\"}\n            {step !== steps.length - 1 && <ChevronRight className=\"w-4 h-4\" />}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":12439},"server/routes.ts":{"content":"import { createServer } from \"node:http\";\nimport type { Express } from \"express\";\nimport { setupHoundifyRoutes } from \"./lib/houndify-proxy\";\n\nexport async function registerRoutes(app: Express) {\n  const server = createServer(app);\n  \n  // Setup Houndify API proxy\n  setupHoundifyRoutes(app);\n  \n  return server;\n}\n","size_bytes":315},"server/index-dev.ts":{"content":"import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { type Server } from \"node:http\";\n\nimport { nanoid } from \"nanoid\";\nimport { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\n\nimport viteConfig from \"../vite.config\";\nimport runApp from \"./app\";\n\nexport async function setupVite(app: Express, server: Server) {\n  const viteLogger = createLogger();\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\n(async () => {\n  await runApp(setupVite);\n})();\n","size_bytes":1609},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/lib/audio.ts":{"content":"// Audio tracks with actual file paths\nimport stayedGoneUrl from \"@assets/Hazbin Hotel - Stayed Gone Instrumental high quality audio_1764062747147.mp3\";\nimport hearMyHopeUrl from \"@assets/Hazbin Hotel Season 2 - Hear My Hope Instrumental high quality audio_1764063523710.mp3\";\nimport insaneUrl from \"@assets/Insane Hazbin Hotel Original Song - Instrumental_1764062734894.mp3\";\nimport voxDeiUrl from \"@assets/Hazbin Hotel Season 2 - VOX DEI Instrumental high quality audio_1764063580083.mp3\";\nimport dontYouForgetUrl from \"@assets/Hazbin Hotel Season 2 - Dont You Forget Instrumental high quality audio_1764063596106.mp3\";\nimport outForLoveUrl from \"@assets/Hazbin Hotel - Out For Love Instrumental high quality audio_1764063833729.mp3\";\nimport readyForThisUrl from \"@assets/Hazbin Hotel - Ready For This Instrumental high quality audio_1764063838680.mp3\";\n\nexport interface AudioTrack {\n  name: string;\n  location: string;\n  volume: number;\n}\n\nconst tracks: Record<string, AudioTrack> = {\n  \"background\": { name: \"Stayed Gone\", location: \"background\", volume: 0.5 },\n  \"battle\": { name: \"Insane\", location: \"battle\", volume: 0.7 }\n};\n\nlet currentTrack: string | null = null;\nlet audioElement: HTMLAudioElement | null = null;\nlet audioContext: AudioContext | null = null;\nlet lastBackgroundTrack: \"stayed-gone\" | \"hear-my-hope\" = \"stayed-gone\";\nlet backgroundMusicCount = 0;\n\nexport function initAudio(): void {\n  if (!audioContext) {\n    try {\n      audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    } catch (e) {\n      console.warn(\"Web Audio API not available:\", e);\n    }\n  }\n}\n\nexport function playLocationMusic(location: string): void {\n  const track = tracks[location];\n  if (track) {\n    currentTrack = location;\n    \n    // Determine which file to play\n    let fileUrl = stayedGoneUrl;\n    let trackName = \"Stayed Gone\";\n    \n    if (location === \"battle\") {\n      fileUrl = insaneUrl;\n      trackName = \"Insane\";\n    } else if (location === \"background\") {\n      // Alternate between Stayed Gone and Hear My Hope\n      if (backgroundMusicCount % 2 === 0) {\n        fileUrl = stayedGoneUrl;\n        trackName = \"Stayed Gone\";\n        lastBackgroundTrack = \"stayed-gone\";\n      } else {\n        fileUrl = hearMyHopeUrl;\n        trackName = \"Hear My Hope\";\n        lastBackgroundTrack = \"hear-my-hope\";\n      }\n      backgroundMusicCount++;\n    }\n    \n    // Stop existing audio\n    if (audioElement) {\n      audioElement.pause();\n      audioElement.currentTime = 0;\n    }\n    \n    // Create and play new audio\n    try {\n      audioElement = new Audio(fileUrl);\n      audioElement.volume = track.volume;\n      audioElement.loop = true;\n      audioElement.play().catch(e => console.warn(\"Could not play audio:\", e));\n      console.log(`Playing: ${trackName}`);\n    } catch (e) {\n      console.warn(\"Error playing audio:\", e);\n    }\n  }\n}\n\nexport function playBattleMusic(opponent: string): void {\n  let fileUrl = insaneUrl;\n  let trackName = \"Insane\";\n  \n  // Map opponents to their themes\n  if (opponent === \"alastor\") {\n    fileUrl = insaneUrl;\n    trackName = \"Insane\";\n  } else if (opponent === \"vox\" || opponent === \"valentino\") {\n    fileUrl = voxDeiUrl;\n    trackName = \"Vox Dei\";\n  } else if (opponent === \"rosie\") {\n    fileUrl = dontYouForgetUrl;\n    trackName = \"Don't You Forget\";\n  } else if (opponent === \"carmilla\") {\n    fileUrl = outForLoveUrl;\n    trackName = \"Out For Love\";\n  } else if (opponent === \"charlie\") {\n    fileUrl = readyForThisUrl;\n    trackName = \"Ready For This\";\n  } else if (opponent === \"lucifer\") {\n    fileUrl = readyForThisUrl;\n    trackName = \"Ready For This\";\n  }\n  \n  // Stop existing audio\n  if (audioElement) {\n    audioElement.pause();\n    audioElement.currentTime = 0;\n  }\n  \n  // Create and play new audio\n  try {\n    audioElement = new Audio(fileUrl);\n    audioElement.volume = 0.7;\n    audioElement.loop = true;\n    audioElement.play().catch(e => console.warn(\"Could not play audio:\", e));\n    console.log(`Playing battle theme: ${trackName}`);\n    currentTrack = \"battle\";\n  } catch (e) {\n    console.warn(\"Error playing battle audio:\", e);\n  }\n}\n\nexport function playMenuMusic(): void {\n  // Stop existing audio\n  if (audioElement) {\n    audioElement.pause();\n    audioElement.currentTime = 0;\n  }\n  \n  // Create and play Hear My Hope\n  try {\n    audioElement = new Audio(hearMyHopeUrl);\n    audioElement.volume = 0.5;\n    audioElement.loop = true;\n    audioElement.play().catch(e => console.warn(\"Could not play audio:\", e));\n    console.log(\"Playing: Hear My Hope\");\n    currentTrack = \"menu\";\n  } catch (e) {\n    console.warn(\"Error playing menu audio:\", e);\n  }\n}\n\nexport function stopMusic(): void {\n  if (audioElement) {\n    audioElement.pause();\n    audioElement.currentTime = 0;\n  }\n  if (audioContext) {\n    audioContext.suspend();\n  }\n  currentTrack = null;\n}\n\nexport function setVolume(level: number): void {\n  if (audioElement) {\n    audioElement.volume = level;\n  }\n  if (audioContext) {\n    // Volume would be applied to actual audio nodes\n  }\n}\n\nexport function getAvailableTracks(): AudioTrack[] {\n  return Object.values(tracks);\n}\n","size_bytes":5141},"server/storage.ts":{"content":"import { type User, type InsertUser } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\n// modify the interface with any CRUD methods\n// you might need\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n\n  constructor() {\n    this.users = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n}\n\nexport const storage = new MemStorage();\n","size_bytes":993},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/character-creation/appearance-step.tsx":{"content":"import { useState } from \"react\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Sparkles, Zap, Wind, Eye, Wand2, Palette } from \"lucide-react\";\nimport type { CharacterData } from \"@/pages/character-creation\";\n\ninterface AppearanceStepProps {\n  data: CharacterData;\n  onChange: (data: Partial<CharacterData>) => void;\n}\n\nexport default function AppearanceStep({ data, onChange }: AppearanceStepProps) {\n  const [previewVariant, setPreviewVariant] = useState(0);\n\n  const hornOptions = [\n    { id: \"curved\", name: \"Curved\", description: \"Classic spirals\", emoji: \"‚Ü™Ô∏è\" },\n    { id: \"straight\", name: \"Straight\", description: \"Menacing points\", emoji: \"‚Üë\" },\n    { id: \"spiral\", name: \"Spiral\", description: \"Hypnotic forms\", emoji: \"üåÄ\" },\n    { id: \"broken\", name: \"Broken\", description: \"Battle-scarred\", emoji: \"‚öîÔ∏è\" },\n    { id: \"crowned\", name: \"Crowned\", description: \"Royal bearing\", emoji: \"üëë\" },\n    { id: \"spiked\", name: \"Spiked\", description: \"Razor sharp\", emoji: \"üíé\" },\n    { id: \"none\", name: \"None\", description: \"Fully mortal\", emoji: \"‚ú®\" },\n  ];\n\n  const wingOptions = [\n    { id: \"none\", name: \"None\", description: \"Earthbound\", emoji: \"üö∂\" },\n    { id: \"bat\", name: \"Bat\", description: \"Leathery infernal\", emoji: \"ü¶á\" },\n    { id: \"feathered\", name: \"Feathered\", description: \"Angelic remnants\", emoji: \"ü™∂\" },\n    { id: \"tattered\", name: \"Tattered\", description: \"War-torn\", emoji: \"üíî\" },\n    { id: \"shadow\", name: \"Shadow\", description: \"Darkness form\", emoji: \"üåë\" },\n    { id: \"ethereal\", name: \"Ethereal\", description: \"Otherworldly\", emoji: \"üëª\" },\n    { id: \"scaled\", name: \"Scaled\", description: \"Dragon-like\", emoji: \"üêâ\" },\n  ];\n\n  const eyeStyles = [\n    { id: \"human\", name: \"Human\", description: \"Deceivingly normal\" },\n    { id: \"cat\", name: \"Feline\", description: \"Predatory slits\" },\n    { id: \"serpent\", name: \"Serpent\", description: \"Hypnotic gaze\" },\n    { id: \"void\", name: \"Void\", description: \"Empty darkness\" },\n    { id: \"infernal\", name: \"Infernal\", description: \"Blazing flames\" },\n    { id: \"celestial\", name: \"Celestial\", description: \"Shimmering light\" },\n    { id: \"star\", name: \"Star\", description: \"Cosmic pupils\" },\n  ];\n\n  const skinTones = [\n    { id: \"pale\", name: \"Pale\", hex: \"#E8C5A5\" },\n    { id: \"olive\", name: \"Olive\", hex: \"#8B7355\" },\n    { id: \"red\", name: \"Crimson\", hex: \"#8B3A3A\" },\n    { id: \"purple\", name: \"Violet\", hex: \"#9370DB\" },\n    { id: \"grey\", name: \"Ashen\", hex: \"#808080\" },\n    { id: \"charcoal\", name: \"Charcoal\", hex: \"#3A3A3A\" },\n    { id: \"bronze\", name: \"Bronze\", hex: \"#CD7F32\" },\n    { id: \"emerald\", name: \"Emerald\", hex: \"#2D5016\" },\n  ];\n\n  const bodyFrames = [\n    { id: \"lean\", name: \"Lean\", description: \"Nimble and swift\" },\n    { id: \"athletic\", name: \"Athletic\", description: \"Balanced prowess\" },\n    { id: \"muscular\", name: \"Muscular\", description: \"Raw power\" },\n    { id: \"ethereal\", name: \"Ethereal\", description: \"Supernatural grace\" },\n    { id: \"monstrous\", name: \"Monstrous\", description: \"Transformed beast\" },\n  ];\n\n  const accents = [\n    { id: \"none\", name: \"None\", emoji: \"‚Äî\" },\n    { id: \"scars\", name: \"Scars\", emoji: \"‚öîÔ∏è\" },\n    { id: \"horns-crown\", name: \"Crown\", emoji: \"üëë\" },\n    { id: \"marks\", name: \"Runes\", emoji: \"‚ú¶\" },\n    { id: \"flames\", name: \"Aura\", emoji: \"üî•\" },\n    { id: \"thorns\", name: \"Thorns\", emoji: \"üåπ\" },\n    { id: \"biolume\", name: \"Glow\", emoji: \"üí´\" },\n  ];\n\n  const colorPalettes = [\n    { name: \"Classic Hell\", colors: [\"#8B0000\", \"#000000\", \"#FFD700\"], desc: \"Traditional evil\" },\n    { name: \"Royal Purple\", colors: [\"#4B0082\", \"#800080\", \"#FFD700\"], desc: \"Regal power\" },\n    { name: \"Toxic Green\", colors: [\"#00FF00\", \"#008000\", \"#000000\"], desc: \"Venomous\" },\n    { name: \"Ice Blue\", colors: [\"#00BFFF\", \"#4169E1\", \"#FFFFFF\"], desc: \"Frozen\" },\n    { name: \"Hot Pink\", colors: [\"#FF1493\", \"#800080\", \"#FFD700\"], desc: \"Seductive\" },\n    { name: \"Shadow\", colors: [\"#2F2F2F\", \"#000000\", \"#8B0000\"], desc: \"Mysterious\" },\n    { name: \"Hellfire\", colors: [\"#FF4500\", \"#8B0000\", \"#FFD700\"], desc: \"Burning\" },\n    { name: \"Celestial\", colors: [\"#E6E6FA\", \"#9370DB\", \"#FFD700\"], desc: \"Fallen divine\" },\n    { name: \"Obsidian\", colors: [\"#1a1a1a\", \"#4a0000\", \"#FFD700\"], desc: \"Pure darkness\" },\n    { name: \"Bloodmoon\", colors: [\"#4a0000\", \"#1a0000\", \"#8B0000\"], desc: \"Crimson night\" },\n  ];\n\n  const getPreviewDisplay = () => {\n    const horns = hornOptions.find(h => h.id === data.appearance.horns);\n    const wings = wingOptions.find(w => w.id === data.appearance.wings);\n    return `${horns?.emoji || \"?\"} ${wings?.emoji || \"?\"}`;\n  };\n\n  const getPreviewColor = () => {\n    const skinTone = skinTones.find(s => s.id === (data.appearance.horns === \"curved\" ? \"pale\" : \"pale\"));\n    return data.appearance.colorPalette[0] || \"#8B0000\";\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Tabs defaultValue=\"features\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-4 gap-1\">\n          <TabsTrigger value=\"features\" className=\"gap-1 text-xs sm:text-sm\">\n            <Zap className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Features</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"appearance\" className=\"gap-1 text-xs sm:text-sm\">\n            <Eye className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Body</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"colors\" className=\"gap-1 text-xs sm:text-sm\">\n            <Palette className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Colors</span>\n          </TabsTrigger>\n          <TabsTrigger value=\"marks\" className=\"gap-1 text-xs sm:text-sm\">\n            <Sparkles className=\"w-4 h-4\" />\n            <span className=\"hidden sm:inline\">Marks</span>\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Features Tab */}\n        <TabsContent value=\"features\" className=\"space-y-4 mt-4\">\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center gap-2\">\n              <Zap className=\"w-5 h-5 text-primary\" />\n              <Label className=\"text-base font-semibold\">Horns</Label>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">Your demonic crown</p>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2\">\n              {hornOptions.map((horn) => (\n                <Card\n                  key={horn.id}\n                  className={`p-3 cursor-pointer transition-all hover-elevate ${\n                    data.appearance.horns === horn.id ? \"ring-2 ring-primary\" : \"\"\n                  }`}\n                  onClick={() => onChange({\n                    appearance: { ...data.appearance, horns: horn.id }\n                  })}\n                  data-testid={`button-horn-${horn.id}`}\n                >\n                  <div className=\"text-3xl text-center mb-2\">{horn.emoji}</div>\n                  <p className=\"font-semibold text-sm text-center\">{horn.name}</p>\n                  <p className=\"text-xs text-muted-foreground text-center\">{horn.description}</p>\n                </Card>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"space-y-3 pt-4 border-t\">\n            <div className=\"flex items-center gap-2\">\n              <Wind className=\"w-5 h-5 text-primary\" />\n              <Label className=\"text-base font-semibold\">Wings</Label>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">Your path through the skies</p>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2\">\n              {wingOptions.map((wing) => (\n                <Card\n                  key={wing.id}\n                  className={`p-3 cursor-pointer transition-all hover-elevate ${\n                    data.appearance.wings === wing.id ? \"ring-2 ring-primary\" : \"\"\n                  }`}\n                  onClick={() => onChange({\n                    appearance: { ...data.appearance, wings: wing.id }\n                  })}\n                  data-testid={`button-wing-${wing.id}`}\n                >\n                  <div className=\"text-3xl text-center mb-2\">{wing.emoji}</div>\n                  <p className=\"font-semibold text-sm text-center\">{wing.name}</p>\n                  <p className=\"text-xs text-muted-foreground text-center\">{wing.description}</p>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </TabsContent>\n\n        {/* Appearance Tab */}\n        <TabsContent value=\"appearance\" className=\"space-y-4 mt-4\">\n          <div className=\"space-y-3\">\n            <Label className=\"text-base font-semibold flex items-center gap-2\">\n              <Eye className=\"w-5 h-5 text-primary\" />\n              Skin Tone\n            </Label>\n            <p className=\"text-sm text-muted-foreground\">Choose your natural coloring</p>\n            <div className=\"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-8 gap-2\">\n              {skinTones.map((tone) => (\n                <Card\n                  key={tone.id}\n                  className=\"p-2 cursor-pointer transition-all hover-elevate h-16 flex items-center justify-center\"\n                  onClick={() => onChange({\n                    appearance: {\n                      ...data.appearance,\n                      colorPalette: [tone.hex, data.appearance.colorPalette[1], data.appearance.colorPalette[2]]\n                    }\n                  })}\n                  data-testid={`button-skin-${tone.id}`}\n                  title={tone.name}\n                >\n                  <div\n                    className=\"w-full h-full rounded border\"\n                    style={{ backgroundColor: tone.hex, borderColor: tone.hex }}\n                  />\n                </Card>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"space-y-3 pt-4 border-t\">\n            <Label className=\"text-base font-semibold flex items-center gap-2\">\n              <Eye className=\"w-5 h-5 text-primary\" />\n              Eye Style\n            </Label>\n            <p className=\"text-sm text-muted-foreground\">The window to your soul</p>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2\">\n              {eyeStyles.map((style) => (\n                <Card\n                  key={style.id}\n                  className={`p-3 cursor-pointer transition-all hover-elevate ${\n                    data.appearance.horns === (\"eyes-\" + style.id) ? \"ring-2 ring-primary\" : \"\"\n                  }`}\n                  data-testid={`button-eyes-${style.id}`}\n                >\n                  <p className=\"font-semibold text-sm\">{style.name}</p>\n                  <p className=\"text-xs text-muted-foreground\">{style.description}</p>\n                </Card>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"space-y-3 pt-4 border-t\">\n            <Label className=\"text-base font-semibold flex items-center gap-2\">\n              <Wand2 className=\"w-5 h-5 text-primary\" />\n              Body Frame\n            </Label>\n            <p className=\"text-sm text-muted-foreground\">Your physical presence</p>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-2\">\n              {bodyFrames.map((frame) => (\n                <Card\n                  key={frame.id}\n                  className=\"p-3 cursor-pointer transition-all hover-elevate\"\n                  data-testid={`button-frame-${frame.id}`}\n                >\n                  <p className=\"font-semibold text-sm\">{frame.name}</p>\n                  <p className=\"text-xs text-muted-foreground\">{frame.description}</p>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </TabsContent>\n\n        {/* Colors Tab */}\n        <TabsContent value=\"colors\" className=\"space-y-4 mt-4\">\n          <Label className=\"text-base font-semibold flex items-center gap-2\">\n            <Palette className=\"w-5 h-5 text-primary\" />\n            Color Palette\n          </Label>\n          <p className=\"text-sm text-muted-foreground\">Your signature aesthetic</p>\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-3\">\n            {colorPalettes.map((palette) => (\n              <Card\n                key={palette.name}\n                className={`p-3 cursor-pointer transition-all hover-elevate ${\n                  JSON.stringify(data.appearance.colorPalette) === JSON.stringify(palette.colors)\n                    ? \"ring-2 ring-primary\"\n                    : \"\"\n                }`}\n                onClick={() => onChange({\n                  appearance: { ...data.appearance, colorPalette: palette.colors }\n                })}\n                data-testid={`button-palette-${palette.name.toLowerCase().replace(' ', '-')}`}\n              >\n                <div className=\"flex gap-1 mb-2 h-8 rounded overflow-hidden\">\n                  {palette.colors.map((color, idx) => (\n                    <div key={idx} className=\"flex-1\" style={{ backgroundColor: color }} />\n                  ))}\n                </div>\n                <p className=\"text-xs font-semibold\">{palette.name}</p>\n                <p className=\"text-xs text-muted-foreground\">{palette.desc}</p>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n\n        {/* Marks Tab */}\n        <TabsContent value=\"marks\" className=\"space-y-4 mt-4\">\n          <Label className=\"text-base font-semibold flex items-center gap-2\">\n            <Sparkles className=\"w-5 h-5 text-primary\" />\n            Signature Accents\n          </Label>\n          <p className=\"text-sm text-muted-foreground\">Distinguish yourself with unique marks</p>\n          <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-2\">\n            {accents.map((accent) => (\n              <Card\n                key={accent.id}\n                className={`p-4 cursor-pointer transition-all hover-elevate flex flex-col items-center justify-center gap-2 ${\n                  data.appearance.horns === (\"accent-\" + accent.id) ? \"ring-2 ring-primary\" : \"\"\n                }`}\n                data-testid={`button-accent-${accent.id}`}\n              >\n                <div className=\"text-2xl\">{accent.emoji}</div>\n                <p className=\"text-xs font-semibold text-center\">{accent.name}</p>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {/* Preview Section */}\n      <Card className=\"p-6 bg-gradient-to-br from-primary/10 to-destructive/10 border-2 border-primary/30\">\n        <CardHeader className=\"text-center pb-4\">\n          <CardTitle className=\"text-lg\">Your Demonic Form</CardTitle>\n          <CardDescription>How Hell will recognize you</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col items-center space-y-6\">\n            {/* Main Preview Circle */}\n            <div\n              className=\"relative w-56 h-56 rounded-full border-4 border-primary flex items-center justify-center transition-all duration-300 cursor-pointer hover:scale-105 flex-col justify-center\"\n              style={{\n                background: `linear-gradient(135deg, ${data.appearance.colorPalette[0]}, ${data.appearance.colorPalette[1]})`,\n                boxShadow: `0 0 30px ${data.appearance.colorPalette[0]}60`\n              }}\n              onClick={() => setPreviewVariant((v) => (v + 1) % 3)}\n              title=\"Click to cycle preview\"\n            >\n              <div className=\"text-8xl drop-shadow-lg\">{getPreviewDisplay()}</div>\n              <div className=\"text-xs text-center mt-4 opacity-75 font-semibold\">Click to cycle</div>\n            </div>\n\n            {/* Summary Badges */}\n            <div className=\"flex flex-wrap justify-center gap-2\">\n              <Badge variant=\"secondary\">\n                {hornOptions.find(h => h.id === data.appearance.horns)?.name}\n              </Badge>\n              <Badge variant=\"secondary\">\n                {wingOptions.find(w => w.id === data.appearance.wings)?.name}\n              </Badge>\n              <Badge variant=\"secondary\">\n                {colorPalettes.find(p => JSON.stringify(p.colors) === JSON.stringify(data.appearance.colorPalette))?.name || \"Custom\"}\n              </Badge>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":16611},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/game/powers-panel.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { getPowerTypeColor } from \"@/lib/gameHelpers\";\nimport { Zap, Shield, Lock } from \"lucide-react\";\nimport powersData from \"@/data/powers.json\";\nimport { getPowerProgress } from \"@/lib/powerSystem\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface PowersPanelProps {\n  gameState: GameState;\n}\n\nexport default function PowersPanel({ gameState }: PowersPanelProps) {\n  const powers = powersData as any[];\n  \n  // Get equipped powers from character\n  const equippedPowerIds = gameState.character.powers || [];\n  const equippedPowers = equippedPowerIds\n    .map(id => powers.find(p => p.id === id))\n    .filter(Boolean)\n    .map((power: any) => ({\n      ...power,\n      cooldown: 0, // TODO: track cooldowns in game state\n      level: 1 // TODO: track power levels in game state\n    }));\n\n  return (\n    <Card className=\"border-2 border-card-border\" data-testid=\"card-powers\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-display\">Powers</CardTitle>\n          <Badge variant=\"outline\">{equippedPowers.length}</Badge>\n        </div>\n      </CardHeader>\n      <CardContent className=\"flex flex-col h-full\">\n        {equippedPowers.length === 0 ? (\n          <p className=\"text-xs text-muted-foreground p-3 text-center\">No powers equipped</p>\n        ) : (\n          <ScrollArea className=\"flex-1 -mr-4 pr-4\">\n            <div className=\"space-y-2\">\n              {equippedPowers.map((power: any) => {\n            const isPassive = power.isPassive || false;\n            const cooldown = power.cooldown || 0;\n            const maxCooldown = power.baseCooldown || 3;\n            \n                return (\n                  <div\n                    key={power.id}\n                    className={`p-3 rounded-md border space-y-1 ${\n                      isPassive\n                        ? \"bg-muted/50 border-muted\"\n                        : cooldown > 0\n                        ? \"bg-muted/30 border-muted opacity-60\"\n                        : \"bg-card hover-elevate border-card-border\"\n                    }`}\n                    data-testid={`power-${power.id}`}\n                  >\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          {isPassive ? (\n                            <Shield className=\"w-4 h-4 text-blue-500\" />\n                          ) : (\n                            <Zap className=\"w-4 h-4 text-amber-500\" />\n                          )}\n                          <span className=\"font-semibold text-sm\">{power.name}</span>\n                        </div>\n                        <Badge \n                          variant=\"outline\" \n                          className={`text-xs ${getPowerTypeColor(power.type)}`}\n                        >\n                          {power.type.replace(\"-\", \" \")}\n                        </Badge>\n                      </div>\n                      <div className=\"text-right\">\n                        {!isPassive && (\n                          cooldown > 0 ? (\n                            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                              <Lock className=\"w-3 h-3\" />\n                              <span>{cooldown}t</span>\n                            </div>\n                          ) : (\n                            <span className=\"text-xs font-semibold text-green-500\">Ready</span>\n                          )\n                        )}\n                      </div>\n                    </div>\n                    {!isPassive && (\n                      <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                        <span>Control: {power.controlCost}</span>\n                        <span>‚Ä¢</span>\n                        <span>CD: {maxCooldown}t</span>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </ScrollArea>\n        )}\n\n        <Button \n          variant=\"outline\" \n          className=\"w-full mt-2\" \n          data-testid=\"button-manage-powers\"\n          onClick={() => {\n            alert(`Equipped Powers (${equippedPowers.length}):\\n\\n${equippedPowers.map(p => `‚Ä¢ ${p.name} (${p.type})`).join('\\n')}\\n\\nTo change powers, create a new character or unlock new abilities by gaining power!`);\n          }}\n        >\n          Manage Powers\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4905},"server/lib/ai-events.ts":{"content":"import { IStorage } from \"@/server/storage\";\nimport type { GameEvent } from \"@shared/schema\";\n\nexport interface AIEventGeneratorOptions {\n  theme?: string;\n  location?: string;\n  characterPower?: number;\n  characterCorruption?: number;\n}\n\n/**\n * Generate AI-powered dynamic events using Houndify conversational AI\n */\nexport async function generateAIEvent(\n  options: AIEventGeneratorOptions = {}\n): Promise<Partial<GameEvent> | null> {\n  try {\n    const theme = options.theme || \"random\";\n    const power = options.characterPower || 0;\n    const corruption = options.characterCorruption || 0;\n    \n    // Unique dynamically generated scenarios\n    const eventGenerators: Record<string, () => Partial<GameEvent>> = {\n      \"ultimate-power\": () => ({\n        id: `ai-${Date.now()}`,\n        title: `${[\"The Final Temptation\", \"An Obsolete Challenge\", \"Power's Mirror\", \"The Crowned King's Burden\"][Math.floor(Math.random() * 4)]}`,\n        description: `At your immense power level (${power}), ${[\"demons tremble at your presence\", \"reality bends to your will\", \"you're feared across all of Hell\", \"overlords acknowledge your might\"][Math.floor(Math.random() * 4)]}.`,\n        type: \"war\",\n        choices: [\n          { id: `opt1-${Date.now()}`, text: \"Seek even greater power.\", outcomes: { statChanges: { power: Math.floor(Math.random() * 5) + 1, corruption: Math.floor(Math.random() * 3) + 1 }, narrativeText: \"Insatiable hunger consumes you.\" } },\n          { id: `opt2-${Date.now()}`, text: \"Consolidate your dominion.\", outcomes: { statChanges: { influence: Math.floor(Math.random() * 4) + 2, control: Math.floor(Math.random() * 3) + 1 }, narrativeText: \"Your reign solidifies across Hell.\" } },\n          { id: `opt3-${Date.now()}`, text: \"Question your path.\", outcomes: { statChanges: { empathy: Math.floor(Math.random() * 2) + 1, corruption: -Math.floor(Math.random() * 2) }, narrativeText: \"Doubt flickers. Is this truly what you want?\" } }\n        ],\n        onlyOnce: false\n      }),\n      \"corruption-themed\": () => ({\n        id: `ai-${Date.now()}`,\n        title: `${[\"Whispers of the Abyss\", \"Corruption's Embrace\", \"The Void Calls\", \"Darkness Within\"][Math.floor(Math.random() * 4)]}`,\n        description: `Your corruption level (${corruption}) has drawn ${[\"shadowy entities\", \"ancient evils\", \"the truly damned\", \"forgotten souls\"][Math.floor(Math.random() * 4)]} to you.`,\n        type: \"contract\",\n        choices: [\n          { id: `opt1-${Date.now()}`, text: \"Embrace them fully.\", outcomes: { statChanges: { power: Math.floor(Math.random() * 6) + 2, corruption: Math.floor(Math.random() * 5) + 3, control: -Math.floor(Math.random() * 2) }, narrativeText: \"You lose yourself in darkness.\" } },\n          { id: `opt2-${Date.now()}`, text: \"Strike a bargain.\", outcomes: { statChanges: { wealth: Math.floor(Math.random() * 200) + 100, power: Math.floor(Math.random() * 3) + 1, influence: Math.floor(Math.random() * 2) + 1 }, narrativeText: \"A pact is sealed in blood.\" } },\n          { id: `opt3-${Date.now()}`, text: \"Resist the corruption.\", outcomes: { statChanges: { control: Math.floor(Math.random() * 3) + 2, empathy: Math.floor(Math.random() * 2) + 1, corruption: -Math.floor(Math.random() * 3) }, narrativeText: \"Your willpower burns bright against the darkness.\" } }\n        ],\n        onlyOnce: false\n      }),\n      \"redemption-themed\": () => ({\n        id: `ai-${Date.now()}`,\n        title: `${[\"A Second Chance\", \"Light in Darkness\", \"Redemption's Path\", \"Hope Rekindled\"][Math.floor(Math.random() * 4)]}`,\n        description: `Despite your journey, ${[\"Charlie approaches you\", \"redemption seems possible\", \"a path forward appears\", \"something inside stirs\"][Math.floor(Math.random() * 4)]}.`,\n        type: \"daily\",\n        choices: [\n          { id: `opt1-${Date.now()}`, text: \"Pursue genuine change.\", outcomes: { statChanges: { empathy: Math.floor(Math.random() * 5) + 3, corruption: -Math.floor(Math.random() * 3), power: Math.floor(Math.random() * 2) }, narrativeText: \"The weight lifts ever so slightly.\" } },\n          { id: `opt2-${Date.now()}`, text: \"Pretend to change for advantage.\", outcomes: { statChanges: { influence: Math.floor(Math.random() * 3) + 1, control: Math.floor(Math.random() * 2) + 1, corruption: 1 }, narrativeText: \"A convincing mask, but inside...\" } },\n          { id: `opt3-${Date.now()}`, text: \"Reject all redemption.\", outcomes: { statChanges: { corruption: Math.floor(Math.random() * 4) + 2, empathy: -Math.floor(Math.random() * 2) }, narrativeText: \"You embrace who you truly are.\" } }\n        ],\n        onlyOnce: false\n      }),\n      \"politics\": () => ({\n        id: `ai-${Date.now()}`,\n        title: `${[\"Political Maneuvering\", \"An Unlikely Alliance\", \"The Power Broker\", \"Hellish Diplomacy\"][Math.floor(Math.random() * 4)]}`,\n        description: `A faction seeks ${[\"your support\", \"your influence\", \"partnership\", \"your backing\"][Math.floor(Math.random() * 4)]}.`,\n        type: \"war\",\n        choices: [\n          { id: `opt1-${Date.now()}`, text: \"Join them for mutual gain.\", outcomes: { statChanges: { influence: Math.floor(Math.random() * 4) + 2, wealth: Math.floor(Math.random() * 150) + 75, power: Math.floor(Math.random() * 2) + 1 }, narrativeText: \"Your reach extends further.\" } },\n          { id: `opt2-${Date.now()}`, text: \"Play both sides.\", outcomes: { statChanges: { control: Math.floor(Math.random() * 3) + 2, wealth: Math.floor(Math.random() * 100) + 50, influence: Math.floor(Math.random() * 2) }, narrativeText: \"A dangerous game of shadows.\" } },\n          { id: `opt3-${Date.now()}`, text: \"Stay neutral.\", outcomes: { statChanges: { control: 1, empathy: 1 }, narrativeText: \"You remain free from entanglement.\" } }\n        ],\n        onlyOnce: false\n      }),\n      \"wealth-based\": () => ({\n        id: `ai-${Date.now()}`,\n        title: `${[\"Lucrative Opportunity\", \"A Golden Proposal\", \"Fortune Smiles\", \"Wealth Calls\"][Math.floor(Math.random() * 4)]}`,\n        description: `Your wealth (${options.characterPower} coins) has made you ${[\"a target\", \"enviable\", \"powerful\", \"dangerous\"][Math.floor(Math.random() * 4)]}.`,\n        type: \"contract\",\n        choices: [\n          { id: `opt1-${Date.now()}`, text: \"Invest for more returns.\", outcomes: { statChanges: { wealth: Math.floor(Math.random() * 300) + 100, influence: Math.floor(Math.random() * 2) + 1 }, narrativeText: \"Your fortune multiplies.\" } },\n          { id: `opt2-${Date.now()}`, text: \"Use it for power.\", outcomes: { statChanges: { power: Math.floor(Math.random() * 5) + 2, wealth: -Math.floor(Math.random() * 100) }, narrativeText: \"Gold becomes force.\" } },\n          { id: `opt3-${Date.now()}`, text: \"Help the suffering.\", outcomes: { statChanges: { empathy: Math.floor(Math.random() * 3) + 1, wealth: -Math.floor(Math.random() * 150), influence: Math.floor(Math.random() * 2) + 1 }, narrativeText: \"Something awakens in you.\" } }\n        ],\n        onlyOnce: false\n      }),\n      \"random\": () => ({\n        id: `ai-${Date.now()}`,\n        title: `${[\"Chance Encounter\", \"Unexpected Turn\", \"A Twist of Fate\", \"Fortune's Wheel\", \"Hellish Intrigue\"][Math.floor(Math.random() * 5)]}`,\n        description: `${[\"A stranger appears\", \"Something changes\", \"Reality shifts\", \"Destiny intervenes\", \"The past catches up\"][Math.floor(Math.random() * 5)]}.`,\n        type: \"daily\",\n        choices: [\n          { id: `opt1-${Date.now()}`, text: \"Take action.\", outcomes: { statChanges: { power: Math.floor(Math.random() * 2) + 1, control: 1 }, narrativeText: \"You seize the moment.\" } },\n          { id: `opt2-${Date.now()}`, text: \"Observe and learn.\", outcomes: { statChanges: { influence: Math.floor(Math.random() * 2), empathy: 1 }, narrativeText: \"Knowledge is power.\" } },\n          { id: `opt3-${Date.now()}`, text: \"Ignore it.\", outcomes: { statChanges: { control: 1 }, narrativeText: \"You move onward unchanged.\" } }\n        ],\n        onlyOnce: false\n      })\n    };\n\n    const generator = eventGenerators[theme] || eventGenerators[\"random\"];\n    return generator();\n  } catch (error) {\n    console.error(\"Error generating AI event:\", error);\n    return null;\n  }\n}\n\n/**\n * Generate dynamic dialogue for NPCs using AI\n */\nexport async function generateNPCDialogue(\n  npcName: string,\n  context: string\n): Promise<string> {\n  try {\n    // Mock dialogue templates for now\n    const dialogueTemplates: Record<string, string[]> = {\n      charlie: [\n        \"I really believe you can change! Everyone deserves a second chance.\",\n        \"Have you thought about what redemption means to you?\",\n        \"The Hotel is always open to those seeking a better path.\"\n      ],\n      alastor: [\n        \"Well, well, isn't this absolutely delightful!\",\n        \"Deal with me, and you'll find success beyond your wildest dreams.\",\n        \"The radio demon always keeps his bargains... eventually.\"\n      ],\n      vaggie: [\n        \"Look, we're trying to help people here. Are you in or out?\",\n        \"I don't trust easily, but you might be different.\",\n        \"Stay focused. We have work to do.\"\n      ],\n      vox: [\n        \"You could be a real star if you work with me.\",\n        \"The future is digital, friend. Get on board.\",\n        \"Let's make you a household name.\"\n      ]\n    };\n\n    const npcDialogues = dialogueTemplates[npcName.toLowerCase()] || dialogueTemplates.charlie;\n    return npcDialogues[Math.floor(Math.random() * npcDialogues.length)];\n  } catch (error) {\n    console.error(\"Error generating NPC dialogue:\", error);\n    return \"...\";\n  }\n}\n\n/**\n * Generate story-driven event chains based on player decisions\n */\nexport async function generateEventChain(\n  previousEventId: string,\n  playerChoice: string,\n  storage: IStorage\n): Promise<Partial<GameEvent> | null> {\n  try {\n    // Fallback: return a follow-up event based on the choice\n    const followUpEvents: Record<string, Partial<GameEvent>> = {\n      \"sign-contract\": {\n        id: `ai-event-chain-${Date.now()}`,\n        title: \"Power Surge\",\n        description: \"You feel incredible power flowing through your veins as the contract takes hold.\",\n        type: \"contract\",\n        triggerConditions: {},\n        choices: [\n          {\n            id: \"embrace\",\n            text: \"Embrace the power fully.\",\n            outcomes: {\n              statChanges: { power: 10, corruption: 5 },\n              narrativeText: \"You become intoxicated with newfound strength.\"\n            }\n          },\n          {\n            id: \"control\",\n            text: \"Try to control it.\",\n            outcomes: {\n              statChanges: { power: 5, control: 3, corruption: 2 },\n              narrativeText: \"You manage to harness the power with discipline.\"\n            }\n          }\n        ],\n        onlyOnce: false\n      }\n    };\n\n    return followUpEvents[playerChoice] || null;\n  } catch (error) {\n    console.error(\"Error generating event chain:\", error);\n    return null;\n  }\n}\n","size_bytes":10926},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"server/index-prod.ts":{"content":"import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { type Server } from \"node:http\";\n\nimport express, { type Express } from \"express\";\nimport runApp from \"./app\";\n\nexport async function serveStatic(app: Express, _server: Server) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n\n(async () => {\n  await runApp(serveStatic);\n})();\n","size_bytes":712},"client/src/components/game/actions-panel.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dumbbell, Users, Briefcase, Music, Swords, Heart, ArrowRight, Bed } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { canClaimTerritory, claimTerritory } from \"@/lib/territorySystem\";\nimport powersData from \"@/data/powers.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface ActionsPanelProps {\n  onNextTurn: () => void;\n  gameState: GameState;\n  onUpdateCharacter: (updates: Partial<GameState[\"character\"]> & { actionCooldowns?: Record<string, number> }) => void;\n}\n\nexport default function ActionsPanel({ onNextTurn, gameState, onUpdateCharacter }: ActionsPanelProps) {\n  const { toast } = useToast();\n  const { character } = gameState;\n  const cooldowns = gameState.actionCooldowns || {};\n  const useCounts = gameState.actionUseCounts || {};\n  \n  // Calculate stat gain multiplier based on power rarities\n  const calculatePowerBonus = (): number => {\n    const rarityBonus: Record<string, number> = {\n      common: 0,\n      uncommon: 0.10,\n      rare: 0.20,\n      epic: 0.35,\n      legendary: 0.50,\n      mythical: 0.75\n    };\n    \n    const powers = powersData as any[];\n    let totalBonus = 0;\n    \n    character.powers?.forEach(powerId => {\n      const power = powers.find(p => p.id === powerId);\n      if (power) {\n        totalBonus += rarityBonus[power.rarity] || 0;\n      }\n    });\n    \n    const avgBonus = (character.powers?.length || 0) > 0 ? Math.min(totalBonus / character.powers!.length, 0.75) : 0;\n    return 1 + avgBonus;\n  };\n  \n  const powerBonus = calculatePowerBonus();\n  \n  const isOnCooldown = (actionId: string) => {\n    const availableTurn = cooldowns[actionId];\n    return availableTurn ? availableTurn > gameState.turn : false;\n  };\n  \n  const getTrainPowerGain = () => {\n    const trainCount = useCounts[\"train-power\"] || 0;\n    const baseGain = trainCount >= 5 ? 0.25 : trainCount >= 3 ? 0.5 : 1;\n    return Math.round(baseGain * powerBonus * 10) / 10; // Apply power bonus multiplier, reduced 50%\n  };\n\n  const actions = [\n    {\n      id: \"rest\",\n      name: \"Rest\",\n      icon: Bed,\n      description: \"Recover your health and restore energy\",\n      action: () => {\n        const healthRecovery = 30;\n        onUpdateCharacter({ \n          health: Math.min(100, character.health + healthRecovery)\n        } as any);\n        \n        toast({ title: \"Rest\", description: `You rest and recover. +${healthRecovery} Health!` });\n      }\n    },\n    {\n      id: \"train-power\",\n      name: \"Train Power\",\n      icon: Dumbbell,\n      description: \"Increase your raw magical strength (cooldown: 3 turns)\",\n      action: () => {\n        if (isOnCooldown(\"train-power\")) {\n          toast({ \n            title: \"On Cooldown\", \n            description: `Available at turn ${cooldowns[\"train-power\"]}`,\n            variant: \"destructive\" \n          });\n          return;\n        }\n        \n        const gain = getTrainPowerGain();\n        const newCooldowns = { ...cooldowns, \"train-power\": gameState.turn + 3 };\n        const newUseCounts = { ...useCounts, \"train-power\": (useCounts[\"train-power\"] || 0) + 1 };\n        \n        onUpdateCharacter({ \n          power: character.power + gain,\n          health: character.health - 5,\n          actionCooldowns: newCooldowns,\n          actionUseCounts: newUseCounts\n        } as any);\n        \n        const message = gain < 2 ? `+${gain} Power (diminishing!)` : `+${gain} Power`;\n        toast({ title: \"Power Training\", description: `You've grown stronger! ${message}` });\n      }\n    },\n    {\n      id: \"socialize\",\n      name: \"Socialize\",\n      icon: Users,\n      description: \"Build relationships and influence\",\n      action: () => {\n        const influenceGain = Math.round(0.5 * powerBonus);\n        onUpdateCharacter({ influence: character.influence + influenceGain, wealth: character.wealth - 15, health: character.health - 2 });\n        toast({ title: \"Socialization\", description: `You made a connection. +${influenceGain} Influence` });\n      }\n    },\n    {\n      id: \"work\",\n      name: \"Work\",\n      icon: Briefcase,\n      description: \"Earn soul coins (cooldown: 10 turns)\",\n      action: () => {\n        if (isOnCooldown(\"work\")) {\n          toast({ \n            title: \"On Cooldown\", \n            description: `Available at turn ${cooldowns[\"work\"]}`,\n            variant: \"destructive\" \n          });\n          return;\n        }\n        \n        const newSoulcoins = (character.soulcoins || 0) + 1;\n        const newCooldowns = { ...cooldowns, \"work\": gameState.turn + 10 };\n        console.log(`[Work] Before: ${character.soulcoins}, After: ${newSoulcoins}`);\n        onUpdateCharacter({ \n          soulcoins: newSoulcoins,\n          health: character.health - 5,\n          actionCooldowns: newCooldowns\n        } as any);\n        \n        toast({ title: \"Work Complete\", description: `You earned 1 soul coin! (Total: ${newSoulcoins})` });\n      }\n    },\n    {\n      id: \"perform\",\n      name: \"Perform\",\n      icon: Music,\n      description: \"Entertain at the Hotel (cooldown: 8 turns)\",\n      action: () => {\n        if (isOnCooldown(\"perform\")) {\n          toast({ \n            title: \"On Cooldown\", \n            description: `Available at turn ${cooldowns[\"perform\"]}`,\n            variant: \"destructive\" \n          });\n          return;\n        }\n\n        const newCooldowns = { ...cooldowns, \"perform\": gameState.turn + 8 };\n        const influenceGain = Math.round(0.5 * powerBonus);\n        const empathyGain = Math.round(0.5 * powerBonus);\n        onUpdateCharacter({\n          influence: character.influence + influenceGain,\n          wealth: character.wealth + 20,\n          soulcoins: (character.soulcoins || 0) + 1,\n          empathy: character.empathy + empathyGain,\n          health: character.health - 10,\n          actionCooldowns: newCooldowns\n        } as any);\n        toast({ title: \"Performance\", description: `The crowd loves it! +${influenceGain} Influence, +20 wealth, +1 soulcoin, +${empathyGain} Empathy` });\n      }\n    },\n    {\n      id: \"scheme\",\n      name: \"Scheme for Power\",\n      icon: Heart,\n      description: \"Make deals for soulcoins (cooldown: 15 turns)\",\n      action: () => {\n        if (isOnCooldown(\"scheme\")) {\n          toast({ \n            title: \"On Cooldown\", \n            description: `Available at turn ${cooldowns[\"scheme\"]}`,\n            variant: \"destructive\" \n          });\n          return;\n        }\n\n        const soulcoinGain = Math.floor(Math.random() * 2) + 1; // 1-2 soulcoins\n        const influenceGain = Math.round(0.5 * powerBonus);\n        const newCooldowns = { ...cooldowns, \"scheme\": gameState.turn + 15 };\n        onUpdateCharacter({\n          soulcoins: (character.soulcoins || 0) + soulcoinGain,\n          influence: character.influence + influenceGain,\n          corruption: (character.corruption || 0) + 3,\n          health: character.health - 8,\n          actionCooldowns: newCooldowns\n        } as any);\n        toast({ title: \"Deal Made\", description: `You gained ${soulcoinGain} soulcoins and +${influenceGain} Influence through scheming!` });\n      }\n    },\n    {\n      id: \"territory\",\n      name: \"Claim Territory\",\n      icon: Swords,\n      description: \"Expand your domain\",\n      action: () => {\n        // Use all 7 districts instead of just territory keys\n        const districtIds = [\"hotel-district\", \"cannibal-colony\", \"entertainment-district\", \"vox-tower-zone\", \"industrial-hellscape\", \"overlord-territories\", \"royal-quarter\"];\n        const randomDistrict = districtIds[Math.floor(Math.random() * districtIds.length)];\n        const check = canClaimTerritory(gameState, randomDistrict);\n        \n        if (!check.can) {\n          toast({\n            title: \"Territory Claim Failed\",\n            description: check.reason || \"You cannot claim this territory\",\n            variant: \"destructive\"\n          });\n          return;\n        }\n        \n        const update = claimTerritory(gameState, randomDistrict);\n        if (update.character && update.territory) {\n          onUpdateCharacter({ \n            ...update.character, \n            actionCooldowns: { ...cooldowns, \"territory\": gameState.turn + 5 },\n            actionUseCounts: { ...useCounts }\n          } as any);\n          toast({ \n            title: \"Territory Claimed!\", \n            description: `You've claimed ${randomDistrict}! Difficulty: ${check.difficultyRating}` \n          });\n        }\n      }\n    },\n    {\n      id: \"romance\",\n      name: \"Romance\",\n      icon: Heart,\n      description: \"Deepen a relationship\",\n      action: () => {\n        const empathyGain = Math.round(1 * powerBonus);\n        const controlGain = Math.round(1 * powerBonus);\n        onUpdateCharacter({ empathy: character.empathy + empathyGain, control: character.control + controlGain, health: character.health - 5 });\n        toast({ title: \"Romance\", description: `A delicate connection forms... +${empathyGain} Empathy, +${controlGain} Control` });\n      }\n    }\n  ];\n\n  return (\n    <Card className=\"border-2 border-card-border\" data-testid=\"card-actions\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg font-display\">Actions</CardTitle>\n          <Button\n            onClick={onNextTurn}\n            className=\"gap-2\"\n            data-testid=\"button-next-turn\"\n          >\n            Next Turn\n            <ArrowRight className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\n          {actions.map((action) => {\n            const Icon = action.icon;\n            const onCooldown = isOnCooldown(action.id);\n            return (\n              <Button\n                key={action.id}\n                variant=\"outline\"\n                onClick={action.action}\n                disabled={onCooldown}\n                className={`h-auto flex-col items-start p-3 gap-1 ${onCooldown ? 'opacity-50 cursor-not-allowed' : 'hover-elevate'}`}\n                data-testid={`button-action-${action.id}`}\n              >\n                <div className=\"flex items-center gap-2 w-full\">\n                  <Icon className=\"w-4 h-4 text-primary\" />\n                  <span className=\"font-semibold text-sm\">{action.name}</span>\n                </div>\n                <p className=\"text-xs text-muted-foreground text-left w-full\">\n                  {action.description}\n                </p>\n                {onCooldown && (\n                  <p className=\"text-xs text-destructive text-left w-full font-semibold\">\n                    Ready turn {cooldowns[action.id]}\n                  </p>\n                )}\n              </Button>\n            );\n          })}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":10904},"client/src/lib/houndify.ts":{"content":"import type { GameState } from \"./game-state\";\n\n// Fallback templates in case Houndify API fails\nconst scenarioTemplates = [\n  {\n    titles: [\"A Bold Gambit\", \"Unconventional Tactics\", \"Creative Chaos\", \"Risky Maneuver\"],\n    narratives: [\n      \"Your unorthodox approach catches everyone off guard. They didn't see that coming.\",\n      \"The sheer audacity of your plan actually works. Sometimes madness is genius.\",\n      \"Nobody expected you to do that. The result is chaotic but effective.\",\n      \"Your creative solution bypasses all the normal rules. Impressive.\"\n    ],\n    statOptions: [\n      { power: 2, influence: 1, control: -1 },\n      { power: 1, corruption: 2, influence: 1 },\n      { power: 3, health: -8, control: -2 },\n      { influence: 4, wealth: -50, empathy: 1 }\n    ]\n  },\n  {\n    titles: [\"Manipulated the Situation\", \"Negotiated Successfully\", \"Turned the Tables\", \"Cunning Move\"],\n    narratives: [\n      \"Your words paint a convincing picture. They believe what you're saying.\",\n      \"You play both sides masterfully, each side thinking they're winning.\",\n      \"By appealing to their greed, you get exactly what you want.\",\n      \"A silver tongue and sharper wit carry you through.\"\n    ],\n    statOptions: [\n      { influence: 3, wealth: 100, empathy: -1 },\n      { control: 3, influence: 2 },\n      { wealth: 200, corruption: 2 },\n      { influence: 4, control: 2, empathy: -2 }\n    ]\n  },\n  {\n    titles: [\"Raw Power Unleashed\", \"Magical Assault\", \"Overwhelming Force\", \"Took Control\"],\n    narratives: [\n      \"You let loose with raw magical force. Your enemies didn't stand a chance.\",\n      \"Pure power in its most destructive form. Devastation follows.\",\n      \"You assert dominance through sheer overwhelming magical strength.\",\n      \"The very air crackles with your magical presence.\"\n    ],\n    statOptions: [\n      { power: 5, health: -15, corruption: 3 },\n      { power: 4, control: 1, wealth: 100 },\n      { power: 6, health: -20, influence: 2 },\n      { power: 3, influence: 2, control: 2 }\n    ]\n  }\n];\n\nfunction getFallbackOutcome() {\n  const template = scenarioTemplates[Math.floor(Math.random() * scenarioTemplates.length)];\n  const titleIdx = Math.floor(Math.random() * template.titles.length);\n  const narrativeIdx = Math.floor(Math.random() * template.narratives.length);\n  const statsIdx = Math.floor(Math.random() * template.statOptions.length);\n\n  return {\n    title: template.titles[titleIdx],\n    narrative: template.narratives[narrativeIdx],\n    statChanges: template.statOptions[statsIdx]\n  };\n}\n\nexport async function generateCustomOutcome(\n  userInput: string,\n  gameState: GameState\n): Promise<{\n  title: string;\n  narrative: string;\n  statChanges: Record<string, number>;\n} | null> {\n  try {\n    // Create a game-specific prompt for Houndify\n    const prompt = `You are a Hazbin Hotel life simulation game AI narrator. The player character \"${gameState.character.firstName} ${gameState.character.lastName}\" (Power level: ${gameState.character.power}) just chose to: \"${userInput}\"\n\nGenerate a brief narrative outcome (1-2 sentences) and a short title (2-4 words). Format EXACTLY like this:\nTITLE: [title here]\nNARRATIVE: [narrative here]\nSTATS: power:+1, influence:+2, corruption:-1\n\nKeep stat changes small (+/- 1 to 5). Use realistic stat keywords only.`;\n\n    // Call server-side Houndify proxy\n    const response = await fetch(\"/api/houndify-query\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        query: prompt,\n        userId: gameState.character.firstName.toLowerCase()\n      })\n    });\n\n    if (!response.ok) {\n      console.warn(`Houndify API error: ${response.status}`);\n      return getFallbackOutcome();\n    }\n\n    const data = await response.json();\n    \n    // Extract response from Houndify API\n    const responseText = data.result?.message || data.result?.WrittenResponseLong || \"\";\n    \n    if (!responseText) {\n      return getFallbackOutcome();\n    }\n\n    // Parse the formatted response\n    const titleMatch = responseText.match(/TITLE:\\s*([^\\n]+)/i);\n    const narrativeMatch = responseText.match(/NARRATIVE:\\s*([^\\n]+)/i);\n    const statsMatch = responseText.match(/STATS:\\s*([^\\n]+)/i);\n\n    if (!titleMatch || !narrativeMatch) {\n      return getFallbackOutcome();\n    }\n\n    const title = titleMatch[1].trim();\n    const narrative = narrativeMatch[1].trim();\n    \n    // Parse stats string like \"power:+1, influence:+2\"\n    const statChanges: Record<string, number> = {};\n    if (statsMatch) {\n      const statString = statsMatch[1];\n      const statPairs = statString.split(\",\");\n      statPairs.forEach(pair => {\n        const [key, value] = pair.split(\":\").map(s => s.trim());\n        if (key && value) {\n          statChanges[key] = parseInt(value) || 0;\n        }\n      });\n    }\n\n    return { title, narrative, statChanges };\n  } catch (error) {\n    console.error(\"Error generating custom outcome:\", error);\n    return getFallbackOutcome();\n  }\n}\n\nexport async function generateEventWithUserInput(\n  userInput: string,\n  gameState: GameState\n): Promise<any | null> {\n  try {\n    const outcome = await generateCustomOutcome(userInput, gameState);\n    if (!outcome) return null;\n\n    return {\n      id: `custom-${Date.now()}`,\n      title: outcome.title,\n      description: `You decide to: ${userInput}`,\n      type: \"custom\",\n      choices: [\n        {\n          id: \"accept\",\n          text: \"Accept this outcome\",\n          outcomes: {\n            statChanges: outcome.statChanges,\n            narrativeText: outcome.narrative\n          }\n        },\n        {\n          id: \"undo\",\n          text: \"Reconsider\",\n          outcomes: {\n            statChanges: {},\n            narrativeText: \"You change your mind.\"\n          }\n        }\n      ],\n      onlyOnce: false\n    };\n  } catch (error) {\n    console.error(\"Error generating event with user input:\", error);\n    return null;\n  }\n}\n","size_bytes":5946},"client/src/components/game/activities-panel.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Zap, Sword, Users, Trophy } from \"lucide-react\";\nimport districts from \"@/data/districts.json\";\nimport { generateActivityOutcome } from \"@/lib/smart-ai\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { getNpcData, updateRelationship } from \"@/lib/relationshipSystem\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface ActivitiesPanelProps {\n  gameState: GameState;\n  onUpdateCharacter: (updates: any) => void;\n  onEventGenerated: (event: any) => void;\n  onBattleStart?: (opponent: string, district: string) => void;\n  onUpdateGameState?: (updates: Partial<GameState>) => void;\n}\n\ninterface Activity {\n  id: string;\n  name: string;\n  description: string;\n  icon: React.ReactNode;\n  minPower?: number;\n  minControl?: number;\n  action: string;\n  riskLevel: \"low\" | \"medium\" | \"high\" | \"extreme\";\n  cooldown?: number; // Cooldown in turns (0 or undefined = no cooldown)\n}\n\nexport default function ActivitiesPanel({ gameState, onUpdateCharacter, onEventGenerated, onBattleStart, onUpdateGameState }: ActivitiesPanelProps) {\n  const { toast } = useToast();\n  const [isGenerating, setIsGenerating] = useState(false);\n\n  const currentDistrict = districts.find(d => d.id === gameState.character.currentLocation);\n  const districtRuler = currentDistrict?.currentRuler || \"unknown\";\n\n  // Track territory affinity penalties\n  const applyTerritoryAffinityPenalties = (activity: Activity) => {\n    const newRelationships = { ...gameState.relationships };\n    let affinityChanged = false;\n    \n    // Seizing territory damages affinity with the ruler\n    if (activity.id === \"seize-territory\" && districtRuler !== \"unknown\") {\n      const ruler = getNpcData(districtRuler);\n      if (ruler && newRelationships[districtRuler]) {\n        newRelationships[districtRuler] = updateRelationship(\n          newRelationships[districtRuler],\n          -25 // Major affinity hit\n        );\n        affinityChanged = true;\n        toast({\n          title: \"Territory Dispute\",\n          description: `${ruler.name} is extremely displeased with your territorial aggression!`,\n          variant: \"destructive\"\n        });\n      }\n    }\n\n    if (affinityChanged && onUpdateGameState) {\n      onUpdateGameState({ relationships: newRelationships });\n    }\n  };\n  \n  const handleBattleActivity = (activityId: string) => {\n    if (!currentDistrict) return;\n    if (activityId === \"challenge-overlord\") {\n      onBattleStart?.(districtRuler, currentDistrict.id);\n    } else if (activityId === \"duel-rival\") {\n      onBattleStart?.(\"rival-demon\", currentDistrict.id);\n    }\n  };\n\n  const activities: Activity[] = [\n    {\n      id: \"challenge-overlord\",\n      name: \"Challenge the Overlord\",\n      description: `Face off against ${districtRuler}. You need ~250+ power to realistically win.`,\n      icon: <Trophy className=\"w-5 h-5\" />,\n      minPower: 200,\n      action: \"challenge-overlord\",\n      riskLevel: \"extreme\",\n      cooldown: 0 // No cooldown for overlord challenges\n    },\n    {\n      id: \"duel-rival\",\n      name: \"Duel a Rival Demon\",\n      description: \"Face off against a local power. Winner takes respect and wealth.\",\n      icon: <Sword className=\"w-5 h-5\" />,\n      minPower: 10,\n      minControl: 8,\n      action: \"duel-rival\",\n      riskLevel: \"high\",\n      cooldown: 5\n    },\n    {\n      id: \"seize-territory\",\n      name: \"Seize Territory\",\n      description: \"Attempt to claim control of this district through force and cunning.\",\n      icon: <Zap className=\"w-5 h-5\" />,\n      minPower: 15,\n      minControl: 12,\n      action: \"seize-territory\",\n      riskLevel: \"extreme\",\n      cooldown: 8\n    },\n    {\n      id: \"gather-allies\",\n      name: \"Gather Allies\",\n      description: \"Recruit powerful demons to your cause through negotiation or bribery.\",\n      icon: <Users className=\"w-5 h-5\" />,\n      minControl: 10,\n      action: \"gather-allies\",\n      riskLevel: \"medium\",\n      cooldown: 4\n    },\n    {\n      id: \"undercover-plot\",\n      name: \"Undercover Plot\",\n      description: \"Execute a covert plan to gain influence over this territory.\",\n      icon: <Zap className=\"w-5 h-5\" />,\n      minControl: 15,\n      action: \"undercover-plot\",\n      riskLevel: \"high\",\n      cooldown: 6\n    },\n    {\n      id: \"corrupt-locals\",\n      name: \"Corrupt the Locals\",\n      description: \"Turn the populace against their ruler through darkness and promises.\",\n      icon: <Zap className=\"w-5 h-5\" />,\n      minPower: 12,\n      action: \"corrupt-locals\",\n      riskLevel: \"high\",\n      cooldown: 5\n    }\n  ];\n\n  const isActivityOnCooldown = (activityId: string): boolean => {\n    const cooldowns = gameState.actionCooldowns || {};\n    const availableTurn = cooldowns[activityId];\n    return availableTurn ? availableTurn > gameState.turn : false;\n  };\n\n  const canPerformActivity = (activity: Activity): boolean => {\n    if (activity.minPower && gameState.character.power < activity.minPower) return false;\n    if (activity.minControl && gameState.character.control < activity.minControl) return false;\n    if (isActivityOnCooldown(activity.id)) return false;\n    return true;\n  };\n\n  const getRiskColor = (risk: string) => {\n    switch (risk) {\n      case \"low\": return \"text-green-500\";\n      case \"medium\": return \"text-yellow-500\";\n      case \"high\": return \"text-orange-500\";\n      case \"extreme\": return \"text-red-500\";\n      default: return \"text-muted-foreground\";\n    }\n  };\n\n  const handleActivity = async (activity: Activity) => {\n    // Check cooldown first\n    if (isActivityOnCooldown(activity.id)) {\n      const cooldowns = gameState.actionCooldowns || {};\n      const availableTurn = cooldowns[activity.id] || gameState.turn;\n      toast({\n        title: \"On Cooldown\",\n        description: `Available at turn ${availableTurn}`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (!canPerformActivity(activity)) {\n      toast({\n        title: \"Not Ready\",\n        description: `You need higher stats to attempt this. Check requirements.`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Battle activities trigger battle system\n    if (activity.id === \"challenge-overlord\" || activity.id === \"duel-rival\") {\n      handleBattleActivity(activity.id);\n      return;\n    }\n\n    // Apply territory affinity penalties before generating outcome\n    applyTerritoryAffinityPenalties(activity);\n\n    setIsGenerating(true);\n    const outcome = await generateActivityOutcome(activity, gameState, currentDistrict);\n\n    if (outcome) {\n      onEventGenerated(outcome);\n      // Apply stat changes immediately\n      const updated = { ...gameState.character };\n      Object.entries(outcome.statChanges || {}).forEach(([stat, rawValue]: [string, unknown]) => {\n        const value = rawValue as number;\n        const currentValue = updated[stat as keyof typeof updated];\n        if (typeof currentValue === \"number\") {\n          // Cap health at 100, other stats grow infinitely\n          const newValue = currentValue + value;\n          if (stat === \"health\") {\n            (updated[stat as keyof typeof updated] as any) = Math.max(0, Math.min(100, newValue));\n          } else {\n            (updated[stat as keyof typeof updated] as any) = Math.max(0, newValue);\n          }\n        }\n      });\n\n      // Set cooldown if activity has one\n      const cooldowns = gameState.actionCooldowns || {};\n      if (activity.cooldown && activity.cooldown > 0) {\n        cooldowns[activity.id] = gameState.turn + activity.cooldown;\n      }\n\n      onUpdateCharacter({ ...updated, actionCooldowns: cooldowns });\n\n      toast({\n        title: activity.name,\n        description: \"Activity completed! Check the event panel for results.\",\n        duration: 4000\n      });\n    } else {\n      toast({\n        title: \"Failed\",\n        description: \"Could not generate activity outcome.\",\n        variant: \"destructive\"\n      });\n    }\n\n    setIsGenerating(false);\n  };\n\n  return (\n    <Card className=\"border-2 border-card-border\" data-testid=\"card-activities\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Trophy className=\"w-5 h-5 text-primary\" />\n          District Activities\n        </CardTitle>\n        <CardDescription>\n          Available actions in {currentDistrict?.name || \"your current location\"}\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-2\">\n        {activities.map((activity) => {\n          const canPerform = canPerformActivity(activity);\n          const isOnCooldown = isActivityOnCooldown(activity.id);\n          const cooldowns = gameState.actionCooldowns || {};\n          const availableTurn = cooldowns[activity.id];\n\n          return (\n            <div\n              key={activity.id}\n              className={`p-3 rounded border border-card-border hover-elevate transition-all ${\n                !canPerform ? \"opacity-50\" : \"\"\n              }`}\n            >\n              <div className=\"flex items-start justify-between mb-2\">\n                <div className=\"flex items-start gap-2 flex-1\">\n                  <div className=\"text-primary mt-1\">{activity.icon}</div>\n                  <div className=\"flex-1\">\n                    <div className=\"font-semibold text-sm\">{activity.name}</div>\n                    <div className=\"text-xs text-muted-foreground mb-1\">\n                      {activity.description}\n                    </div>\n                    <div className=\"flex gap-2 flex-wrap\">\n                      {activity.minPower && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          Power: {activity.minPower}+ (yours: {gameState.character.power})\n                        </Badge>\n                      )}\n                      {activity.minControl && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          Control: {activity.minControl}+ (yours: {gameState.character.control})\n                        </Badge>\n                      )}\n                      <Badge variant=\"secondary\" className={`text-xs ${getRiskColor(activity.riskLevel)}`}>\n                        Risk: {activity.riskLevel.toUpperCase()}\n                      </Badge>\n                      {isOnCooldown && (\n                        <Badge variant=\"destructive\" className=\"text-xs\">\n                          Cooldown: {availableTurn} turns\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <Button\n                size=\"sm\"\n                className=\"w-full\"\n                onClick={() => handleActivity(activity)}\n                disabled={!canPerform || isGenerating}\n                data-testid={`button-activity-${activity.id}`}\n              >\n                {isOnCooldown ? `Cooldown (${availableTurn} turns)` : isGenerating ? \"Processing...\" : \"Initiate\"}\n              </Button>\n            </div>\n          );\n        })}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":11227},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE - HAZBIN HOTEL DARK THEME */\n:root {\n  --button-outline: rgba(200,0,0, .15);\n  --badge-outline: rgba(200,0,0, .08);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(200,0,0, .05);\n  --elevate-2: rgba(200,0,0, .12);\n  --background: 0 0% 12%;\n  --foreground: 45 40% 90%;\n  --border: 0 100% 25%;\n  --card: 0 30% 18%;\n  --card-foreground: 45 40% 88%;\n  --card-border: 0 100% 35%;\n  --sidebar: 0 25% 16%;\n  --sidebar-foreground: 45 40% 88%;\n  --sidebar-border: 0 90% 30%;\n  --sidebar-primary: 0 100% 55%;\n  --sidebar-primary-foreground: 45 40% 95%;\n  --sidebar-accent: 45 100% 50%;\n  --sidebar-accent-foreground: 0 0% 15%;\n  --sidebar-ring: 0 100% 55%;\n  --popover: 0 30% 20%;\n  --popover-foreground: 45 40% 88%;\n  --popover-border: 0 100% 35%;\n  --primary: 0 100% 55%;\n  --primary-foreground: 45 40% 95%;\n  --secondary: 45 100% 50%;\n  --secondary-foreground: 0 0% 15%;\n  --muted: 0 20% 35%;\n  --muted-foreground: 45 40% 70%;\n  --accent: 45 100% 50%;\n  --accent-foreground: 0 0% 15%;\n  --destructive: 0 100% 45%;\n  --destructive-foreground: 45 40% 95%;\n  --input: 0 10% 30%;\n  --ring: 0 100% 55%;\n  --chart-1: 0 72% 32%;\n  --chart-2: 25 68% 28%;\n  --chart-3: 280 65% 30%;\n  --chart-4: 200 70% 28%;\n  --chart-5: 340 75% 30%;\n  --font-sans: DM Sans, Inter, sans-serif;\n  --font-serif: Playfair Display, Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,100,100, .15);\n  --badge-outline: rgba(255,100,100, .08);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,100,100, .06);\n  --elevate-2: rgba(255,100,100, .15);\n  --background: 0 0% 10%;\n  --foreground: 45 40% 92%;\n  --border: 0 100% 30%;\n  --card: 0 40% 15%;\n  --card-foreground: 45 40% 90%;\n  --card-border: 0 100% 38%;\n  --sidebar: 0 35% 14%;\n  --sidebar-foreground: 45 40% 90%;\n  --sidebar-border: 0 100% 35%;\n  --sidebar-primary: 0 100% 60%;\n  --sidebar-primary-foreground: 45 40% 98%;\n  --sidebar-accent: 45 100% 55%;\n  --sidebar-accent-foreground: 0 0% 10%;\n  --sidebar-ring: 0 100% 60%;\n  --popover: 0 40% 17%;\n  --popover-foreground: 45 40% 90%;\n  --popover-border: 0 100% 38%;\n  --primary: 0 100% 60%;\n  --primary-foreground: 45 40% 98%;\n  --secondary: 45 100% 55%;\n  --secondary-foreground: 0 0% 10%;\n  --muted: 0 30% 32%;\n  --muted-foreground: 45 40% 72%;\n  --accent: 45 100% 55%;\n  --accent-foreground: 0 0% 10%;\n  --destructive: 0 100% 50%;\n  --destructive-foreground: 45 40% 98%;\n  --input: 0 20% 28%;\n  --ring: 0 100% 60%;\n  --chart-1: 0 75% 55%;\n  --chart-2: 25 72% 58%;\n  --chart-3: 280 68% 60%;\n  --chart-4: 200 75% 58%;\n  --chart-5: 340 78% 60%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","size_bytes":10655},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/pages/game.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport StatsPanel from \"@/components/game/stats-panel\";\nimport PowersPanel from \"@/components/game/powers-panel\";\nimport EventCard from \"@/components/game/event-card\";\nimport ActionsPanel from \"@/components/game/actions-panel\";\nimport NPCPanel from \"@/components/game/npc-panel\";\nimport SocialPanel from \"@/components/game/social-panel\";\nimport MapPanel from \"@/components/game/map-panel\";\nimport RankingPanel from \"@/components/game/ranking-panel\";\nimport LocationPanel from \"@/components/game/location-panel\";\nimport ActivitiesPanel from \"@/components/game/activities-panel\";\nimport BattlePanel from \"@/components/game/battle-panel\";\nimport ProgressionPanel from \"@/components/game/progression-panel\";\nimport ShopPanel from \"@/components/game/shop-panel-collapsible\";\nimport MythicalShardShop from \"@/components/game/mythical-shard-shop\";\nimport AnimatedLoading from \"@/components/game/animated-loading\";\nimport NPCBattle from \"@/components/game/npc-battle\";\nimport RivalChallengeModal from \"@/components/game/rival-challenge-modal\";\nimport CompanionSelector from \"@/components/game/companion-selector\";\nimport { updateRelationship } from \"@/lib/relationshipSystem\";\nimport { Menu, X, LogOut, Save } from \"lucide-react\";\nimport { loadLatestSave, saveGame } from \"@/lib/game-state\";\nimport { initAudio, playLocationMusic } from \"@/lib/audio\";\nimport type { GameState } from \"@/lib/game-state\";\nimport npcsData from \"@/data/npcs.json\";\n\nexport default function GamePage() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [gameState, setGameState] = useState<GameState | null>(null);\n  const [showMenu, setShowMenu] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [currentEvent, setCurrentEvent] = useState<any | null>(null);\n  const [inBattle, setInBattle] = useState<{ opponent: string; district: string } | null>(null);\n  const [inNpcBattle, setInNpcBattle] = useState<string | null>(null);\n  const [rivalChallenge, setRivalChallenge] = useState<string | null>(null);\n  const [selectingCompanion, setSelectingCompanion] = useState(false);\n  const [selectedCompanion, setSelectedCompanion] = useState<string | null>(null);\n  const VERSION = \"V0.1\";\n\n  // Load game on mount and initialize audio\n  useEffect(() => {\n    const init = async () => {\n      initAudio();\n      playLocationMusic(\"background\"); // Play Stayed Gone as background music\n      \n      const saved = await loadLatestSave();\n      if (!saved) {\n        toast({ title: \"Error\", description: \"No game found. Returning to menu.\", variant: \"destructive\" });\n        setLocation(\"/\");\n        return;\n      }\n      setGameState(saved);\n      setIsLoading(false);\n    };\n    \n    init();\n  }, [setLocation, toast]);\n\n  // Switch music based on battle state\n  useEffect(() => {\n    if (!inBattle) {\n      playLocationMusic(\"background\"); // Back to background music after battle\n    }\n    // Don't call playLocationMusic(\"battle\") here - let BattlePanel handle battle themes\n  }, [inBattle]);\n\n  const handleBattleEnd = async (won: boolean, rewards: any, affinityChanges?: Record<string, number>) => {\n    if (!gameState || !inBattle) return;\n\n    const newRelationships = { ...gameState.relationships };\n    if (affinityChanges) {\n      Object.entries(affinityChanges).forEach(([npcId, change]) => {\n        if (newRelationships[npcId]) {\n          newRelationships[npcId] = updateRelationship(newRelationships[npcId], change);\n        }\n      });\n    }\n\n    const updatedCharacter = { ...gameState.character };\n    Object.entries(rewards).forEach(([key, value]) => {\n      if (key in updatedCharacter && typeof value === 'number') {\n        const current = updatedCharacter[key as keyof typeof updatedCharacter];\n        if (typeof current === 'number') {\n          let newValue: number;\n          if (key === 'health') {\n            newValue = Math.max(0, Math.min(100, current + value));\n          } else {\n            newValue = Math.max(0, current + value);\n          }\n          (updatedCharacter[key as keyof typeof updatedCharacter] as any) = newValue;\n        }\n      }\n    });\n\n    const newGameState = {\n      ...gameState,\n      character: updatedCharacter,\n      relationships: newRelationships\n    };\n\n    setGameState(newGameState);\n    await saveGame(newGameState, gameState.slot);\n    setInBattle(null);\n    setSelectedCompanion(null);\n\n    const verb = won ? \"defeated\" : \"lost to\";\n    toast({ \n      title: `Battle Complete`, \n      description: `You ${verb} your opponent!` \n    });\n  };\n\n  const handleNpcBattleEnd = async (won: boolean, affinityChange: number, rewards: any) => {\n    if (!gameState) return;\n\n    // Handle both inNpcBattle and rivalChallenge battle endings\n    const npcId = inNpcBattle || rivalChallenge;\n    if (!npcId) return;\n\n    const newRelationships = { ...gameState.relationships };\n    if (newRelationships[npcId]) {\n      newRelationships[npcId] = updateRelationship(newRelationships[npcId], affinityChange);\n    }\n\n    const updatedCharacter = { ...gameState.character };\n    Object.entries(rewards).forEach(([key, value]) => {\n      if (key in updatedCharacter && typeof value === 'number') {\n        const current = updatedCharacter[key as keyof typeof updatedCharacter];\n        if (typeof current === 'number') {\n          let newValue: number;\n          if (key === 'health') {\n            newValue = Math.max(0, Math.min(100, current + value));\n          } else {\n            newValue = Math.max(0, current + value);\n          }\n          (updatedCharacter[key as keyof typeof updatedCharacter] as any) = newValue;\n        }\n      }\n    });\n\n    const newGameState = {\n      ...gameState,\n      character: updatedCharacter,\n      relationships: newRelationships\n    };\n\n    setGameState(newGameState);\n    await saveGame(newGameState, gameState.slot);\n    setInNpcBattle(null);\n\n    const verb = won ? \"defeated\" : \"lost to\";\n    const npc = (npcsData as any[]).find((n: any) => n.id === inNpcBattle);\n    toast({ \n      title: `You ${verb} ${npc?.name}!`, \n      description: `Affinity: ${affinityChange > 0 ? \"+\" : \"\"}${affinityChange}` \n    });\n  };\n\n  const handleMendRelationship = async () => {\n    if (!gameState || !rivalChallenge) return;\n\n    const newRelationships = { ...gameState.relationships };\n    if (newRelationships[rivalChallenge]) {\n      // Mending costs influence but increases affinity\n      newRelationships[rivalChallenge].affinity += 20;\n      newRelationships[rivalChallenge].isRival = newRelationships[rivalChallenge].affinity < -30;\n    }\n\n    const updatedCharacter = {\n      ...gameState.character,\n      influence: Math.max(0, (gameState.character.influence || 0) - 10)\n    };\n\n    const newGameState = {\n      ...gameState,\n      character: updatedCharacter,\n      relationships: newRelationships\n    };\n\n    setGameState(newGameState);\n    await saveGame(newGameState, gameState.slot);\n    setRivalChallenge(null);\n    toast({ title: \"Reconciliation\", description: \"You've begun mending this relationship.\" });\n  };\n\n  const handleNextTurn = async () => {\n    if (!gameState) return;\n\n    const newAge = gameState.character.age + 1;\n    const previousLevel = Math.floor(gameState.character.age / 5);\n    const newLevel = Math.floor(newAge / 5);\n    \n    // Calculate stat bonuses from leveling (every 5 age = +1 level)\n    let levelUpBonus = {\n      power: 0,\n      control: 0,\n      influence: 0,\n      health: 0\n    };\n    \n    if (newLevel > previousLevel) {\n      // Level up! Gain +2 health and +0-1 to random stats (much grindier)\n      levelUpBonus.health = 2;\n      const statChoices = ['power', 'control', 'influence'];\n      const shouldGainStat = Math.random() < 0.3; // 30% chance for random stat\n      if (shouldGainStat) {\n        const stat = statChoices[Math.floor(Math.random() * statChoices.length)] as keyof typeof levelUpBonus;\n        levelUpBonus[stat] = 1;\n      }\n    }\n\n    const updatedCharacter = {\n      ...gameState.character,\n      age: newAge,\n      // Passive health regeneration: restore 5 health per turn (max 100)\n      health: Math.min(100, gameState.character.health + 5 + levelUpBonus.health),\n      // Apply level-up bonuses (no caps on stats)\n      power: gameState.character.power + levelUpBonus.power,\n      control: gameState.character.control + levelUpBonus.control,\n      influence: gameState.character.influence + levelUpBonus.influence\n    };\n\n    // Check for rival challenges (10% chance per turn if rivals exist)\n    const hasRivals = Object.values(gameState.relationships).some(r => r.isRival);\n    if (hasRivals && Math.random() < 0.1) {\n      const rivals = Object.entries(gameState.relationships)\n        .filter(([, r]) => r.isRival)\n        .map(([id]) => id);\n      \n      if (rivals.length > 0) {\n        const randomRival = rivals[Math.floor(Math.random() * rivals.length)];\n        setRivalChallenge(randomRival);\n      }\n    }\n\n    const updatedState: GameState = {\n      ...gameState,\n      turn: gameState.turn + 1,\n      character: updatedCharacter\n    };\n    \n    setGameState(updatedState);\n    await saveGame(updatedState, gameState.slot);\n    \n    // Show level-up message if applicable\n    if (newLevel > previousLevel) {\n      toast({ \n        title: \"Level Up!\", \n        description: `You've reached level ${newLevel}! +${levelUpBonus.health} Health, +${levelUpBonus.power} Power, +${levelUpBonus.control} Control, +${levelUpBonus.influence} Influence` \n      });\n    } else {\n      toast({ title: \"Turn Advanced\", description: `Now on turn ${updatedState.turn} (Age: ${newAge}, Level: ${newLevel})` });\n    }\n  };\n\n  const handleUpdateCharacter = async (updates: any) => {\n    if (!gameState) return;\n\n    const { actionCooldowns, actionUseCounts, ...characterUpdates } = updates;\n    \n    const updatedState: GameState = {\n      ...gameState,\n      character: { ...gameState.character, ...characterUpdates },\n      actionCooldowns: actionCooldowns || gameState.actionCooldowns,\n      actionUseCounts: actionUseCounts || gameState.actionUseCounts\n    };\n\n    console.log(`[GameUpdate] Slot: ${gameState.slot}, Old SC: ${gameState.character.soulcoins}, New SC: ${updatedState.character.soulcoins}`);\n    setGameState(updatedState);\n    await saveGame(updatedState, gameState.slot);\n  };\n\n  const handleUpdateGameState = async (updates: Partial<GameState>) => {\n    if (!gameState) return;\n    \n    const updatedState: GameState = {\n      ...gameState,\n      ...updates\n    };\n    \n    setGameState(updatedState);\n    await saveGame(updatedState, gameState.slot);\n  };\n\n  const handleQuitGame = () => {\n    setLocation(\"/\");\n  };\n\n  const handleSaveGame = async () => {\n    if (!gameState) return;\n    await saveGame(gameState, gameState.slot);\n    toast({ title: \"Game Saved!\", description: \"Your progress has been saved to browser storage.\" });\n  };\n\n  if (isLoading) {\n    return <AnimatedLoading />;\n  }\n\n  if (!gameState) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-b from-background to-card flex items-center justify-center\">\n        <Card className=\"p-8\">\n          <p className=\"text-destructive\">Game failed to load. Please start a new game.</p>\n          <Button onClick={handleQuitGame} className=\"mt-4\">\n            Return to Home\n          </Button>\n        </Card>\n      </div>\n    );\n  }\n\n  const handlePurchasePower = async (powerIds: string[], wealthSpent: number) => {\n    if (!gameState) return;\n\n    const updatedCharacter = {\n      ...gameState.character,\n      powers: [...(gameState.character.powers || []), ...powerIds],\n      wealth: Math.max(0, (gameState.character.wealth || 0) - wealthSpent)\n    };\n\n    const updatedState: GameState = {\n      ...gameState,\n      character: updatedCharacter\n    };\n\n    setGameState(updatedState);\n    // NOTE: NOT saving to localStorage - wealth shop purchases are session-only, not persistent\n    // Only mythical shard purchases (handlePurchaseMythical) persist globally\n  };\n\n  const handlePurchaseMythical = async (powerId: string, shardsSpent: number) => {\n    if (!gameState) return;\n\n    const updatedCharacter = {\n      ...gameState.character,\n      powers: [...(gameState.character.powers || []), powerId],\n      mythicalShards: Math.max(0, (gameState.character.mythicalShards || 0) - shardsSpent)\n    };\n\n    const updatedState: GameState = {\n      ...gameState,\n      character: updatedCharacter\n    };\n\n    setGameState(updatedState);\n    await saveGame(updatedState);\n    toast({ title: \"Mythical Power Acquired!\", description: \"Your power has been unlocked!\" });\n  };\n\n  const { character } = gameState;\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-background to-card\">\n      {/* Version Indicator */}\n      <div className=\"fixed top-4 right-4 z-40 text-sm font-bold text-primary animate-pulse\" \n           style={{textShadow: '0 0 10px rgba(239, 68, 68, 0.8)', letterSpacing: '2px'}}>\n        {VERSION}\n      </div>\n\n      {/* Header */}\n      <header className=\"sticky top-0 z-50 bg-card border-b border-card-border p-4\">\n        <div className=\"max-w-7xl mx-auto flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <h1 className=\"font-display text-2xl font-bold text-primary\">\n              {character.name}\n            </h1>\n            <div className=\"text-sm text-muted-foreground\">\n              Turn {gameState.turn} ‚Ä¢ Age {character.age}\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleSaveGame}\n              className=\"gap-2\"\n              data-testid=\"button-save\"\n            >\n              <Save className=\"w-4 h-4\" />\n              Save\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setShowMenu(!showMenu)}\n              data-testid=\"button-menu\"\n            >\n              {showMenu ? <X className=\"w-5 h-5\" /> : <Menu className=\"w-5 h-5\" />}\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={handleQuitGame}\n              data-testid=\"button-quit\"\n            >\n              <LogOut className=\"w-5 h-5\" />\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Game Layout */}\n      <div className=\"max-w-7xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-4 gap-4 lg:h-[calc(100vh-120px)]\">\n        {/* Left Column - Stats & Powers & Ranking & Progression & Shop & Mythical Shop */}\n        <div className=\"space-y-4 overflow-y-auto\">\n          <StatsPanel character={character} />\n          <PowersPanel gameState={gameState} />\n          <ShopPanel gameState={gameState} onPurchasePower={handlePurchasePower} />\n          <MythicalShardShop gameState={gameState} onPurchaseMythical={handlePurchaseMythical} />\n          <RankingPanel gameState={gameState} />\n          <ProgressionPanel gameState={gameState} />\n        </div>\n\n        {/* Center Column - Events & Actions & Social */}\n        <div className=\"lg:col-span-2 space-y-4 overflow-y-auto\">\n          <div className=\"bg-gradient-to-r from-primary/20 to-primary/10 border-l-4 border-primary rounded p-3 text-sm font-semibold text-amber-100\">\n            ‚ö° CURRENT EVENT\n          </div>\n          <EventCard \n            gameState={gameState} \n            onUpdateCharacter={handleUpdateCharacter}\n            onUpdateGameState={handleUpdateGameState}\n          />\n          <ActionsPanel \n            onNextTurn={handleNextTurn} \n            gameState={gameState} \n            onUpdateCharacter={handleUpdateCharacter} \n          />\n          <MapPanel territories={gameState.territory} />\n          <SocialPanel \n            gameState={gameState}\n            onUpdateGameState={handleUpdateGameState}\n          />\n        </div>\n\n        {/* Right Column - Location & Activities */}\n        <div className=\"space-y-4 overflow-y-auto\">\n          <LocationPanel \n            gameState={gameState}\n            onUpdateCharacter={handleUpdateCharacter}\n          />\n          <ActivitiesPanel \n            gameState={gameState}\n            onUpdateCharacter={handleUpdateCharacter}\n            onEventGenerated={setCurrentEvent}\n            onBattleStart={(opponent, district) => {\n              setInBattle({ opponent, district });\n              setSelectingCompanion(true);\n            }}\n            onUpdateGameState={handleUpdateGameState}\n          />\n        </div>\n      </div>\n\n      {/* Right Sidebar - NPCs & Info (conditional) */}\n      {showMenu && (\n        <div className=\"fixed inset-y-0 right-0 w-80 bg-card border-l border-card-border p-4 overflow-y-auto z-40\">\n          <NPCPanel relationships={gameState.relationships} />\n        </div>\n      )}\n\n      {/* Overlord/Rival Battle with Companion Selection */}\n      {selectingCompanion && inBattle && (\n        <CompanionSelector\n          gameState={gameState}\n          onSelectCompanion={(companion) => {\n            setSelectedCompanion(companion);\n            setSelectingCompanion(false);\n          }}\n          onContinue={() => setSelectingCompanion(false)}\n        />\n      )}\n\n      {inBattle && !selectingCompanion && (\n        <div className=\"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4\">\n          <BattlePanel\n            gameState={gameState}\n            opponent={inBattle.opponent}\n            currentDistrict={inBattle.district}\n            companion={selectedCompanion}\n            onBattleEnd={handleBattleEnd}\n          />\n        </div>\n      )}\n\n      {/* NPC Battle Modal */}\n      {inNpcBattle && (\n        <div className=\"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4\">\n          <NPCBattle\n            npcId={inNpcBattle}\n            gameState={gameState}\n            onBattleEnd={handleNpcBattleEnd}\n          />\n        </div>\n      )}\n\n      {/* Rival Challenge Modal */}\n      {rivalChallenge && (\n        <RivalChallengeModal\n          npcId={rivalChallenge}\n          gameState={gameState}\n          onFight={() => {\n            setInBattle({ opponent: rivalChallenge, district: \"pride-ring\" });\n            setSelectingCompanion(true);\n            setRivalChallenge(null);\n          }}\n          onFightWithCompanion={() => {\n            setInBattle({ opponent: rivalChallenge, district: \"pride-ring\" });\n            setSelectingCompanion(true);\n            setRivalChallenge(null);\n          }}\n          onMend={handleMendRelationship}\n          onDismiss={() => setRivalChallenge(null)}\n        />\n      )}\n    </div>\n  );\n}\n","size_bytes":18869},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/lib/aiEventClient.ts":{"content":"import type { GameState } from \"./game-state\";\nimport type { GameEvent } from \"@shared/schema\";\n\nexport async function generateAIEvent(gameState: GameState): Promise<Partial<GameEvent> | null> {\n  try {\n    const response = await fetch(\"/api/ai-event\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        theme: getEventTheme(gameState),\n        location: gameState.character.location || \"hotel-district\",\n        characterPower: gameState.character.power,\n        characterCorruption: gameState.character.corruption\n      })\n    });\n\n    if (!response.ok) return null;\n    return await response.json();\n  } catch (error) {\n    console.error(\"Error fetching AI event:\", error);\n    return null;\n  }\n}\n\nfunction getEventTheme(gameState: GameState): string {\n  if (gameState.character.power > 80) return \"ultimate-power\";\n  if (gameState.character.corruption > 70) return \"corruption-themed\";\n  if (gameState.character.empathy > 70) return \"redemption-themed\";\n  if (gameState.character.influence > 60) return \"politics\";\n  if (gameState.character.wealth > 500) return \"wealth-based\";\n  return \"random\";\n}\n\nexport async function generateNPCDialogue(npcName: string, context: string): Promise<string> {\n  try {\n    const response = await fetch(\"/api/npc-dialogue\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ npcName, context })\n    });\n\n    if (!response.ok) return \"...\";\n    const data = await response.json();\n    return data.dialogue || \"...\";\n  } catch (error) {\n    console.error(\"Error fetching NPC dialogue:\", error);\n    return \"...\";\n  }\n}\n","size_bytes":1676},"client/src/components/game/shop-panel-collapsible.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  ShoppingCart, Zap, Lock, Flame, Droplet, Moon, Eye, Skull, AlertCircle,\n  Sparkles, Users, Volume2, Handshake, Star, Wand2, Heart, Infinity, Lightbulb,\n  ChevronDown, ChevronUp\n} from \"lucide-react\";\nimport powers from \"@/data/powers.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface ShopPanelProps {\n  gameState: GameState;\n  onPurchasePower: (powerIds: string[], wealthSpent: number) => void;\n}\n\nconst POWER_TYPE_ICONS: Record<string, React.ReactNode> = {\n  \"hellfire\": <Flame className=\"w-4 h-4 text-red-500\" />,\n  \"blood-magic\": <Droplet className=\"w-4 h-4 text-red-700\" />,\n  \"shadow\": <Moon className=\"w-4 h-4 text-slate-700\" />,\n  \"illusion\": <Eye className=\"w-4 h-4 text-purple-500\" />,\n  \"necromancy\": <Skull className=\"w-4 h-4 text-gray-600\" />,\n  \"teleportation\": <AlertCircle className=\"w-4 h-4 text-blue-500\" />,\n  \"glamour\": <Sparkles className=\"w-4 h-4 text-pink-500\" />,\n  \"summoning\": <Users className=\"w-4 h-4 text-amber-600\" />,\n  \"voice-broadcast\": <Volume2 className=\"w-4 h-4 text-yellow-600\" />,\n  \"deals\": <Handshake className=\"w-4 h-4 text-green-600\" />,\n  \"holy\": <Star className=\"w-4 h-4 text-yellow-300\" />,\n  \"transformation\": <Wand2 className=\"w-4 h-4 text-purple-600\" />,\n  \"bond\": <Heart className=\"w-4 h-4 text-red-500\" />,\n  \"reality\": <Infinity className=\"w-4 h-4 text-cyan-500\" />,\n  \"void\": <Lightbulb className=\"w-4 h-4 text-indigo-700\" />,\n  \"chaos\": <Zap className=\"w-4 h-4 text-orange-600\" />,\n  \"shadow-eldritch\": <Moon className=\"w-4 h-4 text-slate-800\" />,\n  \"contract\": <Handshake className=\"w-4 h-4 text-amber-700\" />,\n  \"seduction\": <Sparkles className=\"w-4 h-4 text-pink-600\" />,\n};\n\nexport default function ShopPanel({ gameState, onPurchasePower }: ShopPanelProps) {\n  const { toast } = useToast();\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [selectedRarity, setSelectedRarity] = useState<string | null>(null);\n\n  const POWER_PRICES: Record<string, number> = {\n    common: 800,\n    uncommon: 5000,\n    rare: 12000,\n    epic: 25000,\n    legendary: 50000,\n    mythical: 99999 // Not available in shop\n  };\n\n  const ownedPowerIds = new Set(gameState.character.powers || []);\n  \n  const availablePowers = (powers as any[]).filter(\n    p => !ownedPowerIds.has(p.id) && p.rarity !== \"mythical\" // Exclude mythicals from shop\n  ).sort((a, b) => {\n    const rarityOrder = { common: 0, uncommon: 1, rare: 2, epic: 3, legendary: 4 };\n    const aRarity = rarityOrder[a.rarity as keyof typeof rarityOrder] ?? 6;\n    const bRarity = rarityOrder[b.rarity as keyof typeof rarityOrder] ?? 6;\n    if (aRarity !== bRarity) return aRarity - bRarity;\n    return a.name.localeCompare(b.name);\n  });\n\n  const rarities = [\"common\", \"uncommon\", \"rare\", \"epic\", \"legendary\"];\n  \n  const handlePurchase = (power: any) => {\n    const price = POWER_PRICES[power.rarity];\n    \n    if ((gameState.character.wealth || 0) < price) {\n      toast({\n        title: \"Insufficient Wealth\",\n        description: `You need ${price} wealth to buy ${power.name}.`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    onPurchasePower([power.id], price);\n    toast({\n      title: \"Power Acquired!\",\n      description: `${power.name}! (-${price} wealth)`\n    });\n  };\n\n  const getRarityColor = (rarity: string) => {\n    const colors: Record<string, string> = {\n      common: \"bg-slate-500\",\n      uncommon: \"bg-green-600\",\n      rare: \"bg-blue-600\",\n      epic: \"bg-purple-600\",\n      legendary: \"bg-yellow-600\",\n      mythical: \"bg-red-700\"\n    };\n    return colors[rarity] || \"bg-slate-500\";\n  };\n\n  const getRarityTextColor = (rarity: string) => {\n    const colors: Record<string, string> = {\n      common: \"text-slate-400\",\n      uncommon: \"text-green-400\",\n      rare: \"text-blue-400\",\n      epic: \"text-purple-400\",\n      legendary: \"text-yellow-400\",\n      mythical: \"text-red-400\"\n    };\n    return colors[rarity] || \"text-slate-400\";\n  };\n\n  const filteredPowers = availablePowers.filter(\n    p => !selectedRarity || p.rarity === selectedRarity\n  );\n\n  if (!isExpanded) {\n    return (\n      <Card>\n        <Button\n          onClick={() => setIsExpanded(true)}\n          variant=\"outline\"\n          className=\"w-full justify-between\"\n          data-testid=\"button-open-shop\"\n        >\n          <div className=\"flex items-center gap-2\">\n            <ShoppingCart className=\"w-4 h-4\" />\n            Power Shop ({availablePowers.length})\n          </div>\n          <ChevronDown className=\"w-4 h-4\" />\n        </Button>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <ShoppingCart className=\"w-5 h-5 text-primary\" />\n            <CardTitle>Power Shop</CardTitle>\n          </div>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => setIsExpanded(false)}\n            data-testid=\"button-close-shop\"\n          >\n            <ChevronUp className=\"w-4 h-4\" />\n          </Button>\n        </div>\n        <div className=\"flex justify-between items-center mt-2\">\n          <CardDescription>Common powers are free. Higher rarities cost more.</CardDescription>\n          <div className=\"text-sm font-semibold text-primary\">\n            Wealth: {gameState.character.wealth || 0}\n          </div>\n        </div>\n      </CardHeader>\n\n      <CardContent className=\"flex-1 overflow-hidden flex flex-col gap-3\">\n        {/* Rarity Filters */}\n        <div className=\"flex gap-2 flex-wrap\">\n          <Button\n            size=\"sm\"\n            variant={selectedRarity === null ? \"default\" : \"outline\"}\n            onClick={() => setSelectedRarity(null)}\n          >\n            All ({availablePowers.length})\n          </Button>\n          {rarities.map(r => {\n            const count = availablePowers.filter(p => p.rarity === r).length;\n            return (\n              <Button\n                key={r}\n                size=\"sm\"\n                variant={selectedRarity === r ? \"default\" : \"outline\"}\n                onClick={() => setSelectedRarity(r)}\n                className={selectedRarity === r ? getRarityColor(r) + \" text-white\" : \"\"}\n              >\n                {r} ({count})\n              </Button>\n            );\n          })}\n        </div>\n\n        {/* Power List */}\n        <ScrollArea className=\"flex-1\">\n          <div className=\"space-y-2 pr-4\">\n            {filteredPowers.length > 0 ? (\n              filteredPowers.map(power => {\n                const price = POWER_PRICES[power.rarity];\n                const canAfford = (gameState.character.wealth || 0) >= price;\n                const icon = POWER_TYPE_ICONS[power.type] || <Zap className=\"w-4 h-4\" />;\n                \n                return (\n                  <div\n                    key={power.id}\n                    className=\"p-2 bg-card border border-card-border rounded-md hover-elevate\"\n                  >\n                    <div className=\"flex items-start justify-between gap-2\">\n                      {icon}\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                          <h3 className=\"font-semibold text-sm\">{power.name}</h3>\n                          <Badge className={`text-xs ${getRarityColor(power.rarity)} text-white`}>\n                            {power.rarity}\n                          </Badge>\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-0.5 line-clamp-1\">\n                          {power.description}\n                        </p>\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        onClick={() => handlePurchase(power)}\n                        disabled={!canAfford}\n                        variant={canAfford ? \"default\" : \"outline\"}\n                        className=\"whitespace-nowrap\"\n                      >\n                        {`${price}`}\n                      </Button>\n                    </div>\n                  </div>\n                );\n              })\n            ) : (\n              <div className=\"text-center py-4 text-muted-foreground\">\n                <Lock className=\"w-6 h-6 mx-auto mb-2 opacity-50\" />\n                <p className=\"text-xs\">All owned!</p>\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":8848},"client/src/components/game/mythical-shard-shop.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Gem, Sparkles, ChevronDown, ChevronUp } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport powersData from \"@/data/powers.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface MythicalShardShopProps {\n  gameState: GameState;\n  onPurchaseMythical: (powerId: string, shardsSpent: number) => void;\n}\n\nexport default function MythicalShardShop({ gameState, onPurchaseMythical }: MythicalShardShopProps) {\n  const { toast } = useToast();\n  const [isExpanded, setIsExpanded] = useState(false);\n  const powers = powersData as any[];\n  const ownedPowerIds = new Set(gameState.character.powers || []);\n  \n  // Get mythical powers not owned\n  const mythicalPowers = powers\n    .filter(p => p.rarity === \"mythical\" && !ownedPowerIds.has(p.id))\n    .sort((a, b) => a.name.localeCompare(b.name));\n\n  const MYTHICAL_SHARD_COST = 10; // Cost in shards per mythical power\n\n  const handlePurchase = (power: any) => {\n    const shardsNeeded = MYTHICAL_SHARD_COST;\n    if ((gameState.character.mythicalShards || 0) < shardsNeeded) {\n      toast({\n        title: \"Insufficient Shards\",\n        description: `You need ${shardsNeeded} mythical shards (have ${gameState.character.mythicalShards || 0})`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    onPurchaseMythical(power.id, shardsNeeded);\n    toast({\n      title: \"Mythical Power Acquired!\",\n      description: `${power.name}! (-${shardsNeeded} shards)`\n    });\n  };\n\n  if (!isExpanded) {\n    return (\n      <Card>\n        <Button\n          onClick={() => setIsExpanded(true)}\n          variant=\"outline\"\n          className=\"w-full justify-between\"\n        >\n          <div className=\"flex items-center gap-2\">\n            <Gem className=\"w-4 h-4\" />\n            Mythical Shards ({mythicalPowers.length})\n          </div>\n          <ChevronDown className=\"w-4 h-4\" />\n        </Button>\n      </Card>\n    );\n  }\n\n  if (mythicalPowers.length === 0) {\n    return (\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <Gem className=\"w-5 h-5 text-amber-500\" />\n              <CardTitle>Mythical Shard Shop</CardTitle>\n            </div>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => setIsExpanded(false)}\n            >\n              <ChevronUp className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-6 text-muted-foreground\">\n            <p>All mythical powers have been acquired!</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Sparkles className=\"w-5 h-5 text-amber-500\" />\n            <CardTitle>Mythical Shard Shop</CardTitle>\n          </div>\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => setIsExpanded(false)}\n          >\n            <ChevronUp className=\"w-4 h-4\" />\n          </Button>\n        </div>\n        <div className=\"text-sm text-muted-foreground\">\n          <div className=\"flex items-center justify-between mt-2\">\n            <span>Exchange shards for exclusive powers</span>\n            <div className=\"flex items-center gap-2 bg-amber-500/20 px-3 py-2 rounded-md\">\n              <Gem className=\"w-4 h-4 text-amber-500\" />\n              <span className=\"font-semibold text-amber-300\">{gameState.character.mythicalShards || 0}</span>\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"flex-1 overflow-hidden flex flex-col\">\n        <ScrollArea className=\"h-80\">\n          <div className=\"space-y-2 pr-4\">\n            {mythicalPowers.map(power => {\n              const canAfford = (gameState.character.mythicalShards || 0) >= MYTHICAL_SHARD_COST;\n              \n              return (\n                <div\n                  key={power.id}\n                  className=\"p-3 border rounded-md bg-card border-card-border hover-elevate\"\n                >\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 flex-wrap\">\n                        <h3 className=\"font-semibold text-sm\">{power.name}</h3>\n                        <Badge className=\"bg-red-700 text-white text-xs\">Mythical</Badge>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground mt-1 line-clamp-1\">\n                        {power.description}\n                      </p>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      onClick={() => handlePurchase(power)}\n                      disabled={!canAfford}\n                      variant={canAfford ? \"default\" : \"outline\"}\n                      className=\"whitespace-nowrap\"\n                    >\n                      {MYTHICAL_SHARD_COST}\n                    </Button>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </ScrollArea>\n        <div className=\"mt-4 p-3 bg-muted rounded-md\">\n          <p className=\"text-xs text-muted-foreground\">\n            Each mythical power costs {MYTHICAL_SHARD_COST} mythical shards. Earn shards by defeating overlords!\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":5936},"client/src/components/game/shop-panel.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  ShoppingCart, Zap, Lock, Flame, Droplet, Moon, Eye, Skull, AlertCircle,\n  Sparkles, Users, Volume2, Handshake, Star, Wand2, Heart, Infinity, Lightbulb\n} from \"lucide-react\";\nimport powers from \"@/data/powers.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface ShopPanelProps {\n  gameState: GameState;\n  onPurchasePower: (powerIds: string[], wealthSpent: number) => void;\n}\n\nconst POWER_TYPE_ICONS: Record<string, React.ReactNode> = {\n  \"hellfire\": <Flame className=\"w-4 h-4 text-red-500\" />,\n  \"blood-magic\": <Droplet className=\"w-4 h-4 text-red-700\" />,\n  \"shadow\": <Moon className=\"w-4 h-4 text-slate-700\" />,\n  \"illusion\": <Eye className=\"w-4 h-4 text-purple-500\" />,\n  \"necromancy\": <Skull className=\"w-4 h-4 text-gray-600\" />,\n  \"teleportation\": <AlertCircle className=\"w-4 h-4 text-blue-500\" />,\n  \"glamour\": <Sparkles className=\"w-4 h-4 text-pink-500\" />,\n  \"summoning\": <Users className=\"w-4 h-4 text-amber-600\" />,\n  \"voice-broadcast\": <Volume2 className=\"w-4 h-4 text-yellow-600\" />,\n  \"deals\": <Handshake className=\"w-4 h-4 text-green-600\" />,\n  \"holy\": <Star className=\"w-4 h-4 text-yellow-300\" />,\n  \"transformation\": <Wand2 className=\"w-4 h-4 text-purple-600\" />,\n  \"bond\": <Heart className=\"w-4 h-4 text-red-500\" />,\n  \"reality\": <Infinity className=\"w-4 h-4 text-cyan-500\" />,\n  \"void\": <Lightbulb className=\"w-4 h-4 text-indigo-700\" />,\n  \"chaos\": <Zap className=\"w-4 h-4 text-orange-600\" />,\n  \"shadow-eldritch\": <Moon className=\"w-4 h-4 text-slate-800\" />,\n  \"contract\": <Handshake className=\"w-4 h-4 text-amber-700\" />,\n  \"seduction\": <Sparkles className=\"w-4 h-4 text-pink-600\" />,\n};\n\nexport default function ShopPanel({ gameState, onPurchasePower }: ShopPanelProps) {\n  const { toast } = useToast();\n  const [selectedRarity, setSelectedRarity] = useState<string | null>(null);\n\n  // Power prices by rarity - Common is FREE\n  const POWER_PRICES: Record<string, number> = {\n    common: 0,\n    uncommon: 500,\n    rare: 1500,\n    epic: 3500,\n    legendary: 7500\n  };\n\n  const ownedPowerIds = new Set(gameState.character.powers || []);\n  \n  // Show ALL powers (including common and passive) - but exclude already owned\n  const availablePowers = (powers as any[]).filter(\n    p => !ownedPowerIds.has(p.id)\n  ).sort((a, b) => {\n    // Sort by rarity then name\n    const rarityOrder = { common: 0, uncommon: 1, rare: 2, epic: 3, legendary: 4 };\n    const aRarity = rarityOrder[a.rarity as keyof typeof rarityOrder] ?? 5;\n    const bRarity = rarityOrder[b.rarity as keyof typeof rarityOrder] ?? 5;\n    if (aRarity !== bRarity) return aRarity - bRarity;\n    return a.name.localeCompare(b.name);\n  });\n\n  const rarities = [\"common\", \"uncommon\", \"rare\", \"epic\", \"legendary\"];\n  \n  const handlePurchase = (power: any) => {\n    const price = POWER_PRICES[power.rarity];\n    \n    if ((gameState.character.wealth || 0) < price) {\n      toast({\n        title: \"Insufficient Wealth\",\n        description: `You need ${price} wealth to buy ${power.name}. You have ${gameState.character.wealth || 0}.`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    onPurchasePower([power.id], price);\n    toast({\n      title: \"Power Acquired!\",\n      description: `You learned ${power.name}!${price > 0 ? ` (${price} wealth spent)` : \" (Free)\"}`\n    });\n  };\n\n  const getRarityColor = (rarity: string) => {\n    const colors: Record<string, string> = {\n      common: \"bg-slate-500\",\n      uncommon: \"bg-green-600\",\n      rare: \"bg-blue-600\",\n      epic: \"bg-purple-600\",\n      legendary: \"bg-yellow-600\"\n    };\n    return colors[rarity] || \"bg-slate-500\";\n  };\n\n  const getRarityTextColor = (rarity: string) => {\n    const colors: Record<string, string> = {\n      common: \"text-slate-400\",\n      uncommon: \"text-green-400\",\n      rare: \"text-blue-400\",\n      epic: \"text-purple-400\",\n      legendary: \"text-yellow-400\"\n    };\n    return colors[rarity] || \"text-slate-400\";\n  };\n\n  const filteredPowers = availablePowers.filter(\n    p => !selectedRarity || p.rarity === selectedRarity\n  );\n\n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <ShoppingCart className=\"w-5 h-5 text-primary\" />\n            <CardTitle>Power Shop</CardTitle>\n          </div>\n          <div className=\"text-sm font-semibold text-primary\">\n            Wealth: {gameState.character.wealth || 0}\n          </div>\n        </div>\n        <CardDescription>\n          Common powers are free. Higher rarities cost more wealth.\n        </CardDescription>\n      </CardHeader>\n\n      <CardContent className=\"flex-1 overflow-hidden flex flex-col gap-3\">\n        {/* Rarity Filters */}\n        <div className=\"flex gap-2 flex-wrap\">\n          <Button\n            size=\"sm\"\n            variant={selectedRarity === null ? \"default\" : \"outline\"}\n            onClick={() => setSelectedRarity(null)}\n            data-testid=\"filter-all-powers\"\n          >\n            All ({availablePowers.length})\n          </Button>\n          {rarities.map(r => {\n            const count = availablePowers.filter(p => p.rarity === r).length;\n            return (\n              <Button\n                key={r}\n                size=\"sm\"\n                variant={selectedRarity === r ? \"default\" : \"outline\"}\n                onClick={() => setSelectedRarity(r)}\n                className={selectedRarity === r ? getRarityColor(r) + \" text-white\" : \"\"}\n                data-testid={`filter-${r}-powers`}\n              >\n                {r.charAt(0).toUpperCase() + r.slice(1)} ({count})\n              </Button>\n            );\n          })}\n        </div>\n\n        {/* Power List */}\n        <ScrollArea className=\"flex-1\">\n          <div className=\"space-y-2 pr-4\">\n            {filteredPowers.length > 0 ? (\n              filteredPowers.map(power => {\n                const price = POWER_PRICES[power.rarity];\n                const canAfford = (gameState.character.wealth || 0) >= price;\n                const icon = POWER_TYPE_ICONS[power.type] || <Zap className=\"w-4 h-4\" />;\n                \n                return (\n                  <div\n                    key={power.id}\n                    className=\"p-3 bg-card border border-card-border rounded-md hover-elevate transition-all\"\n                  >\n                    <div className=\"flex items-start justify-between gap-3\">\n                      {/* Icon */}\n                      <div className=\"flex-shrink-0 pt-0.5\">\n                        {icon}\n                      </div>\n\n                      {/* Info */}\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                          <h3 className=\"font-semibold text-sm\">{power.name}</h3>\n                          <Badge \n                            variant=\"outline\" \n                            className={`text-xs ${getRarityColor(power.rarity)} text-white`}\n                          >\n                            {power.rarity}\n                          </Badge>\n                          {power.isPassive && (\n                            <Badge variant=\"secondary\" className=\"text-xs\">\n                              Passive\n                            </Badge>\n                          )}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-1 line-clamp-2\">\n                          {power.description}\n                        </p>\n                        <div className=\"flex items-center gap-3 mt-2 text-xs flex-wrap\">\n                          {power.basePower > 0 && (\n                            <span className=\"flex items-center gap-1\">\n                              <Zap className=\"w-3 h-3\" />\n                              {power.basePower}\n                            </span>\n                          )}\n                          <span className={getRarityTextColor(power.rarity)}>\n                            {power.type}\n                          </span>\n                        </div>\n                      </div>\n\n                      {/* Buy Button */}\n                      <div className=\"flex-shrink-0 text-right\">\n                        <Button\n                          size=\"sm\"\n                          onClick={() => handlePurchase(power)}\n                          disabled={!canAfford && price > 0}\n                          variant={canAfford || price === 0 ? \"default\" : \"outline\"}\n                          className=\"gap-1 whitespace-nowrap\"\n                          data-testid={`button-buy-${power.id}`}\n                        >\n                          {price === 0 ? \"Free\" : `${price}`}\n                        </Button>\n                        {!canAfford && price > 0 && (\n                          <p className=\"text-xs text-destructive mt-1\">\n                            Need {price - (gameState.character.wealth || 0)}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                );\n              })\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Lock className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n                <p>You own all powers in this category!</p>\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":9805},"client/src/components/character-creation/powers-shop-step.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Gem, Zap, Lock, AlertCircle } from \"lucide-react\";\nimport powersData from \"@/data/powers.json\";\nimport { getAllSaves } from \"@/lib/game-state\";\nimport type { CharacterData } from \"@/pages/character-creation\";\nimport type { Power } from \"@shared/schema\";\n\ninterface ShopStepProps {\n  data: CharacterData;\n  onChange: (data: Partial<CharacterData>) => void;\n}\n\nconst SOULCOIN_PRICES: Record<string, number> = {\n  common: 0,\n  uncommon: 300,\n  rare: 750,\n  epic: 1500,\n  legendary: 3000,\n  mythical: 0 // Mythicals need 10 shards instead\n};\n\nexport default function ShopStep({ data, onChange }: ShopStepProps) {\n  const powers = powersData as Power[];\n  const ownedSet = new Set(data.ownedPowers);\n  const equippedSet = new Set(data.equippedPowers);\n  const [totalMythicalShards, setTotalMythicalShards] = useState(0);\n\n  // Count total mythical shards across all saves on mount\n  useEffect(() => {\n    const allSaves = getAllSaves();\n    const shards = allSaves.reduce((total, save) => {\n      return total + (save.gameState.character.mythicalShards || 0);\n    }, 0);\n    setTotalMythicalShards(shards);\n  }, []);\n  \n  // All powers available including mythicals\n  const availablePowers = (powers as any[])\n    .sort((a, b) => {\n      const rarityOrder = { common: 0, uncommon: 1, rare: 2, epic: 3, legendary: 4, mythical: 5 };\n      const aRarity = rarityOrder[a.rarity as keyof typeof rarityOrder] ?? 6;\n      const bRarity = rarityOrder[b.rarity as keyof typeof rarityOrder] ?? 6;\n      if (aRarity !== bRarity) return aRarity - bRarity;\n      return a.name.localeCompare(b.name);\n    });\n\n  const handleBuy = (power: Power) => {\n    const price = SOULCOIN_PRICES[power.rarity];\n    const isMythical = power.rarity === \"mythical\";\n    \n    if (ownedSet.has(power.id)) {\n      // Already owned, can't buy again\n      return;\n    }\n    \n    // Check if can afford\n    if (isMythical) {\n      if (totalMythicalShards < 10) return;\n    } else {\n      if (data.soulcoins < price) return;\n    }\n    \n    // Add to owned\n    onChange({\n      ownedPowers: [...data.ownedPowers, power.id],\n      soulcoins: isMythical ? data.soulcoins : (data.soulcoins - price)\n    });\n  };\n\n  const handleEquip = (power: Power) => {\n    if (!ownedSet.has(power.id)) return;\n    \n    if (equippedSet.has(power.id)) {\n      // Unequip\n      onChange({\n        equippedPowers: data.equippedPowers.filter(id => id !== power.id)\n      });\n    } else {\n      // Equip (max 5)\n      if (data.equippedPowers.length >= 5) return;\n      \n      onChange({\n        equippedPowers: [...data.equippedPowers, power.id]\n      });\n    }\n  };\n\n  const getRarityColor = (rarity: string) => {\n    const colors: Record<string, string> = {\n      common: \"bg-slate-500\",\n      uncommon: \"bg-green-600\",\n      rare: \"bg-blue-600\",\n      epic: \"bg-purple-600\",\n      legendary: \"bg-yellow-600\",\n      mythical: \"bg-red-700\"\n    };\n    return colors[rarity] || \"bg-slate-500\";\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between gap-4\">\n          <div className=\"flex-1\">\n            <CardTitle>Select Your Powers</CardTitle>\n            <CardDescription>Choose which powers to start with using your soulcoins</CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2 shrink-0\">\n            <div className=\"flex items-center gap-2 bg-purple-500/20 px-3 py-2 rounded-md\">\n              <Gem className=\"w-5 h-5 text-purple-500\" />\n              <span className=\"font-semibold text-purple-300\">{data.soulcoins} SC</span>\n            </div>\n            <div className=\"flex items-center gap-2 bg-red-500/20 px-3 py-2 rounded-md\">\n              <Zap className=\"w-5 h-5 text-red-500\" />\n              <span className=\"font-semibold text-red-300\">{totalMythicalShards} MS</span>\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <ScrollArea className=\"h-96\">\n          <div className=\"space-y-2 pr-4\">\n            {availablePowers.map(power => {\n              const price = SOULCOIN_PRICES[power.rarity];\n              const isOwned = ownedSet.has(power.id);\n              const isEquipped = equippedSet.has(power.id);\n              const isMythical = power.rarity === \"mythical\";\n              const canAfford = isMythical ? totalMythicalShards >= 10 : data.soulcoins >= price;\n              \n              return (\n                <div\n                  key={power.id}\n                  className={`p-3 border rounded-md transition-all ${\n                    isEquipped ? \"bg-primary/20 border-primary ring-1 ring-primary\" : \"bg-card border-card-border hover-elevate\"\n                  }`}\n                >\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 flex-wrap\">\n                        <h3 className=\"font-semibold text-sm\">{power.name}</h3>\n                        <Badge className={`text-xs ${getRarityColor(power.rarity)} text-white`}>\n                          {power.rarity}\n                        </Badge>\n                        {isOwned && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">Owned</Badge>\n                        )}\n                        {isEquipped && (\n                          <Badge className=\"text-xs bg-primary\">Equipped</Badge>\n                        )}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground mt-1 line-clamp-1\">\n                        {power.description}\n                      </p>\n                      {isMythical && totalMythicalShards < 10 && !isOwned && (\n                        <div className=\"flex items-center gap-1 mt-2 text-xs text-amber-400\">\n                          <AlertCircle className=\"w-3 h-3\" />\n                          <span>Need 10 mythical shards ({totalMythicalShards}/10)</span>\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"flex gap-2\">\n                      {!isOwned && (\n                        <Button\n                          size=\"sm\"\n                          onClick={() => handleBuy(power)}\n                          disabled={!canAfford}\n                          variant={canAfford ? \"outline\" : \"ghost\"}\n                          className=\"whitespace-nowrap\"\n                        >\n                          {isMythical ? (\n                            totalMythicalShards >= 10 ? \"Buy\" : \"Locked\"\n                          ) : price === 0 ? (\n                            \"Buy\"\n                          ) : (\n                            `Buy (${price})`\n                          )}\n                        </Button>\n                      )}\n                      {isOwned && (\n                        <Button\n                          size=\"sm\"\n                          onClick={() => handleEquip(power)}\n                          disabled={!isEquipped && data.equippedPowers.length >= 5}\n                          variant={isEquipped ? \"default\" : \"outline\"}\n                          className=\"whitespace-nowrap\"\n                        >\n                          {isEquipped ? \"Unequip\" : \"Equip\"}\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </ScrollArea>\n        <div className=\"space-y-2 p-3 bg-muted rounded-md\">\n          <p className=\"text-sm\">\n            <span className=\"font-semibold\">Owned:</span> {data.ownedPowers.length} | <span className=\"font-semibold\">Equipped:</span> {data.equippedPowers.length}/5\n          </p>\n          <p className=\"text-xs text-muted-foreground\">\n            ‚Ä¢ Buy a power to add it to your inventory  \n            ‚Ä¢ Equip up to 5 powers to use them in-game  \n            ‚Ä¢ Common powers are FREE  \n            ‚Ä¢ Mythical powers need 10 shards total across all your saves\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":8425},"client/src/components/game/progression-panel.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { ArrowUp, Heart, Zap, Users, Sparkles, Shield, ChevronDown, ChevronUp } from \"lucide-react\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface ProgressionPanelProps {\n  gameState: GameState;\n}\n\nexport default function ProgressionPanel({ gameState }: ProgressionPanelProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const { character } = gameState;\n  const power = character.power || 0;\n  const empathy = character.empathy || 0;\n  const corruption = character.corruption || 0;\n\n  // Progression milestones\n  const progressionPaths = [\n    {\n      title: \"Power Progression\",\n      description: \"Become stronger through combat and challenges\",\n      current: power,\n      max: 100,\n      icon: Zap,\n      color: \"text-red-500\",\n      milestones: [\n        { level: 75, reward: \"Access Rival Duels\", current: power >= 75 },\n        { level: 250, reward: \"Challenge Weak Overlords\", current: power >= 250 },\n        { level: 400, reward: \"Challenge Strong Overlords\", current: power >= 400 },\n        { level: 750, reward: \"Become an Overlord\", current: power >= 750 },\n      ],\n      tips: [\n        \"‚ú¶ Win battles against rivals and overlords\",\n        \"‚ú¶ Complete combat-focused activities\",\n        \"‚ú¶ Use power-increasing actions in events\",\n      ],\n    },\n    {\n      title: \"Redemption Path\",\n      description: \"Increase empathy and decrease corruption\",\n      current: empathy,\n      max: 100,\n      icon: Heart,\n      color: \"text-pink-500\",\n      milestones: [\n        { level: 80, reward: \"Unlock Romance Options\", current: empathy >= 80 },\n        { level: 150, reward: \"Form Genuine Bonds\", current: empathy >= 150 },\n        { level: 200, reward: \"Inspire Redemption\", current: empathy >= 200 },\n        { level: 280, reward: \"True Transformation\", current: empathy >= 280 },\n      ],\n      tips: [\n        \"‚ú¶ Help others in events\",\n        \"‚ú¶ Choose compassionate dialogue options\",\n        \"‚ú¶ Build relationships with NPCs\",\n        \"‚ú¶ Avoid sadistic/dark choices\",\n      ],\n    },\n    {\n      title: \"Dark Ascension\",\n      description: \"Embrace corruption and control\",\n      current: corruption,\n      max: 100,\n      icon: Sparkles,\n      color: \"text-purple-900\",\n      milestones: [\n        { level: 100, reward: \"Unlock Dark Powers\", current: corruption >= 100 },\n        { level: 200, reward: \"Become Feared\", current: corruption >= 200 },\n        { level: 300, reward: \"Command Respect Through Fear\", current: corruption >= 300 },\n        { level: 400, reward: \"Ultimate Corruption\", current: corruption >= 400 },\n      ],\n      tips: [\n        \"‚ú¶ Make corrupt choices in events\",\n        \"‚ú¶ Manipulate NPCs\",\n        \"‚ú¶ Use dark powers in combat\",\n        \"‚ú¶ Choose self-interested options\",\n      ],\n    },\n  ];\n\n  if (!isExpanded) {\n    return (\n      <Card>\n        <Button\n          onClick={() => setIsExpanded(true)}\n          variant=\"outline\"\n          className=\"w-full justify-between\"\n        >\n          <div className=\"flex items-center gap-2\">\n            <ArrowUp className=\"w-4 h-4\" />\n            Progression Paths\n          </div>\n          <ChevronDown className=\"w-4 h-4\" />\n        </Button>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Card className=\"border-2 border-card-border\" data-testid=\"card-progression\">\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <ArrowUp className=\"w-5 h-5 text-primary\" />\n              Progression & Strength\n            </CardTitle>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => setIsExpanded(false)}\n            >\n              <ChevronUp className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <CardDescription className=\"mt-2\">\n            Multiple paths to power - choose your fate wisely\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {progressionPaths.map((path) => {\n            const Icon = path.icon;\n            const percentage = (path.current / path.max) * 100;\n            const completedMilestones = path.milestones.filter(m => m.current).length;\n\n            return (\n              <div key={path.title} className=\"space-y-3 pb-4 border-b border-card-border last:border-b-0 last:pb-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <Icon className={`w-5 h-5 ${path.color}`} />\n                    <div>\n                      <div className=\"font-semibold\">{path.title}</div>\n                      <div className=\"text-xs text-muted-foreground\">{path.description}</div>\n                    </div>\n                  </div>\n                  <Badge variant=\"outline\">{completedMilestones}/{path.milestones.length}</Badge>\n                </div>\n\n                {/* Progress Bar */}\n                <div className=\"space-y-1\">\n                  <div className=\"flex items-center justify-between text-sm\">\n                    <span className=\"text-muted-foreground\">Current Level</span>\n                    <span className=\"font-semibold\">{Math.floor(path.current)}/{path.max}</span>\n                  </div>\n                  <Progress value={percentage} className=\"h-2\" />\n                </div>\n\n                {/* Milestones */}\n                <div className=\"space-y-2\">\n                  {path.milestones.map((milestone) => (\n                    <div\n                      key={milestone.level}\n                      className={`p-2 rounded text-xs flex items-center justify-between ${\n                        milestone.current\n                          ? \"bg-green-950/30 border border-green-700\"\n                          : \"bg-muted/30 border border-card-border\"\n                      }`}\n                    >\n                      <span className=\"flex items-center gap-2\">\n                        <span className={milestone.current ? \"text-green-400\" : \"text-muted-foreground\"}>\n                          {milestone.current ? \"‚úì\" : \"‚óã\"}\n                        </span>\n                        <span>{milestone.reward}</span>\n                      </span>\n                      <span className=\"text-muted-foreground\">Lvl {milestone.level}</span>\n                    </div>\n                  ))}\n                </div>\n\n                {/* Tips */}\n                <div className=\"bg-primary/5 rounded p-2 space-y-1\">\n                  <div className=\"text-xs font-semibold text-primary\">How to Increase:</div>\n                  {path.tips.map((tip, i) => (\n                    <div key={i} className=\"text-xs text-muted-foreground\">\n                      {tip}\n                    </div>\n                  ))}\n                </div>\n              </div>\n            );\n          })}\n\n          {/* Balance Summary */}\n          <div className=\"mt-4 p-3 bg-muted/40 rounded-lg border border-card-border\">\n            <div className=\"text-sm font-semibold mb-2\">Your Path</div>\n            <div className=\"space-y-1 text-xs text-muted-foreground\">\n              {power >= 80 ? (\n                <div className=\"text-amber-100\">‚ö° You are ready for Overlord battles</div>\n              ) : (\n                <div>‚ö° Power: {80 - power} levels until Overlord ready</div>\n              )}\n              {empathy > corruption ? (\n                <div className=\"text-pink-300\">üíñ You walk the path of Redemption</div>\n              ) : corruption > empathy ? (\n                <div className=\"text-purple-300\">üåë You embrace Darkness</div>\n              ) : (\n                <div className=\"text-gray-400\">‚öñÔ∏è You balance both light and darkness</div>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8207},"client/src/components/game/battle-panel.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Zap, Shield, Crown } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { playBattleMusic } from \"@/lib/audio\";\nimport powersData from \"@/data/powers.json\";\nimport npcsData from \"@/data/npcs.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface BattlePanelProps {\n  gameState: GameState;\n  opponent: string; // NPC ID or \"overlord\"\n  currentDistrict: string;\n  onBattleEnd: (won: boolean, rewards: any, affinityChanges?: Record<string, number>) => void;\n  companion?: string | null; // NPC ID of companion\n}\n\ninterface BattleState {\n  playerHealth: number;\n  opponentHealth: number;\n  cursedEnergy: number;\n  ultimateGauge: number;\n  companionHealth?: number;\n  companionCE?: number;\n  companionUltimate?: number;\n  turn: number;\n  battleLog: string[];\n}\n\nexport default function BattlePanel({\n  gameState,\n  opponent,\n  currentDistrict,\n  onBattleEnd,\n  companion\n}: BattlePanelProps) {\n  const { toast } = useToast();\n  \n  const powers = powersData as any[];\n  const npcs = npcsData as any[];\n  const opponentNpc = npcs.find(n => n.id === opponent);\n  \n  // Get opponent name with fallbacks\n  const getOpponentName = () => {\n    if (opponentNpc?.name) return opponentNpc.name;\n    if (opponent === \"rival-demon\") return \"Rival Demon\";\n    if (opponent === \"unknown\" || !opponent) return \"Unknown Opponent\";\n    try {\n      return opponent.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');\n    } catch {\n      return \"Opponent\";\n    }\n  };\n  \n  // Scale difficulty based on opponent type\n  const isOverlord = opponent === \"charlie\" || opponent === \"alastor\" || opponent === \"valentino\" || opponent === \"vox\" || opponent === \"carmilla\" || opponent === \"lucifer\";\n  const isRival = opponent === \"rival-demon\";\n  \n  const baseOpponentHealth = isOverlord ? 5500 : (isRival ? 120 : 100);\n  const baseOpponentDamage = isOverlord ? 45 : (isRival ? 12 : 8);\n  \n  // POWER & AGE SCALING: Higher power = more health, more CE output, more damage. Age significantly increases max health\n  const playerPowerLevel = gameState.character.power || 0;\n  const playerAge = gameState.character.age || 0;\n  // Health scales with age (+2 per age point) and power (+0.25 per power)\n  const scaledPlayerHealth = gameState.character.health + Math.floor(playerAge * 2) + Math.floor(playerPowerLevel * 0.25);\n  const ceOutputMultiplier = 1 + (playerPowerLevel * 0.02); // 2% more CE per power level\n  const playerDamageMultiplier = 1 + (playerPowerLevel * 0.03); // 3% more damage per power level\n\n  // Companion system - 50% join chance if selected\n  const companionNpc = companion ? npcs.find(n => n.id === companion) : null;\n  const companionPower = companionNpc?.basePower || 0;\n  \n  // Companion health scales like overlord (~80% of overlord health for balance)\n  // For typical NPC basePower (60-120): companionPower * 45 = 2700-5400\n  const companionBaseHealth = companion && companionPower > 0 ? Math.max(3500, Math.floor(companionPower * 45)) : 0;\n  \n  // Track if companion actually joined (50% chance, determined once)\n  const [companionJoined] = useState(() => companion ? Math.random() < 0.5 : false);\n  const damageBonus = companionJoined ? companionPower * 0.5 : 0; // 50% of companion's power as damage bonus (stronger allies)\n\n  const [battle, setBattle] = useState<BattleState>({\n    playerHealth: scaledPlayerHealth,\n    opponentHealth: baseOpponentHealth,\n    cursedEnergy: 0,\n    ultimateGauge: 0,\n    companionHealth: companionJoined ? companionBaseHealth : undefined,\n    companionCE: companionJoined ? 0 : undefined,\n    companionUltimate: companionJoined ? 0 : undefined,\n    turn: 0,\n    battleLog: [\n      `Battle started! You face ${getOpponentName()}!`,\n      companionJoined ? `${companionNpc?.name} joined the battle!` : \"\"\n    ].filter(Boolean)\n  });\n\n  // Play battle music based on opponent\n  useEffect(() => {\n    playBattleMusic(opponent);\n  }, [opponent]);\n\n  // Determine base attack (lowest rarity - most common) and ultimate (strongest)\n  const playerPowers = (gameState.character.powers || [])\n    .map(id => powers.find(p => p.id === id))\n    .filter(Boolean) as any[];\n\n  // Rarity order: common (0) < uncommon (1) < rare (2) < epic (3) < legendary (4)\n  const rarityOrder = { common: 0, uncommon: 1, rare: 2, epic: 3, legendary: 4 };\n  \n  // Find lowest rarity (most common) non-passive power for base attack\n  const nonPassivePowers = playerPowers.filter(p => !p.isPassive);\n  const baseAttackPower = nonPassivePowers.reduce((best, p) => {\n    const pRarity = rarityOrder[p.rarity as keyof typeof rarityOrder] ?? 5;\n    const bestRarity = rarityOrder[best.rarity as keyof typeof rarityOrder] ?? 5;\n    return pRarity < bestRarity ? p : best;\n  });\n\n  // Find strongest non-passive power for ultimate\n  const ultimatePower = nonPassivePowers.reduce((best, p) => {\n    return p.basePower > (best?.basePower || 0) ? p : best;\n  });\n\n  const handleBaseAttack = () => {\n    const baseDamage = baseAttackPower ? (baseAttackPower.basePower + Math.random() * 10) : 8;\n    const totalDamage = (baseDamage * playerDamageMultiplier) + damageBonus;\n    const newLog = [...battle.battleLog];\n    const damageText = companionJoined ? ` (${Math.floor(damageBonus)} from companion support)` : \"\";\n    newLog.push(`You used ${baseAttackPower?.name || \"Basic Attack\"}! Hit for ${Math.floor(totalDamage)} damage.${damageText}`);\n\n    const baseCE = Math.round(15 * ceOutputMultiplier);\n    const newCE = Math.min(100, battle.cursedEnergy + baseCE);\n    const newUltimate = Math.min(700, battle.ultimateGauge + 140);\n    const newOpponentHealth = Math.max(0, battle.opponentHealth - totalDamage);\n\n    if (newOpponentHealth <= 0) {\n      const overlordPower = isOverlord && opponentNpc?.powers?.[0] ? opponentNpc.powers[0] : null;\n      const mythicalChance = isOverlord ? 0.15 : 0; // 15% from overlords\n      const isMythical = Math.random() < mythicalChance;\n      const mythicalPowers = [\"absolution-void\", \"eternal-nightfall\", \"pact-absolute\", \"seduction-mastery\"];\n      const mythicalReward = isMythical ? mythicalPowers[Math.floor(Math.random() * mythicalPowers.length)] : null;\n      \n      const affinityChanges: Record<string, number> = {};\n      affinityChanges[opponent] = -30; // Defeating them damages affinity\n      \n      onBattleEnd(true, {\n        power: 1,\n        influence: 0,\n        wealth: 25,\n        soulcoins: 5,\n        powerReward: ultimatePower,\n        overlordPower: overlordPower,\n        isMythical: isMythical,\n        mythicalPower: mythicalReward,\n        isRivalDuel: isRival\n      }, affinityChanges);\n      return;\n    }\n\n    // Opponent attacks back\n    const opponentDamage = baseOpponentDamage + Math.random() * 12;\n    newLog.push(`${getOpponentName()} attacks! You take ${Math.floor(opponentDamage)} damage.`);\n    const newPlayerHealth = Math.max(0, battle.playerHealth - opponentDamage);\n\n    if (newPlayerHealth <= 0) {\n      const affinityChanges: Record<string, number> = {};\n      affinityChanges[opponent] = -15; // Losing to them damages affinity less\n      \n      onBattleEnd(false, {\n        power: -5,\n        health: -60,\n        wealth: -200\n      }, affinityChanges);\n      return;\n    }\n\n    // Companion AI action after player attacks\n    let companionNewHealth = battle.companionHealth;\n    let companionNewCE = battle.companionCE;\n    let companionNewUltimate = battle.companionUltimate;\n    if (companionJoined && companionNpc) {\n      const companionActions = [\"attack\", \"defend\", \"skill\"];\n      const action = companionActions[Math.floor(Math.random() * companionActions.length)];\n      \n      if (action === \"attack\") {\n        // Stronger damage: ~70-80% of base opponent damage per turn\n        const companionDamage = companionPower * 1.2 + Math.random() * 20;\n        newLog.push(`${companionNpc.name} attacks the opponent! Hit for ${Math.floor(companionDamage)} damage!`);\n        companionNewCE = Math.min(100, (companionNewCE || 0) + 18);\n        companionNewUltimate = Math.min(700, (companionNewUltimate || 0) + 120);\n      } else if (action === \"defend\") {\n        newLog.push(`${companionNpc.name} takes a defensive stance!`);\n        companionNewCE = Math.min(100, (companionNewCE || 0) + 20);\n        companionNewUltimate = Math.min(700, (companionNewUltimate || 0) + 100);\n      }\n    }\n\n    setBattle({\n      ...battle,\n      playerHealth: newPlayerHealth,\n      opponentHealth: newOpponentHealth,\n      cursedEnergy: newCE,\n      ultimateGauge: newUltimate,\n      companionHealth: companionNewHealth,\n      companionCE: companionNewCE,\n      companionUltimate: companionNewUltimate,\n      turn: battle.turn + 1,\n      battleLog: newLog\n    });\n  };\n\n  const handlePowerAttack = (power: any) => {\n    const ceCost = Math.round(power.basePower * 3);\n    if (battle.cursedEnergy < ceCost) {\n      toast({\n        title: \"Not Enough CE\",\n        description: `Need ${ceCost} cursed energy`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const baseDamage = power.basePower + Math.random() * 20;\n    const damage = baseDamage * playerDamageMultiplier;\n    const newLog = [...battle.battleLog];\n    newLog.push(`You unleashed ${power.name}! Devastating hit for ${Math.floor(damage)} damage!`);\n\n    const newCE = Math.max(0, battle.cursedEnergy - ceCost);\n    // Reduced ultimate gauge gain: only 20 per power attack (was 100+), must still take 7 turns of attacks to charge\n    const baseUltimate = 28;\n    const newUltimate = Math.min(700, battle.ultimateGauge + baseUltimate);\n    const newOpponentHealth = Math.max(0, battle.opponentHealth - damage);\n\n    if (newOpponentHealth <= 0) {\n      const overlordPower = isOverlord && opponentNpc?.powers?.[0] ? opponentNpc.powers[0] : null;\n      const mythicalChance = isOverlord ? 0.15 : 0; // 15% from overlords\n      const isMythical = Math.random() < mythicalChance;\n      const mythicalPowers = [\"absolution-void\", \"eternal-nightfall\", \"pact-absolute\", \"seduction-mastery\"];\n      const mythicalReward = isMythical ? mythicalPowers[Math.floor(Math.random() * mythicalPowers.length)] : null;\n      \n      onBattleEnd(true, {\n        power: 1,\n        influence: 1,\n        wealth: 40,\n        soulcoins: 8,\n        powerReward: ultimatePower,\n        overlordPower: overlordPower,\n        isMythical: isMythical,\n        mythicalPower: mythicalReward,\n        isRivalDuel: isRival\n      });\n      return;\n    }\n\n    // Opponent attacks - randomly target player or companion\n    let newPlayerHealth = battle.playerHealth;\n    let newCompanionHealth = battle.companionHealth;\n    \n    const targetCompanion = companionJoined && Math.random() < 0.5;\n    const opponentDamage = baseOpponentDamage + Math.random() * 12;\n    \n    if (targetCompanion && battle.companionHealth) {\n      newLog.push(`${getOpponentName()} attacks ${companionNpc?.name}! They take ${Math.floor(opponentDamage)} damage.`);\n      newCompanionHealth = Math.max(0, battle.companionHealth - opponentDamage);\n      if (newCompanionHealth <= 0) {\n        newLog.push(`${companionNpc?.name} has been defeated!`);\n      }\n    } else {\n      newLog.push(`${getOpponentName()} attacks! You take ${Math.floor(opponentDamage)} damage.`);\n      newPlayerHealth = Math.max(0, battle.playerHealth - opponentDamage);\n    }\n\n    if (newPlayerHealth <= 0) {\n      const affinityChanges: Record<string, number> = {};\n      affinityChanges[opponent] = -15;\n      \n      onBattleEnd(false, {\n        power: -5,\n        health: -60,\n        wealth: -200\n      }, affinityChanges);\n      return;\n    }\n\n    // Companion AI action after power attack\n    let companionNewHealth = newCompanionHealth;\n    let companionNewCE = battle.companionCE;\n    let companionNewUltimate = battle.companionUltimate;\n    if (companionJoined && companionNpc && companionNewHealth && companionNewHealth > 0) {\n      const companionPowers = (companionNpc.powers || [])\n        .map((id: string) => powers.find(p => p.id === id))\n        .filter(Boolean) as any[];\n      \n      const companionActions = companionPowers.length > 0 ? [\"attack\", \"defend\"] : [\"defend\"];\n      const action = companionActions[Math.floor(Math.random() * companionActions.length)];\n      \n      if (action === \"attack\" && companionPowers.length > 0) {\n        const companionPower = companionPowers[Math.floor(Math.random() * companionPowers.length)];\n        newLog.push(`${companionNpc.name} uses ${companionPower.name}! Devastating hit on the opponent!`);\n        companionNewCE = Math.min(100, (companionNewCE || 0) + 18);\n        companionNewUltimate = Math.min(700, (companionNewUltimate || 0) + 120);\n      } else if (action === \"defend\") {\n        newLog.push(`${companionNpc.name} takes a defensive stance!`);\n        companionNewCE = Math.min(100, (companionNewCE || 0) + 20);\n        companionNewUltimate = Math.min(700, (companionNewUltimate || 0) + 100);\n      }\n    }\n\n    setBattle({\n      ...battle,\n      playerHealth: newPlayerHealth,\n      opponentHealth: newOpponentHealth,\n      cursedEnergy: newCE,\n      ultimateGauge: newUltimate,\n      companionHealth: companionNewHealth,\n      companionCE: companionNewCE,\n      companionUltimate: companionNewUltimate,\n      turn: battle.turn + 1,\n      battleLog: newLog\n    });\n  };\n\n  const handleDefend = () => {\n    const newLog = [...battle.battleLog];\n    newLog.push(\"You take a defensive stance!\");\n\n    const baseCE = Math.round(15 * ceOutputMultiplier);\n    const newCE = Math.min(100, battle.cursedEnergy + baseCE);\n\n    // Opponent attacks while you defend (50% damage reduction) - can target companion\n    let newPlayerHealth = battle.playerHealth;\n    let newCompanionHealth = battle.companionHealth;\n    \n    const targetCompanion = companionJoined && Math.random() < 0.5;\n    const opponentDamage = (baseOpponentDamage + Math.random() * 12) * 0.5;\n    \n    if (targetCompanion && battle.companionHealth) {\n      newLog.push(`${getOpponentName()} attacks ${companionNpc?.name}! Reduced damage to ${Math.floor(opponentDamage)}!`);\n      newCompanionHealth = Math.max(0, battle.companionHealth - opponentDamage);\n      if (newCompanionHealth <= 0) {\n        newLog.push(`${companionNpc?.name} has been defeated!`);\n      }\n    } else {\n      newLog.push(`${getOpponentName()} attacks! You defend, reducing damage to ${Math.floor(opponentDamage)}!`);\n      newPlayerHealth = Math.max(0, battle.playerHealth - opponentDamage);\n    }\n\n    if (newPlayerHealth <= 0) {\n      const affinityChanges: Record<string, number> = {};\n      affinityChanges[opponent] = -15;\n      \n      onBattleEnd(false, {\n        power: -5,\n        health: -60,\n        wealth: -200\n      }, affinityChanges);\n      return;\n    }\n\n    // Companion AI action\n    let companionNewHealth = newCompanionHealth;\n    let companionNewCE = battle.companionCE;\n    let companionNewUltimate = battle.companionUltimate;\n    if (companionJoined && companionNpc && companionNewHealth && companionNewHealth > 0) {\n      const companionPowers = (companionNpc.powers || [])\n        .map((id: string) => powers.find(p => p.id === id))\n        .filter(Boolean) as any[];\n      \n      const companionActions = companionPowers.length > 0 ? [\"attack\", \"defend\"] : [\"defend\"];\n      const action = companionActions[Math.floor(Math.random() * companionActions.length)];\n      \n      if (action === \"attack\" && companionPowers.length > 0) {\n        const companionPower = companionPowers[Math.floor(Math.random() * companionPowers.length)];\n        newLog.push(`${companionNpc.name} uses ${companionPower.name}! Devastating hit on the opponent!`);\n        companionNewCE = Math.min(100, (companionNewCE || 0) + 18);\n        companionNewUltimate = Math.min(700, (companionNewUltimate || 0) + 120);\n      } else if (action === \"defend\") {\n        newLog.push(`${companionNpc.name} takes a defensive stance!`);\n        companionNewCE = Math.min(100, (companionNewCE || 0) + 20);\n        companionNewUltimate = Math.min(700, (companionNewUltimate || 0) + 100);\n      }\n    }\n\n    setBattle({\n      ...battle,\n      playerHealth: newPlayerHealth,\n      cursedEnergy: newCE,\n      ultimateGauge: Math.min(700, battle.ultimateGauge + 70),\n      companionHealth: companionNewHealth,\n      companionCE: companionNewCE,\n      companionUltimate: companionNewUltimate,\n      turn: battle.turn + 1,\n      battleLog: newLog\n    });\n  };\n\n  const handleUltimate = () => {\n    if (battle.ultimateGauge < 700) {\n      toast({\n        title: \"Ultimate Not Ready\",\n        description: `Ultimate ready in ${Math.ceil((700 - battle.ultimateGauge) / 100)} turns`,\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const baseDamage = (ultimatePower?.basePower || 30) * 2.5;\n    const totalUltimateDamage = (baseDamage + Math.random() * 30) * playerDamageMultiplier + damageBonus;\n    const newLog = [...battle.battleLog];\n    const ultimateDamageText = companionJoined ? ` (${Math.floor(damageBonus)} from companion)` : \"\";\n    newLog.push(`${ultimatePower ? \"ULTIMATE: \" + ultimatePower.name : \"ULTIMATE TECHNIQUE\"}! Catastrophic damage: ${Math.floor(totalUltimateDamage)}!${ultimateDamageText}`);\n\n    const newOpponentHealth = Math.max(0, battle.opponentHealth - totalUltimateDamage);\n\n    if (newOpponentHealth <= 0) {\n      const powerReward = Math.round(8 * (1 + playerPowerLevel * 0.05));\n      const overlordPower = isOverlord && opponentNpc?.powers?.[0] ? opponentNpc.powers[0] : null;\n      const mythicalChance = isOverlord ? 0.15 : 0; // 15% from overlords\n      const isMythical = Math.random() < mythicalChance;\n      const mythicalPowers = [\"absolution-void\", \"eternal-nightfall\", \"pact-absolute\", \"seduction-mastery\"];\n      const mythicalReward = isMythical ? mythicalPowers[Math.floor(Math.random() * mythicalPowers.length)] : null;\n      \n      // Soulcoin rewards: small chance for overlords\n      const soulcoinChance = isOverlord ? 0.15 : 0; // 15% chance for overlord fights\n      const soulcoinReward = Math.random() < soulcoinChance ? Math.floor(Math.random() * 5) + 1 : 0;\n      \n      onBattleEnd(true, {\n        power: Math.round(powerReward * 0.5),\n        influence: 2,\n        wealth: 100,\n        soulcoins: soulcoinReward,\n        powerReward: ultimatePower,\n        overlordPower: overlordPower,\n        isMythical: isMythical,\n        mythicalPower: mythicalReward,\n        isRivalDuel: isRival\n      });\n      return;\n    }\n\n    setBattle({\n      ...battle,\n      opponentHealth: newOpponentHealth,\n      ultimateGauge: 0,\n      turn: battle.turn + 1,\n      battleLog: newLog\n    });\n  };\n\n  const availablePowers = playerPowers.filter(p => !p.isPassive && p.id !== baseAttackPower?.id);\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-4xl bg-card border-2 border-primary rounded-lg overflow-hidden\">\n        {/* Header */}\n        <CardHeader className=\"bg-gradient-to-r from-destructive to-orange-600 text-white\">\n          <CardTitle className=\"flex items-center justify-between\">\n            <span className=\"flex items-center gap-2\">\n              <Zap className=\"w-5 h-5\" />\n              BATTLE vs {getOpponentName()}\n            </span>\n            <span className=\"text-sm font-normal\">Turn {battle.turn}</span>\n          </CardTitle>\n        </CardHeader>\n\n        <CardContent className=\"p-6 space-y-6\">\n          {/* Health Bars */}\n          <div className=\"grid grid-cols-2 gap-6\">\n            <div>\n              <div className=\"text-sm font-semibold mb-2\">Your Health</div>\n              <Progress value={(battle.playerHealth / gameState.character.health) * 100} className=\"h-4\" />\n              <div className=\"text-xs text-muted-foreground mt-1\">\n                {Math.floor(battle.playerHealth)} / {gameState.character.health}\n              </div>\n            </div>\n            <div>\n              <div className=\"text-sm font-semibold mb-2\">{getOpponentName()}</div>\n              <Progress value={(battle.opponentHealth / baseOpponentHealth) * 100} className=\"h-4 bg-red-900\" />\n              <div className=\"text-xs text-muted-foreground mt-1\">\n                {Math.floor(battle.opponentHealth)} / {baseOpponentHealth}\n              </div>\n            </div>\n          </div>\n\n          {/* Resource Bars */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <Badge className=\"mb-2 bg-blue-600\">Cursed Energy: {Math.floor(battle.cursedEnergy)}/100</Badge>\n              <Progress value={battle.cursedEnergy} className=\"h-2\" />\n            </div>\n            <div>\n              <Badge className=\"mb-2 bg-amber-600\">Ultimate Gauge: {Math.floor(battle.ultimateGauge)}/700</Badge>\n              <Progress value={(battle.ultimateGauge / 700) * 100} className=\"h-2\" />\n            </div>\n          </div>\n\n          {/* Companion Health & Resources */}\n          {companionJoined && (\n            <div className=\"bg-blue-900/20 border border-blue-700 rounded-lg p-3 space-y-2\">\n              <div className=\"text-sm font-semibold text-blue-100\">{companionNpc?.name} - Ally</div>\n              <div className=\"grid grid-cols-3 gap-2 text-xs\">\n                <div>\n                  <div className=\"text-blue-200 mb-1\">Health</div>\n                  <Progress value={(battle.companionHealth || 0) / (companionBaseHealth || 1) * 100} className=\"h-2\" />\n                  <div className=\"text-blue-300 mt-1\">{Math.floor(battle.companionHealth || 0)} / {Math.floor(companionBaseHealth)}</div>\n                </div>\n                <div>\n                  <div className=\"text-blue-200 mb-1\">CE</div>\n                  <Progress value={battle.companionCE || 0} className=\"h-2\" />\n                  <div className=\"text-blue-300 mt-1\">{Math.floor(battle.companionCE || 0)}/100</div>\n                </div>\n                <div>\n                  <div className=\"text-blue-200 mb-1\">Ultimate</div>\n                  <Progress value={((battle.companionUltimate || 0) / 700) * 100} className=\"h-2\" />\n                  <div className=\"text-blue-300 mt-1\">{Math.floor(battle.companionUltimate || 0)}/700</div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Opponent Skills */}\n          {opponentNpc?.powers && (\n            <div className=\"bg-black/20 rounded-lg p-3 space-y-2\">\n              <div className=\"text-sm font-semibold text-amber-100\">Enemy Skills</div>\n              <div className=\"flex flex-wrap gap-1\">\n                {(opponentNpc.powers as string[]).map(powerId => {\n                  const power = powers.find(p => p.id === powerId);\n                  return power ? (\n                    <Badge key={powerId} variant=\"outline\" className=\"text-xs bg-red-950/50 border-red-700\">\n                      {power.name}\n                    </Badge>\n                  ) : null;\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Battle Log */}\n          <div className=\"bg-black/20 rounded-lg p-4 h-32 overflow-y-auto text-sm space-y-1\">\n            {battle.battleLog.map((log, i) => (\n              <div key={i} className=\"text-amber-100\">{log}</div>\n            ))}\n          </div>\n\n          {/* Actions */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n            <Button\n              onClick={handleBaseAttack}\n              className=\"bg-blue-600 hover:bg-blue-700\"\n              data-testid=\"button-attack-base\"\n            >\n              <Zap className=\"w-4 h-4 mr-2\" />\n              {baseAttackPower?.name || \"Basic Attack\"}\n            </Button>\n\n            <Button\n              onClick={handleUltimate}\n              disabled={battle.ultimateGauge < 700}\n              className=\"bg-amber-600 hover:bg-amber-700 disabled:opacity-50\"\n              data-testid=\"button-attack-ultimate\"\n            >\n              <Crown className=\"w-4 h-4 mr-2\" />\n              Ultimate ({Math.ceil((700 - battle.ultimateGauge) / 100)})\n            </Button>\n\n            <Button \n              onClick={handleDefend}\n              variant=\"outline\"\n              className=\"bg-green-600/20 hover:bg-green-600/40\"\n              data-testid=\"button-defend\"\n            >\n              <Shield className=\"w-4 h-4 mr-2\" />\n              Defend (50% dmg)\n            </Button>\n          </div>\n\n          {/* Available Powers */}\n          {availablePowers.length > 0 && (\n            <div className=\"space-y-2\">\n              <div className=\"text-sm font-semibold\">Available Powers (Cost: CE √ó 3)</div>\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\n                {availablePowers.map(power => (\n                  <Button\n                    key={power.id}\n                    onClick={() => handlePowerAttack(power)}\n                    disabled={battle.cursedEnergy < power.basePower * 3}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"text-xs\"\n                    data-testid={`button-power-${power.id}`}\n                  >\n                    <Zap className=\"w-3 h-3 mr-1\" />\n                    {power.name}\n                  </Button>\n                ))}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </div>\n    </div>\n  );\n}\n","size_bytes":25559},"client/src/components/splash-screen.tsx":{"content":"import { useEffect, useState } from \"react\";\n\ninterface SplashScreenProps {\n  onComplete: () => void;\n}\n\nexport default function SplashScreen({ onComplete }: SplashScreenProps) {\n  const [phase, setPhase] = useState<\"intro\" | \"title\" | \"pentagram\" | \"fade\">(\"intro\");\n  const [fadeOut, setFadeOut] = useState(false);\n\n  useEffect(() => {\n    // Phase timeline\n    const timings = {\n      intro: 800,\n      title: 2000,\n      pentagram: 1500,\n      fade: 1500\n    };\n\n    const timer1 = setTimeout(() => setPhase(\"title\"), timings.intro);\n    const timer2 = setTimeout(() => setPhase(\"pentagram\"), timings.intro + timings.title);\n    const timer3 = setTimeout(() => setPhase(\"fade\"), timings.intro + timings.title + timings.pentagram);\n    const timer4 = setTimeout(() => {\n      setFadeOut(true);\n      setTimeout(() => onComplete(), 1000);\n    }, timings.intro + timings.title + timings.pentagram + timings.fade);\n\n    return () => {\n      clearTimeout(timer1);\n      clearTimeout(timer2);\n      clearTimeout(timer3);\n      clearTimeout(timer4);\n    };\n  }, [onComplete]);\n\n  return (\n    <div\n      className={`fixed inset-0 bg-black flex flex-col items-center justify-center overflow-hidden transition-opacity duration-1000 z-50 ${\n        fadeOut ? \"opacity-0\" : \"opacity-100\"\n      }`}\n    >\n      {/* Background animated gradient */}\n      <div className=\"absolute inset-0 bg-gradient-to-b from-red-950/40 via-black to-black opacity-80\"></div>\n\n      {/* Animated background particles */}\n      <div className=\"absolute inset-0 overflow-hidden\">\n        {[...Array(20)].map((_, i) => (\n          <div\n            key={i}\n            className=\"absolute w-1 h-1 bg-red-600 rounded-full opacity-0\"\n            style={{\n              left: `${Math.random() * 100}%`,\n              top: `${Math.random() * 100}%`,\n              animation: `float ${3 + Math.random() * 4}s ease-in-out infinite`,\n              animationDelay: `${Math.random() * 2}s`\n            }}\n          ></div>\n        ))}\n      </div>\n\n      {/* Main content */}\n      <div className=\"relative z-10 flex flex-col items-center justify-center gap-8\">\n        {/* Intro Text - appears and fades */}\n        {(phase === \"intro\" || phase === \"title\" || phase === \"pentagram\" || phase === \"fade\") && (\n          <div\n            className={`text-center space-y-4 transition-all duration-1000 ${\n              phase === \"intro\" ? \"opacity-100 scale-100\" : \"opacity-0 scale-95\"\n            }`}\n          >\n            <p className=\"text-red-500 text-lg font-display tracking-widest animate-pulse\">\n              WELCOME TO HELL\n            </p>\n          </div>\n        )}\n\n        {/* Title - slides in and grows */}\n        {(phase === \"title\" || phase === \"pentagram\" || phase === \"fade\") && (\n          <div\n            className={`transition-all duration-1500 ${\n              phase === \"title\"\n                ? \"opacity-100 scale-100\"\n                : phase === \"pentagram\" || phase === \"fade\"\n                ? \"opacity-100 scale-100\"\n                : \"opacity-0 scale-50\"\n            }`}\n          >\n            <h1 className=\"font-display text-7xl md:text-8xl font-black text-primary text-center tracking-tighter drop-shadow-2xl\">\n              HAZBIN\n            </h1>\n            <h2 className=\"font-display text-5xl md:text-6xl font-black text-accent text-center tracking-tight drop-shadow-lg\">\n              LIFE CYCLE\n            </h2>\n          </div>\n        )}\n\n        {/* Pentagram animation */}\n        {(phase === \"pentagram\" || phase === \"fade\") && (\n          <div\n            className={`relative w-48 h-48 flex items-center justify-center transition-all duration-1000 ${\n              phase === \"pentagram\"\n                ? \"opacity-100 scale-100 rotate-0\"\n                : phase === \"fade\"\n                ? \"opacity-50 scale-110 rotate-45\"\n                : \"opacity-0 scale-50\"\n            }`}\n          >\n            {/* Pentagram star */}\n            <div className=\"absolute text-6xl text-accent animate-pulse\">‚ú¶</div>\n            \n            {/* Rotating circles */}\n            <div className=\"absolute inset-0 border-2 border-red-600/30 rounded-full animate-spin\" style={{ animationDuration: \"8s\" }}></div>\n            <div className=\"absolute inset-4 border-2 border-accent/30 rounded-full\" style={{ animation: \"spin 12s linear reverse infinite\" }}></div>\n            <div className=\"absolute inset-8 border-2 border-red-500/20 rounded-full animate-spin\" style={{ animationDuration: \"16s\" }}></div>\n          </div>\n        )}\n\n        {/* Tagline - fades in at end */}\n        {(phase === \"fade\" || phase === \"pentagram\") && (\n          <div\n            className={`text-center space-y-2 transition-all duration-1000 ${\n              phase === \"fade\" ? \"opacity-100\" : \"opacity-0\"\n            }`}\n          >\n            <p className=\"text-gold text-xl font-display tracking-widest\">\n              RISE FROM SINNER TO OVERLORD\n            </p>\n            <p className=\"text-muted-foreground text-sm\">\n              Your legend begins...\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Bottom loading bar */}\n      <div className=\"absolute bottom-12 w-64 h-1 bg-card rounded-full overflow-hidden\">\n        <div\n          className=\"h-full bg-gradient-to-r from-red-600 via-accent to-red-600 rounded-full\"\n          style={{\n            animation: `progress 4s ease-in-out forwards`\n          }}\n        ></div>\n      </div>\n\n      {/* CSS animations */}\n      <style>{`\n        @keyframes float {\n          0%, 100% { transform: translateY(0px); opacity: 0; }\n          50% { transform: translateY(-30px); opacity: 0.8; }\n        }\n        @keyframes progress {\n          0% { width: 0%; }\n          100% { width: 100%; }\n        }\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      `}</style>\n    </div>\n  );\n}\n","size_bytes":5922},"replit.md":{"content":"# Hazbin Hotel BitLife Simulation Game\n\n## Project Overview\nA comprehensive BitLife-style life simulation game set in the Hazbin Hotel universe featuring character creation with 5 origin paths, 8 core stats, 127 powers across 15 power types with rarity tiers (common‚Üílegendary), 60+ traits, Pentagram City exploration across 7 districts, territory control mechanics, NPC relationships with romance options, faction reputation systems, power ranking progression, multiple endings, integrated soundtrack, and AI-generated dynamic scenarios.\n\n## Latest Updates\n\n### Power Shop Separation & Economy Rebalance (CURRENT)\n- **Separated Shop Systems**: Character creation and in-game shops now completely independent\n  - Character creation soulcoin shop (for starting powers)\n  - In-game wealth shop (for mid-run power purchases)\n  - Only mythical shard shop connects between them (10 shards = permanent mythical power unlock)\n- **Drastically Increased Costs**:\n  - **Soulcoins (character creation)**: 0, 300, 750, 1500, 3000 (was 0, 100, 250, 500, 1000)\n  - **Wealth (in-game)**: 200, 1500, 4500, 10000, 20000 (was 50, 500, 1500, 3500, 7500)\n- **CE Ultimate Bug Fixed**: \n  - Power attacks now only add 20 gauge/turn (was 100+, causing instant charge)\n  - Still requires 7 turns to fully charge ultimate (700 total)\n  - Maintains intended battle pacing and player progression feel\n- **Design Philosophy**: Powers are now extremely precious - requires extensive grind to acquire anything beyond commons\n\n### Extreme Difficulty & Grind Tuning (V0.1)\n- **Version Indicator**: Glowing \"V0.1\" display in top right corner with pulse animation\n- **Overlord Buffing**: 3500 health, 40 damage (significantly harder than before)\n- **Battle Rewards Halved**: \n  - Regular win: Power 1, Influence 0, Wealth 25, Soulcoins 5\n  - Rival win: Power 1, Influence 1, Wealth 40, Soulcoins 8\n  - Overlord win: Power (50% of base), Influence 2, Wealth 100, Soulcoins variable\n- **Level-up Nerfs**: \n  - Health: 5‚Üí2 per level\n  - Stat gains: 2 guaranteed‚Üí0-1 random stats (30% chance)\n- **Action Stat Gains Reduced 50%**:\n  - Train Power: 2‚Üí1 base gain (continues diminishing)\n  - Socialize: 1‚Üí0.5 influence\n  - Perform: 1‚Üí0.5 influence/empathy (wealth 40‚Üí20)\n  - Scheme: 1‚Üí0.5 influence, corruption 5‚Üí3, soulcoins 1-3‚Üí1-2\n- **Progression Milestones 50%+ Harder**:\n  - Power: 50‚Üí75, 150‚Üí250, 250‚Üí400, 500‚Üí750\n  - Empathy: 50‚Üí80, 80‚Üí150, 120‚Üí200, 150‚Üí280\n  - Corruption: 60‚Üí100, 120‚Üí200, 180‚Üí300, 250‚Üí400\n- **Design Philosophy**: Game now significantly grindier - rewards minimal stat progression to encourage extended play sessions\n\n### Age-Based Health Scaling (COMPLETED)\n- **Out-of-Battle Health**: Capped at 100 (with passive +5 health/turn regen)\n- **In-Battle Health**: Scales dramatically with age (+2 per age point)\n- **Battle Formula**: Base Health + (Age √ó 2) + (Power √ó 0.25)\n- **Example Progression**:\n  - Age 50: +100 bonus health in battle\n  - Age 100: +200 bonus health in battle\n  - Age 114: +228 bonus health in battle (aligns with user's example of ~300 total)\n- **UI**: Stats panel shows both overworld health and battle health alongside each other\n- **Design**: Encourages long-term play as characters become exponentially more durable with age\n\n### Rest Action & Health Regeneration (COMPLETED)\n- **Passive Recovery**: +5 health per turn automatically\n- **Rest Action**: Immediate +30 health recovery with no cooldown\n- **Leveling Bonuses**: Every 5 age = 1 level, grants +2 health + 0-1 random stat gains (30% chance)\n\n### Power Shop System (COMPLETED)\n- **Shop Panel**: Integrated shopping UI in left column below progression panel\n- **Power Pricing**: \n  - Common powers (free at start)\n  - Uncommon: 500 wealth\n  - Rare: 1500 wealth\n  - Epic: 3500 wealth\n  - Legendary: 7500 wealth\n- **Initial Setup**: Players start with 1000 wealth and only common powers, must purchase higher rarities\n- **Currency Usage**: Wealth now has critical gameplay purpose - progression requires purchasing powers\n\n### Overlord Power Rewards (COMPLETED)\n- Defeating overlords rewards one of their signature powers\n- Win conditions now check if opponent is overlord and add their power to character\n- Works for all overlord types: Charlie, Alastor, Valentino, Vox, Carmilla, Lucifer\n\n### Extended Power Set (COMPLETED)\n- **Total Powers**: 127 powers (up from 97)\n- **New Powers Added** (15):\n  - Shadow Strike (common)\n  - Soul Drain (uncommon)\n  - Mind Shatter (uncommon)\n  - Chaos Pulse (rare)\n  - Blood Spiral (rare)\n  - Void Touch (epic)\n  - Redemption Light (uncommon)\n  - Shadow Clones (rare)\n  - Infernal Contract (rare)\n  - Celestial Ascension (epic)\n  - Summoned Legion (rare)\n  - Reality Distortion (legendary)\n  - Demon Form (rare)\n  - Eternal Vow (epic)\n  - Sonic Scream (uncommon)\n\n### Battle System\n- Base Attack: Lowest rarity non-passive power for scaling\n- Ultimate Attack: Highest rarity power for maximum damage (2.5x)\n- Cursed Energy: 15 per turn max, powers cost 3√ó their base cost\n- Ultimate Gauge: Builds over 7 turns at 100 points/turn, unleash for 2.5x damage burst\n- Damage Scaling: 3% more per power level stat\n- Health Scaling: +0.25 per power level + **+2 per age point** (significant durability scaling)\n\n### Dynamic Audio System (COMPLETED)\n- **Background Music Rotation**: Alternates between \"Stayed Gone\" and \"Hear My Hope\" for variety\n- **Overlord Battle Themes** (unique themes for each overlord):\n  - Alastor: Insane\n  - Vox & Valentino: Vox Dei\n  - Rosie: Don't You Forget\n  - Carmilla: Out For Love\n  - Charlie & Lucifer: Ready For This\n- **Audio System**: Located in `client/src/lib/audio.ts` with playBattleMusic function for opponent-specific themes\n\n## Architecture\n- **Frontend**: React + TypeScript with Wouter routing\n- **Backend**: Express.js with TanStack Query\n- **Storage**: In-memory storage with browser persistence\n- **UI Framework**: Shadcn + Tailwind CSS\n- **Audio**: Integrated soundtrack system\n- **Data**: Powers, NPCs, Traits in JSON format\n\n## Key Game Features\n\n### Character Creation (5 Origins)\n1. Hellborn - native demon\n2. Corrupted - redeemed soul gone dark\n3. Fallen Angel - cast out from heaven\n4. Contract Dealer - soul trader\n5. Pit Fighter - rises from the arenas\n\n### Stats (8 Core)\n- Power: Combat & magical ability\n- Control: Emotional regulation & ability control\n- Influence: Social manipulation & leadership\n- Corruption: Alignment to demonic corruption\n- Empathy: Connection to others\n- Charisma: Charm & persuasion\n- Health: Physical/mental resilience\n- Wealth: Financial resources\n\n### Power Types (15)\n1. Hellfire\n2. Blood Magic\n3. Shadow\n4. Illusion\n5. Necromancy\n6. Teleportation\n7. Glamour\n8. Summoning\n9. Voice Broadcast\n10. Deals\n11. Holy\n12. Transformation\n13. Bond\n14. Reality\n15. Void/Chaos\n\n### Districts (7)\n1. Pride Ring - downtown center\n2. Wrath Arena - combat district\n3. Lust Pavilion - entertainment\n4. Gluttony Market - trade hub\n5. Envy Tower - corporate\n6. Greed Casino - wealth district\n7. Sloth Gardens - rest/recovery\n\n## Current Game State\n- ‚úÖ Character creation with full customization\n- ‚úÖ Core stats system with progression\n- ‚úÖ 127 power system with rarities and requirements\n- ‚úÖ Battle system with cursed energy mechanics\n- ‚úÖ Shop system with wealth-based purchases\n- ‚úÖ Overlord power rewards\n- ‚úÖ Extreme difficulty tuning & grind mechanics\n- ‚úÖ Version indicator display\n- ‚è≥ NPC relationships and romance\n- ‚è≥ Faction reputation system\n- ‚è≥ Territory control mechanics\n- ‚è≥ Multiple endings system\n- ‚è≥ AI-generated scenario system\n\n## Code Organization\n```\nclient/src/\n‚îú‚îÄ‚îÄ pages/\n‚îÇ   ‚îú‚îÄ‚îÄ game.tsx (main game loop)\n‚îÇ   ‚îú‚îÄ‚îÄ character-creation.tsx (character setup)\n‚îú‚îÄ‚îÄ components/\n‚îÇ   ‚îú‚îÄ‚îÄ game/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ battle-panel.tsx (combat system)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shop-panel.tsx (power shop)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stats-panel.tsx (character stats)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ powers-panel.tsx (learned powers)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ progression-panel.tsx (milestones)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ event-card.tsx (scenarios)\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (other UI components)\n‚îú‚îÄ‚îÄ data/\n‚îÇ   ‚îú‚îÄ‚îÄ powers.json (all 127 powers)\n‚îÇ   ‚îú‚îÄ‚îÄ npcs.json (all characters)\n‚îÇ   ‚îî‚îÄ‚îÄ ai-scenarios.ts (217+ story outcomes)\n‚îî‚îÄ‚îÄ lib/\n    ‚îú‚îÄ‚îÄ game-state.ts (save/load system)\n    ‚îî‚îÄ‚îÄ audio.ts (soundtrack management)\n```\n\n## Dev Guidelines\n- Follow fullstack_js conventions\n- Minimize files - collapse similar components\n- Keep backend thin - push logic to frontend\n- Always define types in shared/schema.ts first\n- Use in-memory storage unless specified otherwise\n- Validate with Zod schemas before API calls\n","size_bytes":8708},"client/src/components/game/companion-selector.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Users, X } from \"lucide-react\";\nimport npcsData from \"@/data/npcs.json\";\nimport type { GameState } from \"@/lib/game-state\";\nimport { getRelationshipStatus } from \"@/lib/relationshipSystem\";\n\ninterface CompanionSelectorProps {\n  gameState: GameState;\n  onSelectCompanion: (npcId: string | null) => void;\n  onContinue: () => void;\n}\n\nexport default function CompanionSelector({\n  gameState,\n  onSelectCompanion,\n  onContinue\n}: CompanionSelectorProps) {\n  const npcs = npcsData as any[];\n  \n  // Find NPCs with high affinity (50+)\n  const potentialCompanions = npcs.filter(npc => {\n    const rel = gameState.relationships[npc.id];\n    return rel && rel.affinity >= 50;\n  });\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\n      <Card className=\"border-2 border-primary w-full max-w-2xl\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2 text-2xl\">\n              <Users className=\"w-6 h-6\" />\n              Request Battle Companion\n            </CardTitle>\n            <span className=\"text-sm text-muted-foreground\">\n              {potentialCompanions.length} Available\n            </span>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <p className=\"text-sm text-muted-foreground\">\n            You can request an ally to join your battle. They have a 50% chance of accepting.\n            Only allies with 50+ affinity will join you.\n          </p>\n\n          {potentialCompanions.length === 0 ? (\n            <div className=\"p-8 text-center text-muted-foreground\">\n              <p>No allies with sufficient affinity to help you yet.</p>\n              <p className=\"text-xs mt-2\">Build relationships to gain companions (50+ affinity required)</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-96 overflow-y-auto\">\n              {potentialCompanions.map(npc => {\n                const rel = gameState.relationships[npc.id];\n                const joinChance = 50;\n                \n                return (\n                  <button\n                    key={npc.id}\n                    onClick={() => onSelectCompanion(npc.id)}\n                    className=\"p-3 rounded border border-primary/50 hover:bg-primary/10 transition-colors text-left\"\n                    data-testid={`button-select-companion-${npc.id}`}\n                  >\n                    <div className=\"flex items-start justify-between gap-2 mb-1\">\n                      <div className=\"font-semibold text-sm\">{npc.name}</div>\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        {joinChance}% chance\n                      </Badge>\n                    </div>\n                    <div className=\"text-xs text-muted-foreground mb-2\">\n                      {getRelationshipStatus(rel.affinity)} ‚Ä¢ {rel.affinity} Affinity\n                    </div>\n                    <div className=\"text-xs\">\n                      <span className=\"font-semibold\">Power:</span> {npc.basePower}\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n          )}\n\n          <div className=\"flex gap-2 pt-4\">\n            <Button\n              onClick={() => onSelectCompanion(null)}\n              className=\"flex-1\"\n              data-testid=\"button-battle-solo\"\n            >\n              Battle Alone\n            </Button>\n            <Button\n              onClick={onContinue}\n              variant=\"outline\"\n              className=\"flex-1\"\n              data-testid=\"button-companion-cancel\"\n            >\n              Cancel\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":4009},"client/src/lib/rivalSystem.ts":{"content":"import type { GameState } from \"./game-state\";\nimport { getNpcData, getRelationshipStatus } from \"./relationshipSystem\";\nimport npcsData from \"@/data/npcs.json\";\n\nexport interface RivalChallenge {\n  npcId: string;\n  territory?: string;\n  reason: string;\n}\n\n/**\n * Generate rival challenges based on current affinity state\n */\nexport function generateRivalChallenge(gameState: GameState): RivalChallenge | null {\n  const npcs = npcsData as any[];\n  \n  // Find NPCs who are rivals (affinity < -30)\n  const rivals = npcs.filter(npc => {\n    const rel = gameState.relationships[npc.id];\n    return rel && rel.affinity < -30;\n  });\n\n  if (rivals.length === 0) return null;\n\n  // Pick a random rival to challenge\n  const rival = rivals[Math.floor(Math.random() * rivals.length)];\n  \n  // Generate reason based on affinity level\n  const rel = gameState.relationships[rival.id];\n  let reason = \"A confrontation is unavoidable.\";\n  \n  if (rel.affinity < -75) {\n    reason = `${rival.name} appears, fury burning in their eyes: \"You've gone too far!\"`;\n  } else if (rel.affinity < -50) {\n    reason = `${rival.name} blocks your path: \"We need to settle this. NOW.\"`;\n  } else {\n    reason = `${rival.name} confronts you: \"I'm done with your games.\"`;\n  }\n\n  return {\n    npcId: rival.id,\n    reason\n  };\n}\n\n/**\n * Check if player activities should affect affinity (e.g., seizing territory in overlord's domain)\n */\nexport function calculateActivityAffinityPenalty(\n  npcId: string,\n  activity: 'seize' | 'gamble' | 'socialize' | 'train',\n  inTheirTerritory: boolean,\n  gameState: GameState\n): number {\n  if (!inTheirTerritory) return 0;\n\n  const npc = getNpcData(npcId);\n  if (!npc) return 0;\n\n  // Seizing territory in overlord's domain is a direct insult\n  if (activity === 'seize') {\n    return -25; // Major affinity hit\n  }\n\n  // Gambling in their territory without permission\n  if (activity === 'gamble') {\n    return -8;\n  }\n\n  // Other activities in their territory\n  return 0;\n}\n\n/**\n * Get overlord territory (simplified - in real game could be more complex)\n */\nexport function getOverlordTerritory(npcId: string): string | null {\n  const territoriesMap: Record<string, string> = {\n    'alastor': 'pride-ring',\n    'vox': 'envy-tower',\n    'valentino': 'lust-pavilion',\n    'carmilla': 'greed-casino',\n    'rosie': 'gluttony-market',\n    'charlie': 'pride-ring'\n  };\n  \n  return territoriesMap[npcId] || null;\n}\n\n/**\n * Check if player is in overlord's territory\n */\nexport function isInNpcTerritory(npcId: string, currentTerritory: string): boolean {\n  const territory = getOverlordTerritory(npcId);\n  return territory === currentTerritory;\n}\n","size_bytes":2644},"client/src/components/game/npc-battle.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Zap, Shield } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport npcsData from \"@/data/npcs.json\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface NPCBattleProps {\n  npcId: string;\n  gameState: GameState;\n  onBattleEnd: (won: boolean, affinityChange: number, rewards: any) => void;\n}\n\ninterface BattleState {\n  playerHealth: number;\n  npcHealth: number;\n  turn: number;\n  battleLog: string[];\n  isPlayerTurn: boolean;\n}\n\nexport default function NPCBattle({ npcId, gameState, onBattleEnd }: NPCBattleProps) {\n  const { toast } = useToast();\n  const npcs = npcsData as any[];\n  const npc = npcs.find(n => n.id === npcId);\n  \n  if (!npc) return <div>NPC not found</div>;\n\n  const npcHealth = npc.basePower * 2;\n  const playerBaseHealth = gameState.character.health + (gameState.character.age || 0) * 2;\n  \n  const [battle, setBattle] = useState<BattleState>({\n    playerHealth: playerBaseHealth,\n    npcHealth: npcHealth,\n    turn: 0,\n    battleLog: [`You challenge ${npc.name}!`],\n    isPlayerTurn: true\n  });\n\n  const playerDamageMultiplier = 1 + (gameState.character.power * 0.03);\n  const npcDamageMultiplier = 1 + (npc.basePower * 0.02);\n\n  const handlePlayerAttack = () => {\n    const baseDamage = (gameState.character.power || 10) + Math.random() * 8;\n    const damage = baseDamage * playerDamageMultiplier;\n    const newLog = [...battle.battleLog];\n    newLog.push(`You attack for ${Math.floor(damage)} damage!`);\n\n    const newNpcHealth = Math.max(0, battle.npcHealth - damage);\n\n    if (newNpcHealth <= 0) {\n      newLog.push(`${npc.name} is defeated!`);\n      onBattleEnd(true, -30, {\n        power: Math.floor((npc.basePower / 20) * 1.5),\n        influence: 8,\n        wealth: Math.floor(npc.basePower * 3),\n        soulcoins: Math.floor(npc.basePower / 5)\n      });\n      return;\n    }\n\n    // NPC counterattack\n    const npcDamage = npc.basePower * 0.6 * npcDamageMultiplier;\n    newLog.push(`${npc.name} attacks for ${Math.floor(npcDamage)} damage!`);\n    const newPlayerHealth = Math.max(0, battle.playerHealth - npcDamage);\n\n    if (newPlayerHealth <= 0) {\n      newLog.push(`You've been defeated!`);\n      onBattleEnd(false, -50, {\n        power: -5,\n        influence: -10,\n        health: Math.floor(-battle.playerHealth * 0.5)\n      });\n      return;\n    }\n\n    setBattle({\n      playerHealth: newPlayerHealth,\n      npcHealth: newNpcHealth,\n      turn: battle.turn + 1,\n      battleLog: newLog,\n      isPlayerTurn: true\n    });\n  };\n\n  const handleFlee = () => {\n    const fleeChance = 0.6 + (gameState.character.control * 0.01);\n    if (Math.random() < fleeChance) {\n      toast({ title: \"Escaped!\", description: `You fled from ${npc.name}` });\n      onBattleEnd(false, -20, { power: -3, influence: -5 });\n    } else {\n      const npcDamage = npc.basePower * 0.8;\n      const newPlayerHealth = Math.max(0, battle.playerHealth - npcDamage);\n      const newLog = [...battle.battleLog];\n      newLog.push(`${npc.name} blocks your escape! Takes ${Math.floor(npcDamage)} damage!`);\n      \n      setBattle({\n        playerHealth: newPlayerHealth,\n        npcHealth: battle.npcHealth,\n        turn: battle.turn + 1,\n        battleLog: newLog,\n        isPlayerTurn: true\n      });\n    }\n  };\n\n  const healthPercent = (battle.playerHealth / playerBaseHealth) * 100;\n  const npcHealthPercent = (battle.npcHealth / npcHealth) * 100;\n\n  return (\n    <Card className=\"border-2 border-destructive\">\n      <CardHeader>\n        <CardTitle className=\"text-destructive\">{npc.name} - Confrontation!</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* Battle Stats */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <p className=\"text-sm font-semibold\">You</p>\n            <Progress value={healthPercent} className=\"mb-1\" />\n            <p className=\"text-xs\">{Math.floor(battle.playerHealth)} / {playerBaseHealth} HP</p>\n          </div>\n          <div>\n            <p className=\"text-sm font-semibold\">{npc.name}</p>\n            <Progress value={npcHealthPercent} className=\"mb-1\" />\n            <p className=\"text-xs\">{Math.floor(battle.npcHealth)} / {npcHealth} HP</p>\n          </div>\n        </div>\n\n        {/* Battle Log */}\n        <div className=\"bg-background/50 border rounded p-3 max-h-48 overflow-y-auto text-xs space-y-1\">\n          {battle.battleLog.map((log, i) => (\n            <p key={i} className=\"text-secondary-foreground\">{log}</p>\n          ))}\n        </div>\n\n        {/* Turn Number */}\n        <Badge variant=\"outline\">Turn {battle.turn}</Badge>\n\n        {/* Actions */}\n        <div className=\"flex gap-2\">\n          <Button\n            onClick={handlePlayerAttack}\n            className=\"flex-1\"\n            data-testid={`button-npc-attack-${npcId}`}\n          >\n            <Zap className=\"w-4 h-4 mr-2\" />\n            Attack\n          </Button>\n          <Button\n            onClick={handleFlee}\n            variant=\"outline\"\n            className=\"flex-1\"\n            data-testid={`button-npc-flee-${npcId}`}\n          >\n            <Shield className=\"w-4 h-4 mr-2\" />\n            Flee\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":5478},"client/src/components/game/social-panel.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Heart, MessageSquare, Gift } from \"lucide-react\";\nimport npcsData from \"@/data/npcs.json\";\nimport { calculateAffinityChange, applyNpcAffects, getRelationshipStatus } from \"@/lib/relationshipSystem\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { GameState } from \"@/lib/game-state\";\n\ninterface SocialPanelProps {\n  gameState: GameState;\n  onUpdateGameState: (updates: Partial<GameState>) => void;\n}\n\nconst COOLDOWN_TURNS = 2; // 2 turns between social interactions per NPC\n\nexport default function SocialPanel({ gameState, onUpdateGameState }: SocialPanelProps) {\n  const { toast } = useToast();\n  const [selectedNpc, setSelectedNpc] = useState<string | null>(null);\n  const npcs = npcsData as any[];\n\n  const isActionOnCooldown = (npcId: string, actionType: string): boolean => {\n    const cooldownKey = `social-${npcId}-${actionType}`;\n    const cooldowns = gameState.actionCooldowns || {};\n    const availableTurn = cooldowns[cooldownKey];\n    return availableTurn ? availableTurn > gameState.turn : false;\n  };\n\n  const setCooldown = (npcId: string, actionType: string) => {\n    const cooldownKey = `social-${npcId}-${actionType}`;\n    const newCooldowns = { ...gameState.actionCooldowns };\n    newCooldowns[cooldownKey] = gameState.turn + COOLDOWN_TURNS;\n    return newCooldowns;\n  };\n\n  const handleSocialize = (npcId: string) => {\n    if (isActionOnCooldown(npcId, \"socialize\")) {\n      toast({ title: \"Need Time\", description: \"You need time before socializing again\", variant: \"destructive\" });\n      return;\n    }\n\n    const npc = npcs.find(n => n.id === npcId);\n    if (!npc) return;\n\n    const currentRel = gameState.relationships[npcId];\n    const change = calculateAffinityChange(npcId, gameState.character.traits || [], \"positive\");\n    \n    const newRelationships = applyNpcAffects(gameState.relationships, { [npcId]: change });\n    const newRel = newRelationships[npcId];\n\n    toast({\n      title: `Socialized with ${npc.name}`,\n      description: `Affinity: ${currentRel?.affinity || 0} ‚Üí ${newRel.affinity} (${getRelationshipStatus(newRel.affinity)})`,\n      duration: 3000\n    });\n\n    onUpdateGameState({\n      relationships: newRelationships,\n      actionCooldowns: setCooldown(npcId, \"socialize\"),\n      character: {\n        ...gameState.character,\n        influence: Math.max(0, (gameState.character.influence || 0) + 1)\n      }\n    });\n  };\n\n  const handleGiftGiving = (npcId: string) => {\n    if (isActionOnCooldown(npcId, \"gift\")) {\n      toast({ title: \"Too Soon\", description: \"They still remember the last gift\", variant: \"destructive\" });\n      return;\n    }\n\n    const npc = npcs.find(n => n.id === npcId);\n    if (!npc) return;\n\n    if ((gameState.character.wealth || 0) < 50) {\n      toast({ title: \"Not Enough Wealth\", description: \"Need 50 wealth to give gifts\", variant: \"destructive\" });\n      return;\n    }\n\n    const currentRel = gameState.relationships[npcId];\n    const change = calculateAffinityChange(npcId, gameState.character.traits || [], \"positive\") + 3;\n    \n    const newRelationships = applyNpcAffects(gameState.relationships, { [npcId]: change });\n    const newRel = newRelationships[npcId];\n\n    toast({\n      title: `Gave Gift to ${npc.name}`,\n      description: `Affinity: ${currentRel?.affinity || 0} ‚Üí ${newRel.affinity} (${getRelationshipStatus(newRel.affinity)})`,\n      duration: 3000\n    });\n\n    onUpdateGameState({\n      relationships: newRelationships,\n      actionCooldowns: setCooldown(npcId, \"gift\"),\n      character: {\n        ...gameState.character,\n        wealth: Math.max(0, (gameState.character.wealth || 0) - 50)\n      }\n    });\n  };\n\n  const handleRomance = (npcId: string) => {\n    if (isActionOnCooldown(npcId, \"romance\")) {\n      toast({ title: \"Too Rushed\", description: \"Give them time to think\", variant: \"destructive\" });\n      return;\n    }\n\n    const npc = npcs.find(n => n.id === npcId);\n    if (!npc || !npc.romanceable) {\n      toast({ title: \"Cannot Romance\", description: `${npc?.name} is not interested in romance.`, variant: \"destructive\" });\n      return;\n    }\n\n    const currentRel = gameState.relationships[npcId];\n    if ((currentRel?.affinity || 0) < 40) {\n      toast({ title: \"Not Ready\", description: `Need 40+ affinity for romance. Current: ${currentRel?.affinity || 0}`, variant: \"destructive\" });\n      return;\n    }\n\n    const change = calculateAffinityChange(npcId, gameState.character.traits || [], \"romance\");\n    const newRelationships = applyNpcAffects(gameState.relationships, { [npcId]: change });\n    const newRel = newRelationships[npcId];\n\n    const isNowRomanced = newRel.affinity >= 75;\n\n    toast({\n      title: isNowRomanced ? `‚ù§Ô∏è Romance with ${npc.name}!` : `${npc.name} is interested...`,\n      description: isNowRomanced ? `You're now in a romantic relationship!` : `Affinity: ${currentRel?.affinity || 0} ‚Üí ${newRel.affinity}`,\n      duration: 3000\n    });\n\n    onUpdateGameState({\n      relationships: { ...newRelationships, [npcId]: { ...newRel, isRomanced: isNowRomanced } },\n      actionCooldowns: setCooldown(npcId, \"romance\"),\n      character: {\n        ...gameState.character,\n        empathy: Math.max(0, (gameState.character.empathy || 0) + 3)\n      }\n    });\n  };\n\n  return (\n    <Card className=\"border-2 border-card-border\" data-testid=\"card-social\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Heart className=\"w-5 h-5 text-primary\" />\n          Social Interactions\n        </CardTitle>\n        <CardDescription>Build relationships and romance</CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        {npcs.map((npc) => {\n          const rel = gameState.relationships[npc.id] || { affinity: 0, isRomanced: false, isRival: false, favorsOwed: 0 };\n          const status = getRelationshipStatus(rel.affinity);\n\n          return (\n            <Card key={npc.id} className=\"p-3 bg-card-border/50\" data-testid={`social-${npc.id}`}>\n              <div className=\"flex items-start justify-between gap-2 mb-2\">\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"font-semibold text-sm truncate\">{npc.name}</p>\n                  <div className=\"flex gap-1 flex-wrap\">\n                    <Badge variant=\"outline\" className=\"text-xs\">{status}</Badge>\n                    {rel.isRomanced && <Badge className=\"text-xs bg-pink-600\">üíï Romanced</Badge>}\n                    <Badge variant=\"secondary\" className=\"text-xs\">Affinity: {rel.affinity > 0 ? \"+\" : \"\"}{rel.affinity}</Badge>\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex gap-1 flex-wrap\">\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => handleSocialize(npc.id)}\n                  disabled={isActionOnCooldown(npc.id, \"socialize\")}\n                  className=\"text-xs h-8\"\n                  data-testid={`button-socialize-${npc.id}`}\n                >\n                  <MessageSquare className=\"w-3 h-3 mr-1\" />\n                  Socialize\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => handleGiftGiving(npc.id)}\n                  disabled={(gameState.character.wealth || 0) < 50 || isActionOnCooldown(npc.id, \"gift\")}\n                  className=\"text-xs h-8\"\n                  data-testid={`button-gift-${npc.id}`}\n                >\n                  <Gift className=\"w-3 h-3 mr-1\" />\n                  Gift (-50w)\n                </Button>\n                {npc.romanceable && (\n                  <Button\n                    size=\"sm\"\n                    variant={rel.isRomanced ? \"default\" : \"outline\"}\n                    onClick={() => handleRomance(npc.id)}\n                    disabled={(rel.affinity || 0) < 40 || isActionOnCooldown(npc.id, \"romance\")}\n                    className=\"text-xs h-8\"\n                    data-testid={`button-romance-${npc.id}`}\n                  >\n                    <Heart className=\"w-3 h-3 mr-1\" />\n                    {rel.isRomanced ? \"Romanced\" : \"Romance\"}\n                  </Button>\n                )}\n              </div>\n            </Card>\n          );\n        })}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":8532},"client/src/components/game/rival-challenge-modal.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Swords, Heart, X } from \"lucide-react\";\nimport npcsData from \"@/data/npcs.json\";\nimport type { GameState } from \"@/lib/game-state\";\nimport { getRelationshipStatus } from \"@/lib/relationshipSystem\";\n\ninterface RivalChallengeModalProps {\n  npcId: string;\n  gameState: GameState;\n  onFight: () => void;\n  onMend: () => void;\n  onDismiss: () => void;\n  onFightWithCompanion?: () => void;\n}\n\nexport default function RivalChallengeModal({\n  npcId,\n  gameState,\n  onFight,\n  onMend,\n  onDismiss,\n  onFightWithCompanion\n}: RivalChallengeModalProps) {\n  const npcs = npcsData as any[];\n  const npc = npcs.find(n => n.id === npcId);\n  const relationship = gameState.relationships[npcId];\n\n  if (!npc || !relationship) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n      <Card className=\"border-2 border-destructive w-96 max-w-[90vw]\">\n        <CardHeader>\n          <div className=\"flex items-start justify-between\">\n            <div>\n              <CardTitle className=\"text-destructive text-2xl mb-2\">{npc.name} Confronts You!</CardTitle>\n              <Badge variant=\"destructive\">\n                {getRelationshipStatus(relationship.affinity)} - {relationship.affinity} Affinity\n              </Badge>\n            </div>\n            <button onClick={onDismiss} className=\"text-muted-foreground hover:text-foreground\">\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <p className=\"text-sm italic text-secondary-foreground\">\n            \"{npc.name} appears before you, clearly hostile. Your relationship has deteriorated beyond repair.\"\n          </p>\n\n          <div className=\"space-y-2 text-xs\">\n            <p>\n              <span className=\"font-semibold\">Power:</span> {npc.basePower}\n            </p>\n            <p>\n              <span className=\"font-semibold\">Faction:</span> {npc.faction}\n            </p>\n          </div>\n\n          <div className=\"flex gap-2 flex-col\">\n            <Button\n              onClick={onFightWithCompanion ? onFightWithCompanion : onFight}\n              variant=\"destructive\"\n              className=\"w-full gap-2\"\n              data-testid={`button-rival-fight-${npcId}`}\n            >\n              <Swords className=\"w-4 h-4\" />\n              Fight to the End\n            </Button>\n            \n            <Button\n              onClick={onMend}\n              variant=\"outline\"\n              className=\"w-full gap-2\"\n              data-testid={`button-rival-mend-${npcId}`}\n            >\n              <Heart className=\"w-4 h-4\" />\n              Try to Mend Relationship\n            </Button>\n\n            <Button\n              onClick={onDismiss}\n              variant=\"ghost\"\n              className=\"w-full\"\n              data-testid={`button-rival-dismiss-${npcId}`}\n            >\n              Avoid for Now\n            </Button>\n          </div>\n\n          <p className=\"text-xs text-muted-foreground text-center mt-4\">\n            {relationship.affinity < -75\n              ? \"This enemy will stop at nothing to see you destroyed.\"\n              : relationship.affinity < -50\n              ? \"Serious conflict appears imminent.\"\n              : \"Tensions are reaching a breaking point.\"}\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":3559}},"version":2}